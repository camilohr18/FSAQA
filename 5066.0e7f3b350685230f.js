"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5066],{5066:(nI,Of,oe)=>{oe.d(Of,{u:()=>Ey});var b=oe(467),ie=oe(3953),ot=oe(1182),We=oe(9842),Lf=oe(177),Ke=oe(1825),hi=oe(9253),Bf=oe(3236),qf=oe(1985),di=oe(8455),Du=oe(7673),Ds=oe(9172),Uf=oe(9974),Gf=oe(4360);function Ns(){return(0,Uf.N)((r,e)=>{let t,n=!1;r.subscribe((0,Gf._)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var zt,Ou,Ye=oe(6354),ks=oe(2816),zf=oe(3294),Nu=oe(5964),Kf=(oe(9254),oe(3345)),fi=oe(7852),ku=oe(1362),Xe=oe(8041),ee=oe(1076),Fu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Mu={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(T,p,I){I||(I=0);var E=Array(16);if("string"==typeof p)for(var v=0;16>v;++v)E[v]=p.charCodeAt(I++)|p.charCodeAt(I++)<<8|p.charCodeAt(I++)<<16|p.charCodeAt(I++)<<24;else for(v=0;16>v;++v)E[v]=p[I++]|p[I++]<<8|p[I++]<<16|p[I++]<<24;var P=T.g[3],y=(p=T.g[0])+(P^(I=T.g[1])&((v=T.g[2])^P))+E[0]+3614090360&4294967295;y=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=I+(y<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[1]+3905402710&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[2]+606105819&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[3]+3250441966&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[4]+4118548399&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[5]+1200080426&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[6]+2821735955&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[7]+4249261313&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[8]+1770035416&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[9]+2336552879&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[10]+4294925233&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[11]+2304563134&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[12]+1804603682&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[13]+4254626195&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[14]+2792965006&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[15]+1236535329&4294967295)<<22&4294967295|y>>>10))+((y=p+(v^P&(I^v))+E[1]+4129170786&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[6]+3225465664&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[11]+643717713&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[0]+3921069994&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[5]+3593408605&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[10]+38016083&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[15]+3634488961&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[4]+3889429448&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[9]+568446438&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[14]+3275163606&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[3]+4107603335&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[8]+1163531501&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[13]+2850285829&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[2]+4243563512&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[7]+1735328473&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[12]+2368359562&4294967295)<<20&4294967295|y>>>12))+((y=p+(I^v^P)+E[5]+4294588738&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[8]+2272392833&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[11]+1839030562&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[14]+4259657740&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[1]+2763975236&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[4]+1272893353&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[7]+4139469664&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[10]+3200236656&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[13]+681279174&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[0]+3936430074&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[3]+3572445317&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[6]+76029189&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[9]+3654602809&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[12]+3873151461&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[15]+530742520&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[2]+3299628645&4294967295)<<23&4294967295|y>>>9))+((y=p+(v^(I|~P))+E[0]+4096336452&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[7]+1126891415&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[14]+2878612391&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[5]+4237533241&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[12]+1700485571&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[3]+2399980690&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[10]+4293915773&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[1]+2240044497&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[8]+1873313359&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[15]+4264355552&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[6]+2734768916&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[13]+1309151649&4294967295)<<21&4294967295|y>>>11))+((P=(p=I+((y=p+(v^(I|~P))+E[4]+4149444226&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[11]+3174756917&4294967295)<<10&4294967295|y>>>22))^((v=P+((y=v+(p^(P|~I))+E[2]+718787259&4294967295)<<15&4294967295|y>>>17))|~p))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+p&4294967295,T.g[1]=T.g[1]+(v+(y<<21&4294967295|y>>>11))&4294967295,T.g[2]=T.g[2]+v&4294967295,T.g[3]=T.g[3]+P&4294967295}function o(T,p){this.h=p;for(var I=[],E=!0,v=T.length-1;0<=v;v--){var P=0|T[v];E&&P==p||(I[v]=P,E=!1)}this.g=I}(function e(T,p){function I(){}I.prototype=p.prototype,T.D=p.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(E,v,P){for(var y=Array(arguments.length-2),_t=2;_t<arguments.length;_t++)y[_t-2]=arguments[_t];return p.prototype[v].apply(E,y)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(T,p){void 0===p&&(p=T.length);for(var I=p-this.blockSize,E=this.B,v=this.h,P=0;P<p;){if(0==v)for(;P<=I;)i(this,T,P),P+=this.blockSize;if("string"==typeof T){for(;P<p;)if(E[v++]=T.charCodeAt(P++),v==this.blockSize){i(this,E),v=0;break}}else for(;P<p;)if(E[v++]=T[P++],v==this.blockSize){i(this,E),v=0;break}}this.h=v,this.o+=p},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var p=1;p<T.length-8;++p)T[p]=0;var I=8*this.o;for(p=T.length-8;p<T.length;++p)T[p]=255&I,I/=256;for(this.u(T),T=Array(16),p=I=0;4>p;++p)for(var E=0;32>E;E+=8)T[I++]=this.g[p]>>>E&255;return T};var u={};function c(T){return-128<=T&&128>T?function s(T,p){var I=u;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=p(T)}(T,function(p){return new o([0|p],0>p?-1:0)}):new o([0|T],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return g;if(0>T)return D(h(-T));for(var p=[],I=1,E=0;T>=I;E++)p[E]=T/I|0,I*=4294967296;return new o(p,0)}var g=c(0),_=c(1),R=c(16777216);function x(T){if(0!=T.h)return!1;for(var p=0;p<T.g.length;p++)if(0!=T.g[p])return!1;return!0}function k(T){return-1==T.h}function D(T){for(var p=T.g.length,I=[],E=0;E<p;E++)I[E]=~T.g[E];return new o(I,~T.h).add(_)}function B(T,p){return T.add(D(p))}function z(T,p){for(;(65535&T[p])!=T[p];)T[p+1]+=T[p]>>>16,T[p]&=65535,p++}function U(T,p){this.g=T,this.h=p}function K(T,p){if(x(p))throw Error("division by zero");if(x(T))return new U(g,g);if(k(T))return p=K(D(T),p),new U(D(p.g),D(p.h));if(k(p))return p=K(T,D(p)),new U(D(p.g),p.h);if(30<T.g.length){if(k(T)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var I=_,E=p;0>=E.l(T);)I=Y(I),E=Y(E);var v=Q(I,1),P=Q(E,1);for(E=Q(E,2),I=Q(I,2);!x(E);){var y=P.add(E);0>=y.l(T)&&(v=v.add(I),P=y),E=Q(E,1),I=Q(I,1)}return p=B(T,v.j(p)),new U(v,p)}for(v=g;0<=T.l(p);){for(I=Math.max(1,Math.floor(T.m()/p.m())),E=48>=(E=Math.ceil(Math.log(I)/Math.LN2))?1:Math.pow(2,E-48),y=(P=h(I)).j(p);k(y)||0<y.l(T);)y=(P=h(I-=E)).j(p);x(P)&&(P=_),v=v.add(P),T=B(T,y)}return new U(v,T)}function Y(T){for(var p=T.g.length+1,I=[],E=0;E<p;E++)I[E]=T.i(E)<<1|T.i(E-1)>>>31;return new o(I,T.h)}function Q(T,p){var I=p>>5;p%=32;for(var E=T.g.length-I,v=[],P=0;P<E;P++)v[P]=0<p?T.i(P+I)>>>p|T.i(P+I+1)<<32-p:T.i(P+I);return new o(v,T.h)}(r=o.prototype).m=function(){if(k(this))return-D(this).m();for(var T=0,p=1,I=0;I<this.g.length;I++){var E=this.i(I);T+=(0<=E?E:4294967296+E)*p,p*=4294967296}return T},r.toString=function(T){if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if(x(this))return"0";if(k(this))return"-"+D(this).toString(T);for(var p=h(Math.pow(T,6)),I=this,E="";;){var v=K(I,p).g,P=((0<(I=B(I,v.j(p))).g.length?I.g[0]:I.h)>>>0).toString(T);if(x(I=v))return P+E;for(;6>P.length;)P="0"+P;E=P+E}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h},r.l=function(T){return k(T=B(this,T))?-1:x(T)?0:1},r.abs=function(){return k(this)?D(this):this},r.add=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0,v=0;v<=p;v++){var P=E+(65535&this.i(v))+(65535&T.i(v)),y=(P>>>16)+(this.i(v)>>>16)+(T.i(v)>>>16);E=y>>>16,I[v]=(y&=65535)<<16|(P&=65535)}return new o(I,-2147483648&I[I.length-1]?-1:0)},r.j=function(T){if(x(this)||x(T))return g;if(k(this))return k(T)?D(this).j(D(T)):D(D(this).j(T));if(k(T))return D(this.j(D(T)));if(0>this.l(R)&&0>T.l(R))return h(this.m()*T.m());for(var p=this.g.length+T.g.length,I=[],E=0;E<2*p;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var v=0;v<T.g.length;v++){var P=this.i(E)>>>16,y=65535&this.i(E),_t=T.i(v)>>>16,Qr=65535&T.i(v);I[2*E+2*v]+=y*Qr,z(I,2*E+2*v),I[2*E+2*v+1]+=P*Qr,z(I,2*E+2*v+1),I[2*E+2*v+1]+=y*_t,z(I,2*E+2*v+1),I[2*E+2*v+2]+=P*_t,z(I,2*E+2*v+2)}for(E=0;E<p;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=p;E<2*p;E++)I[E]=0;return new o(I,0)},r.A=function(T){return K(this,T).h},r.and=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)&T.i(E);return new o(I,this.h&T.h)},r.or=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)|T.i(E);return new o(I,this.h|T.h)},r.xor=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)^T.i(E);return new o(I,this.h^T.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ou=Mu.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=function f(T,p){if(0==T.length)throw Error("number format error: empty string");if(2>(p=p||10)||36<p)throw Error("radix out of range: "+p);if("-"==T.charAt(0))return D(f(T.substring(1),p));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(p,8)),E=g,v=0;v<T.length;v+=8){var P=Math.min(8,T.length-v),y=parseInt(T.substring(v,v+P),p);8>P?(P=h(Math.pow(p,P)),E=E.j(P).add(h(y))):E=(E=E.j(I)).add(h(y))}return E},zt=Mu.Integer=o}).apply(typeof Fu<"u"?Fu:typeof self<"u"?self:typeof window<"u"?window:{});var Lu,Bu,ir,qu,gi,Fs,Uu,Gu,zu,mi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},at={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a},n=function t(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof mi&&mi];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(a,l){if(l)e:{var d=n;a=a.split(".");for(var m=0;m<a.length-1;m++){var A=a[m];if(!(A in d))break e;d=d[A]}(l=l(m=d[a=a[a.length-1]]))!=m&&null!=l&&e(d,a,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(a){return a||function(){return function s(a,l){a instanceof String&&(a+="");var d=0,m=!1,A={next:function(){if(!m&&d<a.length){var V=d++;return{value:l(V,a[V]),done:!1}}return m=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}(this,function(l,d){return d})}});var o=o||{},u=this||self;function c(a){var l=typeof a;return"array"==(l="object"!=l?l:a?Array.isArray(a)?"array":l:"null")||"object"==l&&"number"==typeof a.length}function h(a){var l=typeof a;return"object"==l&&null!=a||"function"==l}function f(a,l,d){return a.call.apply(a.bind,arguments)}function g(a,l,d){if(!a)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,m),a.apply(l,A)}}return function(){return a.apply(l,arguments)}}function _(a,l,d){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:g).apply(null,arguments)}function R(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function x(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(m,A,V){for(var M=Array(arguments.length-2),se=2;se<arguments.length;se++)M[se-2]=arguments[se];return l.prototype[A].apply(m,M)}}function k(a){const l=a.length;if(0<l){const d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function D(a,l){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(c(m)){const A=a.length||0,V=m.length||0;a.length=A+V;for(let M=0;M<V;M++)a[A+M]=m[M]}else a.push(m)}}function z(a){return/^[\s\xa0]*$/.test(a)}function U(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function K(a){return K[" "](a),a}K[" "]=function(){};var Y=!(-1==U().indexOf("Gecko")||-1!=U().toLowerCase().indexOf("webkit")&&-1==U().indexOf("Edge")||-1!=U().indexOf("Trident")||-1!=U().indexOf("MSIE")||-1!=U().indexOf("Edge"));function Q(a,l,d){for(const m in a)l.call(d,a[m],m,a)}function p(a){const l={};for(const d in a)l[d]=a[d];return l}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(a,l){let d,m;for(let A=1;A<arguments.length;A++){for(d in m=arguments[A],m)a[d]=m[d];for(let V=0;V<I.length;V++)d=I[V],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function v(a){var l=1;a=a.split(":");const d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function P(a){u.setTimeout(()=>{throw a},0)}function y(){var a=au;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}var Qr=new class B{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new vy,a=>a.reset());class vy{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let $r,Wr=!1,au=new class _t{constructor(){this.h=this.g=null}add(l,d){const m=Qr.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},Fd=()=>{const a=u.Promise.resolve(void 0);$r=()=>{a.then(Ay)}};var Ay=()=>{for(var a;a=y();){try{a.h.call(a.g)}catch(d){P(d)}var l=Qr;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}Wr=!1};function Bt(){this.s=this.s,this.C=this.C}function Ne(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}Bt.prototype.s=!1,Bt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Bt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Ne.prototype.h=function(){this.defaultPrevented=!0};var wy=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return a}();function Hr(a,l){if(Ne.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(Y){e:{try{K(l.nodeName);var A=!0;break e}catch{}A=!1}A||(l=null)}}else"mouseover"==d?l=a.fromElement:"mouseout"==d&&(l=a.toElement);this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Ry[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Hr.aa.h.call(this)}}x(Hr,Ne);var Ry={2:"touch",3:"pen",4:"mouse"};Hr.prototype.h=function(){Hr.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Jr="closure_listenable_"+(1e6*Math.random()|0),Py=0;function Sy(a,l,d,m,A){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=A,this.key=++Py,this.da=this.fa=!1}function gs(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ps(a){this.src=a,this.g={},this.h=0}function uu(a,l){var d=l.type;if(d in a.g){var V,m=a.g[d],A=Array.prototype.indexOf.call(m,l,void 0);(V=0<=A)&&Array.prototype.splice.call(m,A,1),V&&(gs(l),0==a.g[d].length&&(delete a.g[d],a.h--))}}function cu(a,l,d,m){for(var A=0;A<a.length;++A){var V=a[A];if(!V.da&&V.listener==l&&V.capture==!!d&&V.ha==m)return A}return-1}ps.prototype.add=function(a,l,d,m,A){var V=a.toString();(a=this.g[V])||(a=this.g[V]=[],this.h++);var M=cu(a,l,m,A);return-1<M?(l=a[M],d||(l.fa=!1)):((l=new Sy(l,this.src,V,!!m,A)).fa=d,a.push(l)),l};var lu="closure_lm_"+(1e6*Math.random()|0),hu={};function Md(a,l,d,m,A){if(m&&m.once)return Ld(a,l,d,m,A);if(Array.isArray(l)){for(var V=0;V<l.length;V++)Md(a,l[V],d,m,A);return null}return d=gu(d),a&&a[Jr]?a.K(l,d,h(m)?!!m.capture:!!m,A):Od(a,l,d,!1,m,A)}function Od(a,l,d,m,A,V){if(!l)throw Error("Invalid event type");var M=h(A)?!!A.capture:!!A,se=fu(a);if(se||(a[lu]=se=new ps(a)),(d=se.add(l,d,m,M,V)).proxy)return d;if(m=function Vy(){const l=by;return function a(d){return l.call(a.src,a.listener,d)}}(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)wy||(A=M),void 0===A&&(A=!1),a.addEventListener(l.toString(),m,A);else if(a.attachEvent)a.attachEvent(qd(l.toString()),m);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(m)}return d}function Ld(a,l,d,m,A){if(Array.isArray(l)){for(var V=0;V<l.length;V++)Ld(a,l[V],d,m,A);return null}return d=gu(d),a&&a[Jr]?a.L(l,d,h(m)?!!m.capture:!!m,A):Od(a,l,d,!0,m,A)}function Bd(a,l,d,m,A){if(Array.isArray(l))for(var V=0;V<l.length;V++)Bd(a,l[V],d,m,A);else m=h(m)?!!m.capture:!!m,d=gu(d),a&&a[Jr]?(a=a.i,(l=String(l).toString())in a.g&&-1<(d=cu(V=a.g[l],d,m,A))&&(gs(V[d]),Array.prototype.splice.call(V,d,1),0==V.length&&(delete a.g[l],a.h--))):a&&(a=fu(a))&&(l=a.g[l.toString()],a=-1,l&&(a=cu(l,d,m,A)),(d=-1<a?l[a]:null)&&du(d))}function du(a){if("number"!=typeof a&&a&&!a.da){var l=a.src;if(l&&l[Jr])uu(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(qd(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=fu(l))?(uu(d,a),0==d.h&&(d.src=null,l[lu]=null)):gs(a)}}}function qd(a){return a in hu?hu[a]:hu[a]="on"+a}function by(a,l){if(a.da)a=!0;else{l=new Hr(l,this);var d=a.listener,m=a.ha||a.src;a.fa&&du(a),a=d.call(m,l)}return a}function fu(a){return(a=a[lu])instanceof ps?a:null}var mu="__closure_events_fn_"+(1e9*Math.random()>>>0);function gu(a){return"function"==typeof a?a:(a[mu]||(a[mu]=function(l){return a.handleEvent(l)}),a[mu])}function ke(){Bt.call(this),this.i=new ps(this),this.M=this,this.F=null}function Be(a,l){var d,m=a.F;if(m)for(d=[];m;m=m.F)d.push(m);if(a=a.M,m=l.type||l,"string"==typeof l)l=new Ne(l,a);else if(l instanceof Ne)l.target=l.target||a;else{var A=l;E(l=new Ne(m,a),A)}if(A=!0,d)for(var V=d.length-1;0<=V;V--){var M=l.g=d[V];A=_s(M,m,!0,l)&&A}if(A=_s(M=l.g=a,m,!0,l)&&A,A=_s(M,m,!1,l)&&A,d)for(V=0;V<d.length;V++)A=_s(M=l.g=d[V],m,!1,l)&&A}function _s(a,l,d,m){if(!(l=a.i.g[String(l)]))return!0;l=l.concat();for(var A=!0,V=0;V<l.length;++V){var M=l[V];if(M&&!M.da&&M.capture==d){var se=M.listener,Ve=M.ha||M.src;M.fa&&uu(a.i,M),A=!1!==se.call(Ve,m)&&A}}return A&&!m.defaultPrevented}function Ud(a,l,d){if("function"==typeof a)d&&(a=_(a,d));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=_(a.handleEvent,a)}return 2147483647<Number(l)?-1:u.setTimeout(a,l||0)}function Gd(a){a.g=Ud(()=>{a.g=null,a.i&&(a.i=!1,Gd(a))},a.l);const l=a.h;a.h=null,a.m.apply(null,l)}x(ke,Bt),ke.prototype[Jr]=!0,ke.prototype.removeEventListener=function(a,l,d,m){Bd(this,a,l,d,m)},ke.prototype.N=function(){if(ke.aa.N.call(this),this.i){var l,a=this.i;for(l in a.g){for(var d=a.g[l],m=0;m<d.length;m++)gs(d[m]);delete a.g[l],a.h--}}this.F=null},ke.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},ke.prototype.L=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};class xy extends Bt{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Gd(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yr(a){Bt.call(this),this.h=a,this.g={}}x(Yr,Bt);var zd=[];function Kd(a){Q(a.g,function(l,d){this.g.hasOwnProperty(d)&&du(l)},a),a.g={}}Yr.prototype.N=function(){Yr.aa.N.call(this),Kd(this)},Yr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pu=u.JSON.stringify,Cy=u.JSON.parse,Dy=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function _u(){}function Qd(){}_u.prototype.h=null;var Xr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function yu(){Ne.call(this,"d")}function Iu(){Ne.call(this,"c")}x(yu,Ne),x(Iu,Ne);var dn={},$d=null;function ys(){return $d=$d||new ke}function Wd(a){Ne.call(this,dn.La,a)}function Zr(a){const l=ys();Be(l,new Wd(l))}function Hd(a,l){Ne.call(this,dn.STAT_EVENT,a),this.stat=l}function qe(a){const l=ys();Be(l,new Hd(l,a))}function Jd(a,l){Ne.call(this,dn.Ma,a),this.size=l}function ei(a,l){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},l)}function ti(){this.g=!0}function er(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+function My(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var m=d[a];if(!(2>m.length)){var A=m[1];if(Array.isArray(A)&&!(1>A.length)){var V=A[0];if("noop"!=V&&"stop"!=V&&"close"!=V)for(var M=1;M<A.length;M++)A[M]=""}}}return pu(d)}catch{return l}}(a,d)+(m?" "+m:"")})}dn.La="serverreachability",x(Wd,Ne),dn.STAT_EVENT="statevent",x(Hd,Ne),dn.Ma="timingevent",x(Jd,Ne),ti.prototype.xa=function(){this.g=!1},ti.prototype.info=function(){};var Tu,Is={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Yd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Ts(){}function qt(a,l,d,m){this.j=a,this.i=l,this.l=d,this.R=m||1,this.U=new Yr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Xd}function Xd(){this.i=null,this.g="",this.h=!1}x(Ts,_u),Ts.prototype.g=function(){return new XMLHttpRequest},Ts.prototype.i=function(){return{}},Tu=new Ts;var Zd={},Eu={};function vu(a,l,d){a.L=1,a.v=ws(yt(l)),a.m=d,a.P=!0,ef(a,null)}function ef(a,l){a.F=Date.now(),Es(a),a.A=yt(a.v);var d=a.A,m=a.R;Array.isArray(m)||(m=[String(m)]),gf(d.i,"t",m),a.C=0,d=a.j.J,a.h=new Xd,a.g=Nf(a.j,d?l:null,!a.m),0<a.O&&(a.M=new xy(_(a.Y,a,a.g),a.O)),l=a.U,d=a.g,m=a.ca;var A="readystatechange";Array.isArray(A)||(A&&(zd[0]=A.toString()),A=zd);for(var V=0;V<A.length;V++){var M=Md(d,A[V],m||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=a.H?p(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),Zr(),function Ny(a,l,d,m,A,V){a.info(function(){if(a.g)if(V)for(var M="",se=V.split("&"),Ve=0;Ve<se.length;Ve++){var Z=se[Ve].split("=");if(1<Z.length){var Fe=Z[0];Z=Z[1];var Me=Fe.split("_");M=2<=Me.length&&"type"==Me[1]?M+(Fe+"=")+Z+"&":M+(Fe+"=redacted&")}}else M=null;else M=V;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+l+"\n"+d+"\n"+M})}(a.i,a.u,a.A,a.l,a.R,a.m)}function tf(a){return!!a.g&&"GET"==a.u&&2!=a.L&&a.j.Ca}function Oy(a,l){var d=a.C,m=l.indexOf("\n",d);return-1==m?Eu:(d=Number(l.substring(d,m)),isNaN(d)?Zd:(m+=1)+d>l.length?Eu:(l=l.slice(m,m+d),a.C=m+d,l))}function Es(a){a.S=Date.now()+a.I,nf(a,a.I)}function nf(a,l){if(null!=a.B)throw Error("WatchDog timer not null");a.B=ei(_(a.ba,a),l)}function Au(a){a.B&&(u.clearTimeout(a.B),a.B=null)}function ni(a){0==a.j.G||a.J||bf(a.j,a)}function fn(a){Au(a);var l=a.M;l&&"function"==typeof l.ma&&l.ma(),a.M=null,Kd(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function wu(a,l){try{var d=a.j;if(0!=d.G&&(d.g==a||Ru(d.h,a)))if(!a.K&&Ru(d.h,a)&&3==d.G){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var A=m;if(0==A[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<a.F))break e;bs(d),Ss(d)}bu(d),qe(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&0==d.v&&!d.C&&(d.C=ei(_(d.Za,d),6e3));if(1>=of(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else gn(d,11)}else if((a.K||d.g==a)&&bs(d),!z(l))for(A=d.Da.g.parse(l),l=0;l<A.length;l++){let Z=A[l];if(d.T=Z[0],Z=Z[1],2==d.G)if("c"==Z[0]){d.K=Z[1],d.ia=Z[2];const Fe=Z[3];null!=Fe&&(d.la=Fe,d.j.info("VER="+d.la));const Me=Z[4];null!=Me&&(d.Aa=Me,d.j.info("SVER="+d.Aa));const rr=Z[5];null!=rr&&"number"==typeof rr&&0<rr&&(d.L=m=1.5*rr,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const Je=a.g;if(Je){const Cs=Je.g?Je.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Cs){var V=m.h;V.g||-1==Cs.indexOf("spdy")&&-1==Cs.indexOf("quic")&&-1==Cs.indexOf("h2")||(V.j=V.l,V.g=new Set,V.h&&(Pu(V,V.h),V.h=null))}if(m.D){const Cu=Je.g?Je.g.getResponseHeader("X-HTTP-Session-Id"):null;Cu&&(m.ya=Cu,he(m.I,m.D,Cu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms"));var M=a;if((m=d).qa=Df(m,m.J?m.ia:null,m.W),M.K){af(m.h,M);var se=M,Ve=m.L;Ve&&(se.I=Ve),se.B&&(Au(se),Es(se)),m.g=M}else Sf(m);0<d.i.length&&Vs(d)}else"stop"!=Z[0]&&"close"!=Z[0]||gn(d,7);else 3==d.G&&("stop"==Z[0]||"close"==Z[0]?"stop"==Z[0]?gn(d,7):Vu(d):"noop"!=Z[0]&&d.l&&d.l.ta(Z),d.v=0)}Zr()}catch{}}qt.prototype.ca=function(a){a=a.target;const l=this.M;l&&3==It(a)?l.j():this.Y(a)},qt.prototype.Y=function(a){try{if(a==this.g)e:{const Me=It(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Me)&&(3!=Me||this.g&&(this.h.h||this.g.oa()||vf(this.g)))){this.J||4!=Me||7==l||Zr(),Au(this);var d=this.g.Z();this.X=d;t:if(tf(this)){var m=vf(this.g);a="";var A=m.length,V=4==It(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){fn(this),ni(this);var M="";break t}this.h.i=new u.TextDecoder}for(l=0;l<A;l++)this.h.h=!0,a+=this.h.i.decode(m[l],{stream:!(V&&l==A-1)});m.length=0,this.h.g+=a,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=200==d,function ky(a,l,d,m,A,V,M){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+l+"\n"+d+"\n"+V+" "+M})}(this.i,this.u,this.A,this.l,this.R,Me,d),this.o){if(this.T&&!this.K){t:{if(this.g){var se,Ve=this.g;if((se=Ve.g?Ve.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(se)){var Z=se;break t}}Z=null}if(!(d=Z)){this.o=!1,this.s=3,qe(12),fn(this),ni(this);break e}er(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wu(this,d)}if(this.P){let Je;for(d=!0;!this.J&&this.C<M.length;){if(Je=Oy(this,M),Je==Eu){4==Me&&(this.s=4,qe(14),d=!1),er(this.i,this.l,null,"[Incomplete Response]");break}if(Je==Zd){this.s=4,qe(15),er(this.i,this.l,M,"[Invalid Chunk]"),d=!1;break}er(this.i,this.l,Je,null),wu(this,Je)}if(tf(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Me||0!=M.length||this.h.h||(this.s=1,qe(16),d=!1),this.o=this.o&&d,d){if(0<M.length&&!this.W){this.W=!0;var Fe=this.j;Fe.g==this&&Fe.ba&&!Fe.M&&(Fe.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),xu(Fe),Fe.M=!0,qe(11))}}else er(this.i,this.l,M,"[Invalid Chunked Response]"),fn(this),ni(this)}else er(this.i,this.l,M,null),wu(this,M);4==Me&&fn(this),this.o&&!this.J&&(4==Me?bf(this.j,this):(this.o=!1,Es(this)))}else(function eI(a){const l={};a=(a.g&&2<=It(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<a.length;m++){if(z(a[m]))continue;var d=v(a[m]);const A=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const V=l[A]||[];l[A]=V,V.push(d)}!function T(a,l){for(const d in a)l.call(void 0,a[d],d,a)}(l,function(m){return m.join(", ")})})(this.g),400==d&&0<M.indexOf("Unknown SID")?(this.s=3,qe(12)):(this.s=0,qe(13)),fn(this),ni(this)}}}catch{}},qt.prototype.cancel=function(){this.J=!0,fn(this)},qt.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(function Fy(a,l){a.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(Zr(),qe(17)),fn(this),this.s=2,ni(this)):nf(this,this.S-a)};var Ly=class{constructor(a,l){this.g=a,this.map=l}};function rf(a){this.l=a||10,a=u.PerformanceNavigationTiming?0<(a=u.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function sf(a){return!!a.h||!!a.g&&a.g.size>=a.j}function of(a){return a.h?1:a.g?a.g.size:0}function Ru(a,l){return a.h?a.h==l:!!a.g&&a.g.has(l)}function Pu(a,l){a.g?a.g.add(l):a.h=l}function af(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}function uf(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let l=a.i;for(const d of a.g.values())l=l.concat(d.D);return l}return k(a.i)}function cf(a,l){if(a.forEach&&"function"==typeof a.forEach)a.forEach(l,void 0);else if(c(a)||"string"==typeof a)Array.prototype.forEach.call(a,l,void 0);else for(var d=function qy(a){if(a.na&&"function"==typeof a.na)return a.na();if(!a.V||"function"!=typeof a.V){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||"string"==typeof a){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(const m in a)l[d++]=m;return l}}}(a),m=function By(a){if(a.V&&"function"==typeof a.V)return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(c(a)){for(var l=[],d=a.length,m=0;m<d;m++)l.push(a[m]);return l}for(m in l=[],d=0,a)l[d++]=a[m];return l}(a),A=m.length,V=0;V<A;V++)l.call(void 0,m[V],d&&d[V],a)}rf.prototype.cancel=function(){if(this.i=uf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var lf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mn(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof mn){this.h=a.h,vs(this,a.j),this.o=a.o,this.g=a.g,As(this,a.s),this.l=a.l;var l=a.i,d=new si;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),hf(this,d),this.m=a.m}else a&&(l=String(a).match(lf))?(this.h=!1,vs(this,l[1]||"",!0),this.o=ri(l[2]||""),this.g=ri(l[3]||"",!0),As(this,l[4]),this.l=ri(l[5]||"",!0),hf(this,l[6]||"",!0),this.m=ri(l[7]||"")):(this.h=!1,this.i=new si(null,this.h))}function yt(a){return new mn(a)}function vs(a,l,d){a.j=d?ri(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function As(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function hf(a,l,d){l instanceof si?(a.i=l,function $y(a,l){l&&!a.j&&(Ut(a),a.i=null,a.g.forEach(function(d,m){var A=m.toLowerCase();m!=A&&(ff(this,m),gf(this,A,d))},a)),a.j=l}(a.i,a.h)):(d||(l=ii(l,jy)),a.i=new si(l,a.h))}function he(a,l,d){a.i.set(l,d)}function ws(a){return he(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ri(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ii(a,l,d){return"string"==typeof a?(a=encodeURI(a).replace(l,Gy),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Gy(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}mn.prototype.toString=function(){var a=[],l=this.j;l&&a.push(ii(l,df,!0),":");var d=this.g;return(d||"file"==l)&&(a.push("//"),(l=this.o)&&a.push(ii(l,df,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&a.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&a.push("/"),a.push(ii(d,"/"==d.charAt(0)?Ky:zy,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",ii(d,Qy)),a.join("")};var df=/[#\/\?@]/g,zy=/[#\?:]/g,Ky=/[#\?]/g,jy=/[#\?@]/g,Qy=/#/g;function si(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function Ut(a){a.g||(a.g=new Map,a.h=0,a.i&&function Uy(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var m=a[d].indexOf("="),A=null;if(0<=m){var V=a[d].substring(0,m);A=a[d].substring(m+1)}else V=a[d];l(V,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function ff(a,l){Ut(a),l=tr(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function mf(a,l){return Ut(a),l=tr(a,l),a.g.has(l)}function gf(a,l,d){ff(a,l),0<d.length&&(a.i=null,a.g.set(tr(a,l),k(d)),a.h+=d.length)}function tr(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function Gt(a,l,d,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(d)}catch{}}function Jy(){this.g=new Dy}function Yy(a,l,d){const m=d||"";try{cf(a,function(A,V){let M=A;h(A)&&(M=pu(A)),l.push(m+V+"="+encodeURIComponent(M))})}catch(A){throw l.push(m+"type="+encodeURIComponent("_badmap")),A}}function oi(a){this.l=a.Ub||null,this.j=a.eb||!1}function Rs(a,l){ke.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function pf(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}function ai(a){a.readyState=4,a.l=null,a.j=null,a.v=null,ui(a)}function ui(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function _f(a){let l="";return Q(a,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function Su(a,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=_f(d),"string"==typeof a?null!=d&&encodeURIComponent(String(d)):he(a,l,d))}function _e(a){ke.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=si.prototype).add=function(a,l){Ut(this),this.i=null,a=tr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this},r.forEach=function(a,l){Ut(this),this.g.forEach(function(d,m){d.forEach(function(A){a.call(l,A,m,this)},this)},this)},r.na=function(){Ut(this);const a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){const A=a[m];for(let V=0;V<A.length;V++)d.push(l[m])}return d},r.V=function(a){Ut(this);let l=[];if("string"==typeof a)mf(this,a)&&(l=l.concat(this.g.get(tr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},r.set=function(a,l){return Ut(this),this.i=null,mf(this,a=tr(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},r.get=function(a,l){return a&&0<(a=this.V(a)).length?String(a[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];const V=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var A=V;""!==M[m]&&(A+="="+encodeURIComponent(String(M[m]))),a.push(A)}}return this.i=a.join("&")},x(oi,_u),oi.prototype.g=function(){return new Rs(this.l,this.j)},oi.prototype.i=function(a){return function(){return a}}({}),x(Rs,ke),(r=Rs.prototype).open=function(a,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,ui(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ai(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ui(this)),this.g&&(this.readyState=3,ui(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;pf(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?ai(this):ui(this),3==this.readyState&&pf(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,ai(this))},r.Qa=function(a){this.g&&(this.response=a,ai(this))},r.ga=function(){this.g&&ai(this)},r.setRequestHeader=function(a,l){this.u.append(a,l)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],l=this.h.entries();for(var d=l.next();!d.done;)a.push((d=d.value)[0]+": "+d[1]),d=l.next();return a.join("\r\n")},Object.defineProperty(Rs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),x(_e,ke);var Xy=/^https?$/i,Zy=["POST","PUT"];function yf(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,If(a),Ps(a)}function If(a){a.A||(a.A=!0,Be(a,"complete"),Be(a,"error"))}function Tf(a){if(a.h&&typeof o<"u"&&(!a.v[1]||4!=It(a)||2!=a.Z()))if(a.u&&4==It(a))Ud(a.Ea,0,a);else if(Be(a,"readystatechange"),4==It(a)){a.h=!1;try{const M=a.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=0===M){var A=String(a.D).match(lf)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),m=!Xy.test(A?A.toLowerCase():"")}d=m}if(d)Be(a,"complete"),Be(a,"success");else{a.m=6;try{var V=2<It(a)?a.g.statusText:""}catch{V=""}a.l=V+" ["+a.Z()+"]",If(a)}}finally{Ps(a)}}}function Ps(a,l){if(a.g){Ef(a);const d=a.g,m=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||Be(a,"ready");try{d.onreadystatechange=m}catch{}}}function Ef(a){a.I&&(u.clearTimeout(a.I),a.I=null)}function It(a){return a.g?a.g.readyState:0}function vf(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function ci(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function Af(a){this.Aa=0,this.i=[],this.j=new ti,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ci("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ci("baseRetryDelayMs",5e3,a),this.cb=ci("retryDelaySeedMs",1e4,a),this.Wa=ci("forwardChannelMaxRetries",2,a),this.wa=ci("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new rf(a&&a.concurrentRequestLimit),this.Da=new Jy,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Vu(a){if(wf(a),3==a.G){var l=a.U++,d=yt(a.I);if(he(d,"SID",a.K),he(d,"RID",l),he(d,"TYPE","terminate"),li(a,d),(l=new qt(a,a.j,l)).L=2,l.v=ws(yt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=Nf(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Es(l)}Cf(a)}function Ss(a){a.g&&(xu(a),a.g.cancel(),a.g=null)}function wf(a){Ss(a),a.u&&(u.clearTimeout(a.u),a.u=null),bs(a),a.h.cancel(),a.s&&("number"==typeof a.s&&u.clearTimeout(a.s),a.s=null)}function Vs(a){if(!sf(a.h)&&!a.s){a.s=!0;var l=a.Ga;$r||Fd(),Wr||($r(),Wr=!0),au.add(l,a),a.B=0}}function Rf(a,l){var d;d=l?l.l:a.U++;const m=yt(a.I);he(m,"SID",a.K),he(m,"RID",d),he(m,"AID",a.T),li(a,m),a.m&&a.o&&Su(m,a.m,a.o),d=new qt(a,a.j,d,a.B+1),null===a.m&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=Pf(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Pu(a.h,d),vu(d,m,l)}function li(a,l){a.H&&Q(a.H,function(d,m){he(l,m,d)}),a.l&&cf({},function(d,m){he(l,m,d)})}function Pf(a,l,d){d=Math.min(a.i.length,d);var m=a.l?_(a.l.Na,a.l,a):null;e:{var A=a.i;let V=-1;for(;;){const M=["count="+d];-1==V?0<d?(V=A[0].g,M.push("ofs="+V)):V=0:M.push("ofs="+V);let se=!0;for(let Ve=0;Ve<d;Ve++){let Z=A[Ve].g;const Fe=A[Ve].map;if(Z-=V,0>Z)V=Math.max(0,A[Ve].g-100),se=!1;else try{Yy(Fe,M,"req"+Z+"_")}catch{m&&m(Fe)}}if(se){m=M.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,m}function Sf(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;$r||Fd(),Wr||($r(),Wr=!0),au.add(l,a),a.v=0}}function bu(a){return!(a.g||a.u||3<=a.v||(a.Y++,a.u=ei(_(a.Fa,a),xf(a,a.v)),a.v++,0))}function xu(a){null!=a.A&&(u.clearTimeout(a.A),a.A=null)}function Vf(a){a.g=new qt(a,a.j,"rpc",a.Y),null===a.m&&(a.g.H=a.o),a.g.O=0;var l=yt(a.qa);he(l,"RID","rpc"),he(l,"SID",a.K),he(l,"AID",a.T),he(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&he(l,"TO",a.ja),he(l,"TYPE","xmlhttp"),li(a,l),a.m&&a.o&&Su(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=ws(yt(l)),d.m=null,d.P=!0,ef(d,a)}function bs(a){null!=a.C&&(u.clearTimeout(a.C),a.C=null)}function bf(a,l){var d=null;if(a.g==l){bs(a),xu(a),a.g=null;var m=2}else{if(!Ru(a.h,l))return;d=l.D,af(a.h,l),m=1}if(0!=a.G)if(l.o)if(1==m){d=l.m?l.m.length:0,l=Date.now()-l.F;var A=a.B;Be(m=ys(),new Jd(m,d)),Vs(a)}else Sf(a);else if(3==(A=l.s)||0==A&&0<l.X||!(1==m&&function tI(a,l){return!(of(a.h)>=a.h.j-(a.s?1:0)||(a.s?(a.i=l.D.concat(a.i),0):1==a.G||2==a.G||a.B>=(a.Va?0:a.Wa)||(a.s=ei(_(a.Ga,a,l),xf(a,a.B)),a.B++,0)))}(a,l)||2==m&&bu(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),A){case 1:gn(a,5);break;case 4:gn(a,10);break;case 3:gn(a,6);break;default:gn(a,2)}}function xf(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function gn(a,l){if(a.j.info("Error code "+l),2==l){var d=_(a.fb,a),m=a.Xa;const A=!m;m=new mn(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||vs(m,"https"),ws(m),A?function Wy(a,l){const d=new ti;if(u.Image){const m=new Image;m.onload=R(Gt,d,"TestLoadImage: loaded",!0,l,m),m.onerror=R(Gt,d,"TestLoadImage: error",!1,l,m),m.onabort=R(Gt,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=R(Gt,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}(m.toString(),d):function Hy(a,l){new ti;const m=new AbortController,A=setTimeout(()=>{m.abort(),Gt(0,0,!1,l)},1e4);fetch(a,{signal:m.signal}).then(V=>{clearTimeout(A),Gt(0,0,!!V.ok,l)}).catch(()=>{clearTimeout(A),Gt(0,0,!1,l)})}(m.toString(),d)}else qe(2);a.G=0,a.l&&a.l.sa(l),Cf(a),wf(a)}function Cf(a){if(a.G=0,a.ka=[],a.l){const l=uf(a.h);(0!=l.length||0!=a.i.length)&&(D(a.ka,l),D(a.ka,a.i),a.h.i.length=0,k(a.i),a.i.length=0),a.l.ra()}}function Df(a,l,d){var m=d instanceof mn?yt(d):new mn(d);if(""!=m.g)l&&(m.g=l+"."+m.g),As(m,m.s);else{var A=u.location;m=A.protocol,l=l?l+"."+A.hostname:A.hostname,A=+A.port;var V=new mn(null);m&&vs(V,m),l&&(V.g=l),A&&As(V,A),d&&(V.l=d),m=V}return l=a.ya,(d=a.D)&&l&&he(m,d,l),he(m,"VER",a.la),li(a,m),m}function Nf(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new _e(a.Ca&&!a.pa?new oi({eb:d}):a.pa)).Ha(a.J),l}function kf(){}function xs(){}function $e(a,l){ke.call(this),this.g=new Af(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!z(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!z(l)&&(this.g.D=l,null!==(a=this.h)&&l in a&&l in(a=this.h)&&delete a[l]),this.j=new nr(this)}function Ff(a){yu.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(const d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=null!==l&&a in l?l[a]:void 0),this.data=l}else this.data=a}function Mf(){Iu.call(this),this.status=1}function nr(a){this.g=a}(r=_e.prototype).Ha=function(a){this.J=a},r.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Tu.g(),this.v=function jd(a){return a.h||(a.h=a.i())}(this.o?this.o:Tu),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(V){return void yf(this,V)}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)d.set(A,m[A]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const V of m.keys())d.set(V,m.get(V))}m=Array.from(d.keys()).find(V=>"content-type"==V.toLowerCase()),A=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Zy,l,void 0))||m||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[V,M]of d)this.g.setRequestHeader(V,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ef(this),this.u=!0,this.g.send(a),this.u=!1}catch(V){yf(this,V)}},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Be(this,"complete"),Be(this,"abort"),Ps(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ps(this,!0)),_e.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Tf(this):this.bb())},r.bb=function(){Tf(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<It(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&0==l.indexOf(a)&&(l=l.substring(a.length)),Cy(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=Af.prototype).la=8,r.G=1,r.connect=function(a,l,d,m){qe(0),this.W=a,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=Df(this,null,this.W),Vs(this)},r.Ga=function(a){if(this.s)if(this.s=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const A=new qt(this,this.j,a);let V=this.o;if(this.S&&(V?(V=p(V),E(V,this.S)):V=this.S),null!==this.m||this.O||(A.H=V,V=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(l+=m)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Pf(this,A,l),he(d=yt(this.I),"RID",a),he(d,"CVER",22),this.D&&he(d,"X-HTTP-Session-Id",this.D),li(this,d),V&&(this.O?l="headers="+encodeURIComponent(String(_f(V)))+"&"+l:this.m&&Su(d,this.m,V)),Pu(this.h,A),this.Ua&&he(d,"TYPE","init"),this.P?(he(d,"$req",l),he(d,"SID","null"),A.T=!0,vu(A,d,null)):vu(A,d,l),this.G=2}}else 3==this.G&&(a?Rf(this,a):0==this.i.length||sf(this.h)||Rf(this))},r.Fa=function(){if(this.u=null,Vf(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=ei(_(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qe(10),Ss(this),Vf(this))},r.Za=function(){null!=this.C&&(this.C=null,Ss(this),bu(this),qe(19))},r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=kf.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},xs.prototype.g=function(a,l){return new $e(a,l)},x($e,ke),$e.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},$e.prototype.close=function(){Vu(this.g)},$e.prototype.o=function(a){var l=this.g;if("string"==typeof a){var d={};d.__data__=a,a=d}else this.u&&((d={}).__data__=pu(a),a=d);l.i.push(new Ly(l.Ya++,a)),3==l.G&&Vs(l)},$e.prototype.N=function(){this.g.l=null,delete this.j,Vu(this.g),delete this.g,$e.aa.N.call(this)},x(Ff,yu),x(Mf,Iu),x(nr,kf),nr.prototype.ua=function(){Be(this.g,"a")},nr.prototype.ta=function(a){Be(this.g,new Ff(a))},nr.prototype.sa=function(a){Be(this.g,new Mf)},nr.prototype.ra=function(){Be(this.g,"b")},xs.prototype.createWebChannel=xs.prototype.g,$e.prototype.send=$e.prototype.o,$e.prototype.open=$e.prototype.m,$e.prototype.close=$e.prototype.close,zu=at.createWebChannelTransport=function(){return new xs},Gu=at.getStatEventTarget=function(){return ys()},Uu=at.Event=dn,Fs=at.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Is.NO_ERROR=0,Is.TIMEOUT=8,Is.HTTP_ERROR=6,gi=at.ErrorCode=Is,Yd.COMPLETE="complete",qu=at.EventType=Yd,Qd.EventType=Xr,Xr.OPEN="a",Xr.CLOSE="b",Xr.ERROR="c",Xr.MESSAGE="d",ke.prototype.listen=ke.prototype.K,ir=at.WebChannel=Qd,Bu=at.FetchXmlHttpFactory=oi,_e.prototype.listenOnce=_e.prototype.L,_e.prototype.getLastError=_e.prototype.Ka,_e.prototype.getLastErrorCode=_e.prototype.Ba,_e.prototype.getStatus=_e.prototype.Z,_e.prototype.getResponseJson=_e.prototype.Oa,_e.prototype.getResponseText=_e.prototype.oa,_e.prototype.send=_e.prototype.ea,_e.prototype.setWithCredentials=_e.prototype.Ha,Lu=at.XhrIo=_e}).apply(typeof mi<"u"?mi:typeof self<"u"?self:typeof window<"u"?window:{});const Ku="@firebase/firestore";class Ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ae.UNAUTHENTICATED=new Ae(null),Ae.GOOGLE_CREDENTIALS=new Ae("google-credentials-uid"),Ae.FIRST_PARTY=new Ae("first-party-uid"),Ae.MOCK_USER=new Ae("mock-user");let pn="10.12.5";const Tt=new Xe.Vy("@firebase/firestore");function _n(){return Tt.logLevel}function N(r,...e){if(Tt.logLevel<=Xe.$b.DEBUG){const t=e.map(Ms);Tt.debug(`Firestore (${pn}): ${r}`,...t)}}function ye(r,...e){if(Tt.logLevel<=Xe.$b.ERROR){const t=e.map(Ms);Tt.error(`Firestore (${pn}): ${r}`,...t)}}function Ue(r,...e){if(Tt.logLevel<=Xe.$b.WARN){const t=e.map(Ms);Tt.warn(`Firestore (${pn}): ${r}`,...t)}}function Ms(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function L(r="Unexpected state"){const e=`FIRESTORE (${pn}) INTERNAL ASSERTION FAILED: `+r;throw ye(e),new Error(e)}function q(r,e){r||L()}function F(r,e){return r}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends ee.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ee{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ju{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class $f{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ae.UNAUTHENTICATED))}shutdown(){}}class Wf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Hf{constructor(e){this.t=e,this.currentUser=Ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let o=new Ee;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ee,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=o;e.enqueueRetryable((0,b.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ee)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q("string"==typeof n.accessToken),new ju(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return q(null===e||"string"==typeof e),new Ae(e)}}class Jf{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ae.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Yf{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Jf(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Qu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xf{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q("string"==typeof t.token),this.R=t.token,new Qu(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Zf(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class $u{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Zf(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function j(r,e){return r<e?-1:r>e?1:0}function yn(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Wu(r){return r+"\0"}class de{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return de.fromMillis(Date.now())}static fromDate(e){return de.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new de(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?j(this.nanoseconds,e.nanoseconds):j(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class G{constructor(e){this.timestamp=e}static fromTimestamp(e){return new G(e)}static min(){return new G(new de(0,0))}static max(){return new G(new de(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class sr{constructor(e,t,n){void 0===t?t=0:t>e.length&&L(),void 0===n?n=e.length-t:n>e.length-t&&L(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===sr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sr?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class H extends sr{construct(e,t,n){return new H(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new H(t)}static emptyPath(){return new H([])}}const em=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends sr{construct(e,t,n){return new ue(e,t,n)}static isValidIdentifier(e){return em.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new C(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new C(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new C(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(o=!o,i++):"."!==u||o?(n+=u,i++):(s(),i++)}if(s(),o)throw new C(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ue(t)}static emptyPath(){return new ue([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(H.fromString(e))}static fromName(e){return new O(H.fromString(e).popFirst(5))}static empty(){return new O(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===H.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return H.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new H(e.slice()))}}class In{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Os(r){return r.fields.find(e=>2===e.kind)}function Kt(r){return r.fields.filter(e=>2!==e.kind)}In.UNKNOWN_ID=-1;class jt{constructor(e,t){this.fieldPath=e,this.kind=t}}class Tn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Tn(0,je.min())}}function Hu(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=G.fromTimestamp(1e9===n?new de(t+1,0):new de(t,n));return new je(i,O.empty(),e)}function Ju(r){return new je(r.readTime,r.key,-1)}class je{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new je(G.min(),O.empty(),-1)}static max(){return new je(G.max(),O.empty(),-1)}}function Ls(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(r.documentKey,e.documentKey),0!==t?t:j(r.largestBatchId,e.largestBatchId))}const Yu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Xu{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Et(r){return Bs.apply(this,arguments)}function Bs(){return(Bs=(0,b.A)(function*(r){if(r.code!==S.FAILED_PRECONDITION||r.message!==Yu)throw r;N("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class w{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new w((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof w?t:w.resolve(t)}catch(t){return w.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):w.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):w.reject(t)}static resolve(e){return new w((t,n)=>{t(e)})}static reject(e){return new w((t,n)=>{n(e)})}static waitFor(e){return new w((t,n)=>{let i=0,s=0,o=!1;e.forEach(u=>{++i,u.next(()=>{++s,o&&s===i&&t()},c=>n(c))}),o=!0,s===i&&t()})}static or(e){let t=w.resolve(!1);for(const n of e)t=t.next(i=>i?w.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new w((n,i)=>{const s=e.length,o=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{o[h]=f,++u,u===s&&n(o)},f=>i(f))}})}static doWhile(e,t){return new w((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class pi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ee,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new or(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=qs(n.target.error);this.V.reject(new or(e,i))}}static open(e,t,n,i){try{return new pi(t,e.transaction(i,n))}catch(s){throw new or(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new im(t)}}class Ze{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Ze.S((0,ee.ZQ)())&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),Qt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ee.zW)())return!1;if(Ze.C())return!0;const e=(0,ee.ZQ)(),t=Ze.S(e),n=0<t&&t<10,i=Zu(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,b.A)(function*(){return t.db||(N("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{n(o.target.result)},s.onblocked=()=>{i(new or(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const u=o.target.error;i("VersionError"===u.name?new C(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new C(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new or(e,u))},s.onupgradeneeded=o=>{N("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.O(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{N("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,b.A)(function*(){const o="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.M(e);const c=pi.open(s.db,e,o?"readonly":"readwrite",n),h=i(c).next(f=>(c.g(),f)).catch(f=>(c.abort(f),w.reject(f))).toPromise();return h.catch(()=>{}),yield c.m,h}catch(c){const h=c,f="FirebaseError"!==h.name&&u<3;if(N("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function Zu(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class rm{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Qt(this.B.delete())}}class or extends C{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function vt(r){return"IndexedDbTransactionError"===r.name}class im{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(N("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Qt(n)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),Qt(this.store.add(e))}get(e){return Qt(this.store.get(e)).next(t=>(void 0===t&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),Qt(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),Qt(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new w((o,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{const s=this.cursor(n),o=[];return this.W(s,(u,c)=>{o.push(c)}).next(()=>o)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new w((i,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{i(o.target.result)}})}j(e,t){N("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,o,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new w((n,i)=>{t.onerror=s=>{const o=qs(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(u=>{u?o.continue():n()}):n()}})}W(e,t){const n=[];return new w((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const u=o.target.result;if(!u)return void i();const c=new rm(u),h=t(u.primaryKey,u.value,c);if(h instanceof w){const f=h.catch(g=>(c.done(),w.reject(g)));n.push(f)}c.isDone?i():null===c.K?u.continue():u.continue(c.K)}}).next(()=>w.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Qt(r){return new w((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=qs(n.target.error);t(i)}})}let ec=!1;function qs(r){const e=Ze.S((0,ee.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ec||(ec=!0,setTimeout(()=>{throw n},0)),n}}return r}class sm{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;N("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,b.A)(function*(){t.task=null;try{N("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){vt(n)?N("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield Et(n)}yield t.X(6e4)}))}}class om{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,b.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return w.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!n.has(o))return N("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(u=>{i-=u,n.add(o)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(u=>(N("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const o=Ju(s);Ls(o,n)>0&&(n=o)}),new je(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Qe=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function ar(r){return null==r}function ur(r){return 0===r&&1/r==-1/0}function tc(r){return"number"==typeof r&&Number.isInteger(r)&&!ur(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function be(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=nc(e)),e=am(r.get(t),e);return nc(e)}function am(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function nc(r){return r+"\x01\x01"}function et(r){const e=r.length;if(q(e>=2),2===e)return q("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),H.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const o=r.indexOf("\x01",s);switch((o<0||o>t)&&L(),r.charAt(o+1)){case"\x01":const u=r.substring(s,o);let c;0===i.length?c=u:(i+=u,c=i,i=""),n.push(c);break;case"\x10":i+=r.substring(s,o),i+="\0";break;case"\x11":i+=r.substring(s,o+1);break;default:L()}s=o+2}return new H(n)}const rc=["userId","batchId"];function _i(r,e){return[r,be(e)]}function ic(r,e,t){return[r,be(e),t]}const um={},cm=["prefixPath","collectionGroup","readTime","documentId"],lm=["prefixPath","collectionGroup","documentId"],hm=["collectionGroup","readTime","prefixPath","documentId"],dm=["canonicalId","targetId"],fm=["targetId","path"],mm=["path","targetId"],gm=["collectionId","parent"],pm=["indexId","uid"],_m=["uid","sequenceNumber"],ym=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Im=["indexId","uid","orderedDocumentKey"],Tm=["userId","collectionPath","documentId"],Em=["userId","collectionPath","largestBatchId"],vm=["userId","collectionGroup","largestBatchId"],sc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Am=[...sc,"documentOverlays"],oc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ac=oc,Us=[...ac,"indexConfiguration","indexState","indexEntries"],wm=Us,Rm=[...Us,"globals"];class Gs extends Xu{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function ve(r,e){const t=F(r);return Ze.F(t._e,e)}function uc(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function At(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function lc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class ae{constructor(e,t){this.comparator=e,this.root=t||Re.EMPTY}insert(e,t){return new ae(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Re.BLACK,null,null))}remove(e){return new ae(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Re.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yi(this.root,e,this.comparator,!1)}getReverseIterator(){return new yi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yi(this.root,e,this.comparator,!0)}}class yi{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Re{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Re.RED,this.left=null!=i?i:Re.EMPTY,this.right=null!=s?s:Re.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Re(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Re.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Re.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();const e=this.left.check();if(e!==this.right.check())throw L();return e+(this.isRed()?0:1)}}Re.EMPTY=null,Re.RED=!0,Re.BLACK=!1,Re.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Re(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ne{constructor(e){this.comparator=e,this.data=new ae(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new hc(this.data.getIterator())}getIteratorFrom(e){return new hc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ne)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ne(this.comparator);return t.data=e,t}}class hc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function En(r){return r.hasNext()?r.getNext():void 0}class Ge{constructor(e){this.fields=e,e.sort(ue.comparator)}static empty(){return new Ge([])}unionWith(e){let t=new ne(ue.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ge(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class dc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ge{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new dc("Invalid base64 string: "+s):s}}(e);return new ge(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new ge(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return j(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ge.EMPTY_BYTE_STRING=new ge("");const Sm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ut(r){if(q(!!r),"string"==typeof r){let e=0;const t=Sm.exec(r);if(q(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:pe(r.seconds),nanos:pe(r.nanos)}}function pe(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function ct(r){return"string"==typeof r?ge.fromBase64String(r):ge.fromUint8Array(r)}function Ii(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ti(r){const e=r.mapValue.fields.__previous_value__;return Ii(e)?Ti(e):e}function cr(r){const e=ut(r.mapValue.fields.__local_write_time__.timestampValue);return new de(e.seconds,e.nanos)}class Vm{constructor(e,t,n,i,s,o,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}class wt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new wt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof wt&&e.projectId===this.projectId&&e.database===this.database}}const Rt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ei={nullValue:"NULL_VALUE"};function Pt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ii(r)?4:pc(r)?9007199254740991:10:L()}function tt(r,e){if(r===e)return!0;const t=Pt(r);if(t!==Pt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return cr(r).isEqual(cr(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=ut(i.timestampValue),u=ut(s.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,ct(r.bytesValue).isEqual(ct(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return pe(i.geoPointValue.latitude)===pe(s.geoPointValue.latitude)&&pe(i.geoPointValue.longitude)===pe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return pe(i.integerValue)===pe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=pe(i.doubleValue),u=pe(s.doubleValue);return o===u?ur(o)===ur(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return yn(r.arrayValue.values||[],e.arrayValue.values||[],tt);case 10:return function(i,s){const o=i.mapValue.fields||{},u=s.mapValue.fields||{};if(uc(o)!==uc(u))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(void 0===u[c]||!tt(o[c],u[c])))return!1;return!0}(r,e);default:return L()}var s}function lr(r,e){return void 0!==(r.values||[]).find(t=>tt(t,e))}function St(r,e){if(r===e)return 0;const t=Pt(r),n=Pt(e);if(t!==n)return j(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return j(r.booleanValue,e.booleanValue);case 2:return function(s,o){const u=pe(s.integerValue||s.doubleValue),c=pe(o.integerValue||o.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return fc(r.timestampValue,e.timestampValue);case 4:return fc(cr(r),cr(e));case 5:return j(r.stringValue,e.stringValue);case 6:return function(s,o){const u=ct(s),c=ct(o);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){const u=s.split("/"),c=o.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=j(u[h],c[h]);if(0!==f)return f}return j(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){const u=j(pe(s.latitude),pe(o.latitude));return 0!==u?u:j(pe(s.longitude),pe(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(s,o){const u=s.values||[],c=o.values||[];for(let h=0;h<u.length&&h<c.length;++h){const f=St(u[h],c[h]);if(f)return f}return j(u.length,c.length)}(r.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Rt.mapValue&&o===Rt.mapValue)return 0;if(s===Rt.mapValue)return 1;if(o===Rt.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){const _=j(c[g],f[g]);if(0!==_)return _;const R=St(u[c[g]],h[f[g]]);if(0!==R)return R}return j(c.length,f.length)}(r.mapValue,e.mapValue);default:throw L()}}function fc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return j(r,e);const t=ut(r),n=ut(e),i=j(t.seconds,n.seconds);return 0!==i?i:j(t.nanos,n.nanos)}function vn(r){return zs(r)}function zs(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=ut(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?ct(r.bytesValue).toBase64():"referenceValue"in r?O.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=zs(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of n)s?s=!1:i+=",",i+=`${o}:${zs(t.fields[o])}`;return i+"}"}(r.mapValue):L()}function $t(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Ks(r){return!!r&&"integerValue"in r}function hr(r){return!!r&&"arrayValue"in r}function mc(r){return!!r&&"nullValue"in r}function gc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ai(r){return!!r&&"mapValue"in r}function dr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return At(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=dr(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=dr(r.arrayValue.values[t]);return e}return Object.assign({},r)}function pc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}function bm(r){return"nullValue"in r?Ei:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?$t(wt.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:L()}function xm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?$t(wt.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?Rt:L()}function _c(r,e){const t=St(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function yc(r,e){const t=St(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ai(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=dr(t)}setAll(e){let t=ue.emptyPath(),n={},i=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}o?n[u.lastSegment()]=dr(o):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Ai(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return tt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Ai(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){At(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Pe(dr(this.value))}}function Ic(r){const e=[];return At(r.fields,(t,n)=>{const i=new ue([t]);if(Ai(n)){const s=Ic(n.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ge(e)}class ce{constructor(e,t,n,i,s,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=u}static newInvalidDocument(e){return new ce(e,0,G.min(),G.min(),G.min(),Pe.empty(),0)}static newFoundDocument(e,t,n,i){return new ce(e,1,t,G.min(),n,i,0)}static newNoDocument(e,t){return new ce(e,2,t,G.min(),G.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new ce(e,3,t,G.min(),G.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ce&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ce(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vt{constructor(e,t){this.position=e,this.inclusive=t}}function Tc(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],o=r.position[i];if(n=s.field.isKeyField()?O.comparator(O.fromName(o.referenceValue),t.key):St(o,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Ec(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!tt(r.position[t],e.position[t]))return!1;return!0}class fr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Cm(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class vc{}class J extends vc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Dm(e,t,n):"array-contains"===t?new Fm(e,n):"in"===t?new Vc(e,n):"not-in"===t?new Mm(e,n):"array-contains-any"===t?new Om(e,n):new J(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Nm(e,n):new km(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(St(t,this.value)):null!==t&&Pt(this.value)===Pt(t)&&this.matchesComparison(St(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class te extends vc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new te(e,t)}matches(e){return An(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function An(r){return"and"===r.op}function js(r){return"or"===r.op}function Qs(r){return Ac(r)&&An(r)}function Ac(r){for(const e of r.filters)if(e instanceof te)return!1;return!0}function $s(r){if(r instanceof J)return r.field.canonicalString()+r.op.toString()+vn(r.value);if(Qs(r))return r.filters.map(e=>$s(e)).join(",");{const e=r.filters.map(t=>$s(t)).join(",");return`${r.op}(${e})`}}function wc(r,e){return r instanceof J?(n=r,(i=e)instanceof J&&n.op===i.op&&n.field.isEqual(i.field)&&tt(n.value,i.value)):r instanceof te?function(n,i){return i instanceof te&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,o,u)=>s&&wc(o,i.filters[u]),!0)}(r,e):void L();var n,i}function Rc(r,e){const t=r.filters.concat(e);return te.create(t,r.op)}function Pc(r){return r instanceof J?`${(t=r).field.canonicalString()} ${t.op} ${vn(t.value)}`:r instanceof te?function(t){return t.op.toString()+" {"+t.getFilters().map(Pc).join(" ,")+"}"}(r):"Filter";var t}class Dm extends J{constructor(e,t,n){super(e,t,n),this.key=O.fromName(n.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class Nm extends J{constructor(e,t){super(e,"in",t),this.keys=Sc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class km extends J{constructor(e,t){super(e,"not-in",t),this.keys=Sc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Sc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>O.fromName(n.referenceValue))}class Fm extends J{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hr(t)&&lr(t.arrayValue,this.value)}}class Vc extends J{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&lr(this.value.arrayValue,t)}}class Mm extends J{constructor(e,t){super(e,"not-in",t)}matches(e){if(lr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!lr(this.value.arrayValue,t)}}class Om extends J{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>lr(this.value.arrayValue,n))}}class Lm{constructor(e,t=null,n=[],i=[],s=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=u,this.ue=null}}function Ws(r,e=null,t=[],n=[],i=null,s=null,o=null){return new Lm(r,e,t,n,i,s,o)}function Wt(r){const e=F(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>$s(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),ar(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>vn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>vn(n)).join(",")),e.ue=t}return e.ue}function mr(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Cm(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!wc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Ec(r.startAt,e.startAt)&&Ec(r.endAt,e.endAt)}function wi(r){return O.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function Ri(r,e){return r.filters.filter(t=>t instanceof J&&t.field.isEqual(e))}function bc(r,e,t){let n=Ei,i=!0;for(const s of Ri(r,e)){let o=Ei,u=!0;switch(s.op){case"<":case"<=":o=bm(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,u=!1;break;case"!=":case"not-in":o=Ei}_c({value:n,inclusive:i},{value:o,inclusive:u})<0&&(n=o,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const o=t.position[s];_c({value:n,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(n=o,i=t.inclusive);break}return{value:n,inclusive:i}}function xc(r,e,t){let n=Rt,i=!0;for(const s of Ri(r,e)){let o=Rt,u=!0;switch(s.op){case">=":case">":o=xm(s.value),u=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,u=!1;break;case"!=":case"not-in":o=Rt}yc({value:n,inclusive:i},{value:o,inclusive:u})>0&&(n=o,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const o=t.position[s];yc({value:n,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(n=o,i=t.inclusive);break}return{value:n,inclusive:i}}class lt{constructor(e,t=null,n=[],i=[],s=null,o="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null}}function Cc(r,e,t,n,i,s,o,u){return new lt(r,e,t,n,i,s,o,u)}function wn(r){return new lt(r)}function Dc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Hs(r){return null!==r.collectionGroup}function Rn(r){const e=F(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new ne(ue.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new fr(s,n))}),t.has(ue.keyField().canonicalString())||e.ce.push(new fr(ue.keyField(),n))}return e.ce}function xe(r){const e=F(r);return e.le||(e.le=function kc(r,e){if("F"===r.limitType)return Ws(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new fr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new Vt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Vt(r.startAt.position,r.startAt.inclusive):null;return Ws(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Rn(r))),e.le}function Js(r,e){const t=r.filters.concat([e]);return new lt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Pi(r,e,t){return new lt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function gr(r,e){return mr(xe(r),xe(e))&&r.limitType===e.limitType}function Fc(r){return`${Wt(xe(r))}|lt:${r.limitType}`}function Pn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Pc(i)).join(", ")}]`),ar(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>vn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>vn(i)).join(",")),`Target(${n})`}(xe(r))}; limitType=${r.limitType})`}function pr(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):O.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Rn(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(o,u,c){const h=Tc(o,u,c);return o.inclusive?h<=0:h<0}(n.startAt,Rn(n),i)||n.endAt&&!function(o,u,c){const h=Tc(o,u,c);return o.inclusive?h>=0:h>0}(n.endAt,Rn(n),i)));var n,i}function Mc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Oc(r){return(e,t)=>{let n=!1;for(const i of Rn(r)){const s=Bm(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function Bm(r,e,t){const n=r.field.isKeyField()?O.comparator(e.key,t.key):function(s,o,u){const c=o.data.field(s),h=u.data.field(s);return null!==c&&null!==h?St(c,h):L()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}class ht{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){At(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return lc(this.inner)}size(){return this.innerSize}}const qm=new ae(O.comparator);function ze(){return qm}const Lc=new ae(O.comparator);function _r(...r){let e=Lc;for(const t of r)e=e.insert(t.key,t);return e}function Bc(r){let e=Lc;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function nt(){return yr()}function qc(){return yr()}function yr(){return new ht(r=>r.toString(),(r,e)=>r.isEqual(e))}const Um=new ae(O.comparator),Gm=new ne(O.comparator);function $(...r){let e=Gm;for(const t of r)e=e.add(t);return e}const zm=new ne(j);function Ys(){return zm}function Uc(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ur(e)?"-0":e}}function Gc(r){return{integerValue:""+r}}function zc(r,e){return tc(e)?Gc(e):Uc(r,e)}class Si{constructor(){this._=void 0}}function Km(r,e,t){return r instanceof Sn?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ii(s)&&(s=Ti(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):r instanceof Ht?jc(r,e):r instanceof Jt?Qc(r,e):function(i,s){const o=Kc(i,s),u=$c(o)+$c(i.Pe);return Ks(o)&&Ks(i.Pe)?Gc(u):Uc(i.serializer,u)}(r,e)}function jm(r,e,t){return r instanceof Ht?jc(r,e):r instanceof Jt?Qc(r,e):t}function Kc(r,e){return r instanceof Vn?Ks(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class Sn extends Si{}class Ht extends Si{constructor(e){super(),this.elements=e}}function jc(r,e){const t=Wc(e);for(const n of r.elements)t.some(i=>tt(i,n))||t.push(n);return{arrayValue:{values:t}}}class Jt extends Si{constructor(e){super(),this.elements=e}}function Qc(r,e){let t=Wc(e);for(const n of r.elements)t=t.filter(i=>!tt(i,n));return{arrayValue:{values:t}}}class Vn extends Si{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function $c(r){return pe(r.integerValue||r.doubleValue)}function Wc(r){return hr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Ir{constructor(e,t){this.field=e,this.transform=t}}class $m{constructor(e,t){this.version=e,this.transformResults=t}}class fe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fe}static exists(e){return new fe(void 0,e)}static updateTime(e){return new fe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Vi(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class bi{}function Hc(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new xn(r.key,fe.none()):new bn(r.key,r.data,fe.none());{const t=r.data,n=Pe.empty();let i=new ne(ue.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?n.delete(s):n.set(s,o),i=i.add(s)}return new dt(r.key,n,new Ge(i.toArray()),fe.none())}}function Wm(r,e,t){r instanceof bn?function(i,s,o){const u=i.value.clone(),c=Xc(i.fieldTransforms,s,o.transformResults);u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof dt?function(i,s,o){if(!Vi(i.precondition,s))return void s.convertToUnknownDocument(o.version);const u=Xc(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(Yc(i)),c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Tr(r,e,t,n){return r instanceof bn?function(s,o,u,c){if(!Vi(s.precondition,o))return u;const h=s.value.clone(),f=Zc(s.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof dt?function(s,o,u,c){if(!Vi(s.precondition,o))return u;const h=Zc(s.fieldTransforms,c,o),f=o.data;return f.setAll(Yc(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):(u=t,Vi(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u);var o,u}function Hm(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=Kc(n.transform,i||null);null!=s&&(null===t&&(t=Pe.empty()),t.set(n.field,s))}return t||null}function Jc(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&yn(n,i,(s,o)=>function Qm(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Ht&&i instanceof Ht||n instanceof Jt&&i instanceof Jt?yn(n.elements,i.elements,tt):n instanceof Vn&&i instanceof Vn?tt(n.Pe,i.Pe):n instanceof Sn&&i instanceof Sn);var n,i}(s,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class bn extends bi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class dt extends bi{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Yc(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Xc(r,e,t){const n=new Map;q(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],o=s.transform,u=e.data.field(s.field);n.set(s.field,jm(o,u,t[i]))}return n}function Zc(r,e,t){const n=new Map;for(const i of r){const s=i.transform,o=t.data.field(i.field);n.set(i.field,Km(s,o,e))}return n}class xn extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xs extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Zs{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Wm(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Tr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Tr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=qc();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let u=this.applyToLocalView(o,s.mutatedFields);u=t.has(i.key)?null:u;const c=Hc(o,u);null!==c&&n.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(G.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$())}isEqual(e){return this.batchId===e.batchId&&yn(this.mutations,e.mutations,(t,n)=>Jc(t,n))&&yn(this.baseMutations,e.baseMutations,(t,n)=>Jc(t,n))}}class eo{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){q(e.mutations.length===n.length);let i=function(){return Um}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new eo(e,t,n,i)}}class to{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Jm{constructor(e,t){this.count=e,this.unchangedNames=t}}var Te,X;function tl(r){switch(r){default:return L();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function nl(r){if(void 0===r)return ye("GRPC error has no .code"),S.UNKNOWN;switch(r){case Te.OK:return S.OK;case Te.CANCELLED:return S.CANCELLED;case Te.UNKNOWN:return S.UNKNOWN;case Te.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case Te.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case Te.INTERNAL:return S.INTERNAL;case Te.UNAVAILABLE:return S.UNAVAILABLE;case Te.UNAUTHENTICATED:return S.UNAUTHENTICATED;case Te.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case Te.NOT_FOUND:return S.NOT_FOUND;case Te.ALREADY_EXISTS:return S.ALREADY_EXISTS;case Te.PERMISSION_DENIED:return S.PERMISSION_DENIED;case Te.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case Te.ABORTED:return S.ABORTED;case Te.OUT_OF_RANGE:return S.OUT_OF_RANGE;case Te.UNIMPLEMENTED:return S.UNIMPLEMENTED;case Te.DATA_LOSS:return S.DATA_LOSS;default:return L()}}(X=Te||(Te={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";function rl(){return new TextEncoder}const Ym=new zt([4294967295,4294967295],0);function il(r){const e=rl().encode(r),t=new Ou;return t.update(e),new Uint8Array(t.digest())}function sl(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new zt([t,n],0),new zt([i,s],0)]}class no{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Er(`Invalid padding: ${t}`);if(n<0)throw new Er(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Er(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Er(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=zt.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(zt.fromNumber(n)));return 1===i.compare(Ym)&&(i=new zt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=il(e),[n,i]=sl(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(n,i,s);if(!this.de(o))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new no(s,i,t);return n.forEach(u=>o.insert(u)),o}insert(e){if(0===this.Ie)return;const t=il(e),[n,i]=sl(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(n,i,s);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Er extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class vr{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Ar.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new vr(G.min(),i,new ae(j),ze(),$())}}class Ar{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ar(n,t,$(),$(),$())}}class Ci{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class ol{constructor(e,t){this.targetId=e,this.me=t}}class al{constructor(e,t,n=ge.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class ul{constructor(){this.fe=0,this.ge=ll(),this.pe=ge.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=$(),t=$(),n=$();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:L()}}),new Ar(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=ll()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Xm{constructor(e){this.Le=e,this.Be=new Map,this.ke=ze(),this.qe=cl(),this.Qe=new ae(j)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(wi(s))if(0===n){const o=new O(s.path);this.Ue(t,o,ce.newNoDocument(o,G.min()))}else q(1===n);else{const o=this.Ye(t);if(o!==n){const u=this.Ze(e),c=u?this.Xe(u,e,o):1;0!==c&&(this.je(t),this.Qe=this.Qe.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let o,u;try{o=ct(n).toUint8Array()}catch(c){if(c instanceof dc)return Ue("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new no(o,i,s)}catch(c){return Ue(c instanceof Er?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const o=this.Le.tt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,o)=>{const u=this.Je(o);if(u){if(s.current&&wi(u.target)){const c=new O(u.target.path);null!==this.ke.get(c)||this.it(o,c)||this.Ue(o,c,ce.newNoDocument(c,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let n=$();this.qe.forEach((s,o)=>{let u=!0;o.forEachWhile(c=>{const h=this.Je(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));const i=new vr(e,t,this.Qe,this.ke,n);return this.ke=ze(),this.qe=cl(),this.Qe=new ae(j),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new ul,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ne(j),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||N("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new ul),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function cl(){return new ae(O.comparator)}function ll(){return new ae(O.comparator)}const Zm={asc:"ASCENDING",desc:"DESCENDING"},eg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tg={and:"AND",or:"OR"};class ng{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ro(r,e){return r.useProto3Json||ar(e)?e:{value:e}}function Cn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hl(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function rg(r,e){return Cn(r,e.toTimestamp())}function Ie(r){return q(!!r),G.fromTimestamp(function(t){const n=ut(t);return new de(n.seconds,n.nanos)}(r))}function io(r,e){return so(r,e).canonicalString()}function so(r,e){const t=(i=r,new H(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function dl(r){const e=H.fromString(r);return q(Al(e)),e}function wr(r,e){return io(r.databaseId,e.path)}function rt(r,e){const t=dl(e);if(t.get(1)!==r.databaseId.projectId)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new O(gl(t))}function fl(r,e){return io(r.databaseId,e)}function ml(r){const e=dl(r);return 4===e.length?H.emptyPath():gl(e)}function oo(r){return new H(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function gl(r){return q(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function pl(r,e,t){return{name:wr(r,e),fields:t.value.mapValue.fields}}function _l(r,e,t){const n=rt(r,e.name),i=Ie(e.updateTime),s=e.createTime?Ie(e.createTime):G.min(),o=new Pe({mapValue:{fields:e.fields}}),u=ce.newFoundDocument(n,i,s,o);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Rr(r,e){let t;if(e instanceof bn)t={update:pl(r,e.key,e.value)};else if(e instanceof xn)t={delete:wr(r,e.key)};else if(e instanceof dt)t={update:pl(r,e.key,e.data),updateMask:hg(e.fieldMask)};else{if(!(e instanceof Xs))return L();t={verify:wr(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){const u=o.transform;if(u instanceof Sn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ht)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Jt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Vn)return{fieldPath:o.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:rg(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:L()),t;var s}function ao(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?fe.updateTime(Ie(s.updateTime)):void 0!==s.exists?fe.exists(s.exists):fe.none():fe.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(o,u){let c=null;"setToServerValue"in u?(q("REQUEST_TIME"===u.setToServerValue),c=new Sn):"appendMissingElements"in u?c=new Ht(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new Jt(u.removeAllFromArray.values||[]):"increment"in u?c=new Vn(o,u.increment):L();const h=ue.fromServerFormat(u.fieldPath);return new Ir(h,c)}(r,i)):[];var s;if(e.update){const i=rt(r,e.update.name),s=new Pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ge((e.updateMask.fieldPaths||[]).map(f=>ue.fromServerFormat(f)));return new dt(i,s,o,t,n)}return new bn(i,s,t,n)}if(e.delete){const i=rt(r,e.delete);return new xn(i,t)}if(e.verify){const i=rt(r,e.verify);return new Xs(i,t)}return L()}function yl(r,e){return{documents:[fl(r,e.path)]}}function Di(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=fl(r,i);const s=function(h){if(0!==h.length)return vl(te.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(h){if(0!==h.length)return h.map(f=>{return{field:bt((_=f).field),direction:ug(_.dir)};var _})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=ro(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i};var h}function Tl(r){let e=ml(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){q(1===n);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){const _=El(g);return _ instanceof te&&Qs(_)?_.getFilters():[_]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(_=>{return new fr(Dn((x=_).field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction));var x}));let u=null;t.limit&&(u=function(g){let _;return _="object"==typeof g?g.value:g,ar(_)?null:_}(t.limit));let c=null;var g;t.startAt&&(c=new Vt((g=t.startAt).values||[],!!g.before));let h=null;return t.endAt&&(h=function(g){return new Vt(g.values||[],!g.before)}(t.endAt)),Cc(e,i,o,s,u,"F",c,h)}function El(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Dn(t.unaryFilter.field);return J.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Dn(t.unaryFilter.field);return J.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Dn(t.unaryFilter.field);return J.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Dn(t.unaryFilter.field);return J.create(o,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):void 0!==r.fieldFilter?J.create(Dn((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return te.create(t.compositeFilter.filters.map(n=>El(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(t.compositeFilter.op))}(r):L();var t}function ug(r){return Zm[r]}function cg(r){return eg[r]}function lg(r){return tg[r]}function bt(r){return{fieldPath:r.canonicalString()}}function Dn(r){return ue.fromServerFormat(r.fieldPath)}function vl(r){return r instanceof J?function(t){if("=="===t.op){if(gc(t.value))return{unaryFilter:{field:bt(t.field),op:"IS_NAN"}};if(mc(t.value))return{unaryFilter:{field:bt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(gc(t.value))return{unaryFilter:{field:bt(t.field),op:"IS_NOT_NAN"}};if(mc(t.value))return{unaryFilter:{field:bt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bt(t.field),op:cg(t.op),value:t.value}}}(r):r instanceof te?function(t){const n=t.getFilters().map(i=>vl(i));return 1===n.length?n[0]:{compositeFilter:{op:lg(t.op),filters:n}}}(r):L()}function hg(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Al(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class ft{constructor(e,t,n,i,s=G.min(),o=G.min(),u=ge.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new ft(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class wl{constructor(e){this.ct=e}}function Rl(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ni(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:wr(s=r.ct,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:Cn(s,o.version.toTimestamp()),createTime:Cn(s,o.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Yt(e.version)};else{if(!e.isUnknownDocument())return L();n.unknownDocument={path:t.path.toArray(),version:Yt(e.version)}}var s,o;return n}function Ni(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Yt(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Xt(r){const e=new de(r.seconds,r.nanoseconds);return G.fromTimestamp(e)}function Zt(r,e){const t=(e.baseMutations||[]).map(s=>ao(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>ao(r.ct,s)),i=de.fromMillis(e.localWriteTimeMs);return new Zs(e.batchId,i,t,n)}function Pr(r){const e=Xt(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?Xt(r.lastLimboFreeSnapshotVersion):G.min();let n;return n=void 0!==r.query.documents?(q(1===(s=r.query).documents.length),xe(wn(ml(s.documents[0])))):function(s){return xe(Tl(s))}(r.query),new ft(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,ge.fromBase64String(r.resumeToken));var s}function Pl(r,e){const t=Yt(e.snapshotVersion),n=Yt(e.lastLimboFreeSnapshotVersion);let i;i=wi(e.target)?yl(r.ct,e.target):Di(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Wt(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function uo(r){const e=Tl({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Pi(e,e.limit,"L"):e}function co(r,e){return new to(e.largestBatchId,ao(r.ct,e.overlayMutation))}function Sl(r,e){const t=e.path.lastSegment();return[r,be(e.path.popLast()),t]}function Vl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Yt(n.readTime),documentKey:be(n.documentKey.path),largestBatchId:n.largestBatchId}}class fg{getBundleMetadata(e,t){return bl(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:Xt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return bl(e).put({bundleId:(i=t).id,createTime:Yt(Ie(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return xl(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:uo(s.bundledQuery),readTime:Xt(s.readTime)};var s})}saveNamedQuery(e,t){return xl(e).put({name:(i=t).name,readTime:Yt(Ie(i.readTime)),bundledQuery:i.bundledQuery});var i}}function bl(r){return ve(r,"bundles")}function xl(r){return ve(r,"namedQueries")}class ki{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new ki(e,t.uid||"")}getOverlay(e,t){return Sr(e).get(Sl(this.userId,t)).next(n=>n?co(this.serializer,n):null)}getOverlays(e,t){const n=nt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,o)=>{const u=new to(t,o);i.push(this.ht(e,u))}),w.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(o=>i.add(be(o.getCollectionPath())));const s=[];return i.forEach(o=>{const u=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(Sr(e).j("collectionPathOverlayIndex",u))}),w.waitFor(s)}getOverlaysForCollection(e,t,n){const i=nt(),s=be(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Sr(e).U("collectionPathOverlayIndex",o).next(u=>{for(const c of u){const h=co(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=nt();let o;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Sr(e).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{const g=co(this.serializer,h);s.size()<i||g.largestBatchId===o?(s.set(g.getKey(),g),o=g.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Sr(e).put(function(i,s,o){const[u,c,h]=Sl(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Rr(i.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Sr(r){return ve(r,"documentOverlays")}class mg{Pt(e){return ve(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=null==t?void 0:t.value;return n?ge.fromUint8Array(n):ge.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class en{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(pe(e.integerValue));else if("doubleValue"in e){const n=pe(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),ur(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=ut(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ct(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?pc(e)?this.dt(t,Number.MAX_SAFE_INTEGER):(this.wt(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.St(e.arrayValue,t),this.ft(t)):L()}Vt(e,t){this.dt(t,25),this.bt(e,t)}bt(e,t){t.Rt(e)}wt(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}St(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),O.fromName(e).path.forEach(n=>{this.dt(t,60),this.bt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function gg(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function Cl(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const o=gg(255&n[s]);if(i+=o,8!==o)break}return i}(r);return Math.ceil(e/8)}en.Dt=new en;class pg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.vt(n.value),n=t.next();this.Ft()}Mt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.xt(n.value),n=t.next();this.Ot()}Nt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.vt(n);else if(n<2048)this.vt(960|n>>>6),this.vt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.vt(480|n>>>12),this.vt(128|63&n>>>6),this.vt(128|63&n);else{const i=t.codePointAt(0);this.vt(240|i>>>18),this.vt(128|63&i>>>12),this.vt(128|63&i>>>6),this.vt(128|63&i)}}this.Ft()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.xt(n);else if(n<2048)this.xt(960|n>>>6),this.xt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.xt(480|n>>>12),this.xt(128|63&n>>>6),this.xt(128|63&n);else{const i=t.codePointAt(0);this.xt(240|i>>>18),this.xt(128|63&i>>>12),this.xt(128|63&i>>>6),this.xt(128|63&i)}}this.Ot()}Bt(e){const t=this.kt(e),n=Cl(t);this.qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Qt(e){const t=this.kt(e),n=Cl(t);this.qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Kt(){this.$t(255),this.$t(255)}Ut(){this.Wt(255),this.Wt(255)}reset(){this.position=0}seed(e){this.qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Gt(){return this.buffer.slice(0,this.position)}kt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}vt(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(t)}xt(e){const t=255&e;0===t?(this.Wt(0),this.Wt(255)):255===t?(this.Wt(255),this.Wt(0)):this.Wt(e)}Ft(){this.$t(0),this.$t(1)}Ot(){this.Wt(0),this.Wt(1)}$t(e){this.qt(1),this.buffer[this.position++]=e}Wt(e){this.qt(1),this.buffer[this.position++]=~e}qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class _g{constructor(e){this.zt=e}gt(e){this.zt.Ct(e)}Rt(e){this.zt.Nt(e)}At(e){this.zt.Bt(e)}Et(){this.zt.Kt()}}class yg{constructor(e){this.zt=e}gt(e){this.zt.Mt(e)}Rt(e){this.zt.Lt(e)}At(e){this.zt.Qt(e)}Et(){this.zt.Ut()}}class Vr{constructor(){this.zt=new pg,this.jt=new _g(this.zt),this.Ht=new yg(this.zt)}seed(e){this.zt.seed(e)}Jt(e){return 0===e?this.jt:this.Ht}Gt(){return this.zt.Gt()}reset(){this.zt.reset()}}class tn{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Yt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new tn(this.indexId,this.documentKey,this.arrayValue,n)}}function xt(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=Dl(r.arrayValue,e.arrayValue),0!==t?t:(t=Dl(r.directionalValue,e.directionalValue),0!==t?t:O.comparator(r.documentKey,e.documentKey)))}function Dl(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class Nl{constructor(e){this.Zt=new ne((t,n)=>ue.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Xt=e.orderBy,this.en=[];for(const t of e.filters){const n=t;n.isInequality()?this.Zt=this.Zt.add(n):this.en.push(n)}}get tn(){return this.Zt.size>1}nn(e){if(q(e.collectionGroup===this.collectionId),this.tn)return!1;const t=Os(e);if(void 0!==t&&!this.rn(t))return!1;const n=Kt(e);let i=new Set,s=0,o=0;for(;s<n.length&&this.rn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Zt.size>0){const u=this.Zt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=n[s];if(!this.sn(u,c)||!this.on(this.Xt[o++],c))return!1}++s}for(;s<n.length;++s)if(o>=this.Xt.length||!this.on(this.Xt[o++],n[s]))return!1;return!0}_n(){if(this.tn)return null;let e=new ne(ue.comparator);const t=[];for(const n of this.en)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new jt(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new jt(n.field,0))}for(const n of this.Xt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new jt(n.field,"asc"===n.dir?0:1)));return new In(In.UNKNOWN_ID,this.collectionId,t,Tn.empty())}rn(e){for(const t of this.en)if(this.sn(t,e))return!0;return!1}sn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}on(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function kl(r){var e,t;if(q(r instanceof J||r instanceof te),r instanceof J){if(r instanceof Vc){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>J.create(r.field,"==",s)))||[];return te.create(i,"or")}return r}const n=r.filters.map(i=>kl(i));return te.create(n,r.op)}function Ig(r){if(0===r.getFilters().length)return[];const e=fo(kl(r));return q(Fl(e)),lo(e)||ho(e)?[e]:e.getFilters()}function lo(r){return r instanceof J}function ho(r){return r instanceof te&&Qs(r)}function Fl(r){return lo(r)||ho(r)||function(t){if(t instanceof te&&js(t)){for(const n of t.getFilters())if(!lo(n)&&!ho(n))return!1;return!0}return!1}(r)}function fo(r){if(q(r instanceof J||r instanceof te),r instanceof J)return r;if(1===r.filters.length)return fo(r.filters[0]);const e=r.filters.map(n=>fo(n));let t=te.create(e,r.op);return t=Fi(t),Fl(t)?t:(q(t instanceof te),q(An(t)),q(t.filters.length>1),t.filters.reduce((n,i)=>mo(n,i)))}function mo(r,e){let t;return q(r instanceof J||r instanceof te),q(e instanceof J||e instanceof te),t=r instanceof J?e instanceof J?te.create([r,e],"and"):Ml(r,e):e instanceof J?Ml(e,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),An(i)&&An(s))return Rc(i,s.getFilters());const o=js(i)?i:s,u=js(i)?s:i,c=o.filters.map(h=>mo(h,u));return te.create(c,"or")}(r,e),Fi(t)}function Ml(r,e){if(An(e))return Rc(e,r.getFilters());{const t=e.filters.map(n=>mo(r,n));return te.create(t,"or")}}function Fi(r){if(q(r instanceof J||r instanceof te),r instanceof J)return r;const e=r.getFilters();if(1===e.length)return Fi(e[0]);if(Ac(r))return r;const t=e.map(i=>Fi(i)),n=[];return t.forEach(i=>{i instanceof J?n.push(i):i instanceof te&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:te.create(n,r.op)}class Tg{constructor(){this.an=new go}addToCollectionParentIndex(e,t){return this.an.add(t),w.resolve()}getCollectionParents(e,t){return w.resolve(this.an.getEntries(t))}addFieldIndex(e,t){return w.resolve()}deleteFieldIndex(e,t){return w.resolve()}deleteAllFieldIndexes(e){return w.resolve()}createTargetIndexes(e,t){return w.resolve()}getDocumentsMatchingTarget(e,t){return w.resolve(null)}getIndexType(e,t){return w.resolve(0)}getFieldIndexes(e,t){return w.resolve([])}getNextCollectionGroupToUpdate(e){return w.resolve(null)}getMinOffset(e,t){return w.resolve(je.min())}getMinOffsetFromCollectionGroup(e,t){return w.resolve(je.min())}updateCollectionGroup(e,t,n){return w.resolve()}updateIndexEntries(e,t){return w.resolve()}}class go{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ne(H.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ne(H.comparator)).toArray()}}const Mi=new Uint8Array(0);class Eg{constructor(e,t){this.databaseId=t,this.un=new go,this.cn=new ht(n=>Wt(n),(n,i)=>mr(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.un.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.un.add(t)});const s={collectionId:n,parent:be(i)};return Ol(e).put(s)}return w.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Wu(t),""],!1,!0);return Ol(e).U(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;n.push(et(o.parent))}return n})}addFieldIndex(e,t){const n=br(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const o=kn(e);return s.next(u=>{o.put(Vl(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=br(e),i=kn(e),s=Nn(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=br(e),n=Nn(e),i=kn(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return w.forEach(this.ln(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new Nl(n)._n();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=Nn(e);let i=!0;const s=new Map;return w.forEach(this.ln(t),o=>this.hn(e,o).next(u=>{i&&(i=!!u),s.set(o,u)})).next(()=>{if(i){let o=$();const u=[];return w.forEach(s,(c,h)=>{var U;N("IndexedDbIndexManager",`Using index ${U=c,`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`} to execute ${Wt(t)}`);const f=function(U,K){const Y=Os(K);if(void 0===Y)return null;for(const Q of Ri(U,Y.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(h,c),g=function(U,K){const Y=new Map;for(const Q of Kt(K))for(const T of Ri(U,Q.fieldPath))switch(T.op){case"==":case"in":Y.set(Q.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return Y.set(Q.fieldPath.canonicalString(),T.value),Array.from(Y.values())}return null}(h,c),_=function(U,K){const Y=[];let Q=!0;for(const T of Kt(K)){const p=0===T.kind?bc(U,T.fieldPath,U.startAt):xc(U,T.fieldPath,U.startAt);Y.push(p.value),Q&&(Q=p.inclusive)}return new Vt(Y,Q)}(h,c),R=function(U,K){const Y=[];let Q=!0;for(const T of Kt(K)){const p=0===T.kind?xc(U,T.fieldPath,U.endAt):bc(U,T.fieldPath,U.endAt);Y.push(p.value),Q&&(Q=p.inclusive)}return new Vt(Y,Q)}(h,c),x=this.Pn(c,h,_),k=this.Pn(c,h,R),D=this.In(c,h,g),B=this.Tn(c.indexId,f,x,_.inclusive,k,R.inclusive,D);return w.forEach(B,z=>n.G(z,t.limit).next(U=>{U.forEach(K=>{const Y=O.fromSegments(K.documentKey);o.has(Y)||(o=o.add(Y),u.push(Y))})}))}).next(()=>u)}return w.resolve(null)})}ln(e){let t=this.cn.get(e);return t||(t=0===e.filters.length?[e]:Ig(te.create(e.filters,"and")).map(n=>Ws(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.cn.set(e,t),t)}Tn(e,t,n,i,s,o,u){const c=(null!=t?t.length:1)*Math.max(n.length,s.length),h=c/(null!=t?t.length:1),f=[];for(let g=0;g<c;++g){const _=t?this.En(t[g/h]):Mi,R=this.dn(e,_,n[g%h],i),x=this.An(e,_,s[g%h],o),k=u.map(D=>this.dn(e,_,D,!0));f.push(...this.createRange(R,x,k))}return f}dn(e,t,n,i){const s=new tn(e,O.empty(),t,n);return i?s:s.Yt()}An(e,t,n,i){const s=new tn(e,O.empty(),t,n);return i?s.Yt():s}hn(e,t){const n=new Nl(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const u of s)n.nn(u)&&(!o||u.fields.length>o.fields.length)&&(o=u);return o})}getIndexType(e,t){let n=2;const i=this.ln(t);return w.forEach(i,s=>this.hn(e,s).next(o=>{o?0!==n&&o.fields.length<function(c){let h=new ne(ue.comparator),f=!1;for(const g of c.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?f=!0:h=h.add(_.field));for(const g of c.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Rn(e,t){const n=new Vr;for(const i of Kt(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=n.Jt(i.kind);en.Dt.It(s,o)}return n.Gt()}En(e){const t=new Vr;return en.Dt.It(e,t.Jt(0)),t.Gt()}Vn(e,t){const n=new Vr;return en.Dt.It($t(this.databaseId,t),n.Jt(function(s){const o=Kt(s);return 0===o.length?0:o[o.length-1].kind}(e))),n.Gt()}In(e,t,n){if(null===n)return[];let i=[];i.push(new Vr);let s=0;for(const o of Kt(e)){const u=n[s++];for(const c of i)if(this.mn(t,o.fieldPath)&&hr(u))i=this.fn(i,o,u);else{const h=c.Jt(o.kind);en.Dt.It(u,h)}}return this.gn(i)}Pn(e,t,n){return this.In(e,t,n.position)}gn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Gt();return t}fn(e,t,n){const i=[...e],s=[];for(const o of n.arrayValue.values||[])for(const u of i){const c=new Vr;c.seed(u.Gt()),en.Dt.It(o,c.Jt(t.kind)),s.push(c)}return s}mn(e,t){return!!e.filters.find(n=>n instanceof J&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=br(e),i=kn(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const o=[];return w.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{o.push(function(f,g){const _=g?new Tn(g.sequenceNumber,new je(Xt(g.readTime),new O(et(g.documentKey)),g.largestBatchId)):Tn.empty(),R=f.fields.map(([x,k])=>new jt(ue.fromServerFormat(x),k));return new In(f.indexId,f.collectionGroup,R,_)}(u,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:j(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=br(e),s=kn(e);return this.pn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>w.forEach(u,c=>s.put(Vl(c.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){const n=new Map;return w.forEach(t,(i,s)=>{const o=n.get(i.collectionGroup);return(o?w.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),w.forEach(u,c=>this.yn(e,i,c).next(h=>{const f=this.wn(s,c);return h.isEqual(f)?w.resolve():this.Sn(e,s,c,h,f)}))))})}bn(e,t,n,i){return Nn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Vn(n,t.key),documentKey:t.key.path.toArray()})}Dn(e,t,n,i){return Nn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Vn(n,t.key),t.key.path.toArray()])}yn(e,t,n){const i=Nn(e);let s=new ne(xt);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Vn(n,t)])},(o,u)=>{s=s.add(new tn(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}wn(e,t){let n=new ne(xt);const i=this.Rn(t,e);if(null==i)return n;const s=Os(t);if(null!=s){const o=e.data.field(s.fieldPath);if(hr(o))for(const u of o.arrayValue.values||[])n=n.add(new tn(t.indexId,e.key,this.En(u),i))}else n=n.add(new tn(t.indexId,e.key,Mi,i));return n}Sn(e,t,n,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(c,h,f,g,_){const R=c.getIterator(),x=h.getIterator();let k=En(R),D=En(x);for(;k||D;){let B=!1,z=!1;if(k&&D){const U=f(k,D);U<0?z=!0:U>0&&(B=!0)}else null!=k?z=!0:B=!0;B?(g(D),D=En(x)):z?(_(k),k=En(R)):(k=En(R),D=En(x))}}(i,s,xt,u=>{o.push(this.bn(e,t,n,u))},u=>{o.push(this.Dn(e,t,n,u))}),w.waitFor(o)}pn(e){let t=1;return kn(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,u)=>xt(o,u)).filter((o,u,c)=>!u||0!==xt(o,c[u-1]));const i=[];i.push(e);for(const o of n){const u=xt(o,e),c=xt(o,t);if(0===u)i[0]=e.Yt();else if(u>0&&c<0)i.push(o),i.push(o.Yt());else if(c>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Mi,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Mi,[]]))}return s}Cn(e,t){return xt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ll)}getMinOffset(e,t){return w.mapArray(this.ln(t),n=>this.hn(e,n).next(i=>i||L())).next(Ll)}}function Ol(r){return ve(r,"collectionParents")}function Nn(r){return ve(r,"indexEntries")}function br(r){return ve(r,"indexConfiguration")}function kn(r){return ve(r,"indexState")}function Ll(r){q(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;Ls(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new je(e.readTime,e.documentKey,t)}const Bl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ce{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ce(e,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ql(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let u=0;const c=n.J({range:o},(f,g,_)=>(u++,_.delete()));s.push(c.next(()=>{q(1===u)}));const h=[];for(const f of t.mutations){const g=ic(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return w.waitFor(s).next(()=>h)}function Oi(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw L();e=r.noDocument}return JSON.stringify(e).length}Ce.DEFAULT_COLLECTION_PERCENTILE=10,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ce.DEFAULT=new Ce(41943040,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ce.DISABLED=new Ce(-1,0,0);class Li{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.vn={}}static lt(e,t,n,i){q(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Li(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ct(e).J({index:"userMutationsIndex",range:n},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=Fn(e),o=Ct(e);return o.add({}).next(u=>{q("number"==typeof u);const c=new Zs(u,t,n,i),h=function(R,x,k){const D=k.baseMutations.map(z=>Rr(R.ct,z)),B=k.mutations.map(z=>Rr(R.ct,z));return{userId:x,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:B}}(this.serializer,this.userId,c),f=[];let g=new ne((_,R)=>j(_.canonicalString(),R.canonicalString()));for(const _ of i){const R=ic(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(o.put(h)),f.push(s.put(R,um))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.vn[u]=c.keys()}),w.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return Ct(e).get(t).next(n=>n?(q(n.userId===this.userId),Zt(this.serializer,n)):null)}Fn(e,t){return this.vn[t]?w.resolve(this.vn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.vn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Ct(e).J({index:"userMutationsIndex",range:i},(o,u,c)=>{u.userId===this.userId&&(q(u.batchId>=n),s=Zt(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ct(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ct(e).U("userMutationsIndex",t).next(n=>n.map(i=>Zt(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=_i(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return Fn(e).J({range:i},(o,u,c)=>{const[h,f,g]=o,_=et(f);if(h===this.userId&&t.path.isEqual(_))return Ct(e).get(g).next(R=>{if(!R)throw L();q(R.userId===this.userId),s.push(Zt(this.serializer,R))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne(j);const i=[];return t.forEach(s=>{const o=_i(this.userId,s.path),u=IDBKeyRange.lowerBound(o),c=Fn(e).J({range:u},(h,f,g)=>{const[_,R,x]=h,k=et(R);_===this.userId&&s.path.isEqual(k)?n=n.add(x):g.done()});i.push(c)}),w.waitFor(i).next(()=>this.Mn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=_i(this.userId,n),o=IDBKeyRange.lowerBound(s);let u=new ne(j);return Fn(e).J({range:o},(c,h,f)=>{const[g,_,R]=c,x=et(_);g===this.userId&&n.isPrefixOf(x)?x.length===i&&(u=u.add(R)):f.done()}).next(()=>this.Mn(e,u))}Mn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(Ct(e).get(s).next(o=>{if(null===o)throw L();q(o.userId===this.userId),n.push(Zt(this.serializer,o))}))}),w.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return ql(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.xn(t.batchId)}),w.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}xn(e){delete this.vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return w.resolve();const n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Fn(e).J({range:n},(s,o,u)=>{if(s[0]===this.userId){const c=et(s[1]);i.push(c)}else u.done()}).next(()=>{q(0===i.length)})})}containsKey(e,t){return Ul(e,this.userId,t)}On(e){return Gl(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ul(r,e,t){const n=_i(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let o=!1;return Fn(r).J({range:s,H:!0},(u,c,h)=>{const[f,g,_]=u;f===e&&g===i&&(o=!0),h.done()}).next(()=>o)}function Ct(r){return ve(r,"mutations")}function Fn(r){return ve(r,"documentMutations")}function Gl(r){return ve(r,"mutationQueues")}class nn{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static Ln(){return new nn(0)}static Bn(){return new nn(-1)}}class vg{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.kn(e).next(t=>{const n=new nn(t.highestTargetId);return t.highestTargetId=n.next(),this.qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.kn(e).next(t=>G.fromTimestamp(new de(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.kn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.kn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.qn(e,i)))}addTargetData(e,t){return this.Qn(e,t).next(()=>this.kn(e).next(n=>(n.targetCount+=1,this.Kn(t,n),this.qn(e,n))))}updateTargetData(e,t){return this.Qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Mn(e).delete(t.targetId)).next(()=>this.kn(e)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.qn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return Mn(e).J((o,u)=>{const c=Pr(u);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>w.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Mn(e).J((n,i)=>{const s=Pr(i);t(s)})}kn(e){return zl(e).get("targetGlobalKey").next(t=>(q(null!==t),t))}qn(e,t){return zl(e).put("targetGlobalKey",t)}Qn(e,t){return Mn(e).put(Pl(this.serializer,t))}Kn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.kn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=Wt(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Mn(e).J({range:i,index:"queryTargetsIndex"},(o,u,c)=>{const h=Pr(u);mr(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Dt(e);return t.forEach(o=>{const u=be(o.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,o))}),w.waitFor(i)}removeMatchingKeys(e,t,n){const i=Dt(e);return w.forEach(t,s=>{const o=be(s.path);return w.waitFor([i.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Dt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Dt(e);let s=$();return i.J({range:n,H:!0},(o,u,c)=>{const h=et(o[1]),f=new O(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=be(t.path),i=IDBKeyRange.bound([n],[Wu(n)],!1,!0);let s=0;return Dt(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,u],c,h)=>{0!==o&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Mn(e).get(t).next(n=>n?Pr(n):null)}}function Mn(r){return ve(r,"targets")}function zl(r){return ve(r,"targetGlobal")}function Dt(r){return ve(r,"targetDocuments")}function Kl([r,e],[t,n]){const i=j(r,t);return 0===i?j(e,n):i}class Ag{constructor(e){this.$n=e,this.buffer=new ne(Kl),this.Un=0}Wn(){return++this.Un}Gn(e){const t=[e,this.Wn()];if(this.buffer.size<this.$n)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Kl(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class jl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.zn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.jn(6e4)}stop(){this.zn&&(this.zn.cancel(),this.zn=null)}get started(){return null!==this.zn}jn(e){var t=this;N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.zn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,b.A)(function*(){t.zn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){vt(n)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Et(n)}yield t.jn(3e5)}))}}class wg{constructor(e,t){this.Hn=e,this.params=t}calculateTargetCount(e,t){return this.Hn.Jn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return w.resolve(Qe.oe);const n=new Ag(t);return this.Hn.forEachTarget(e,i=>n.Gn(i.sequenceNumber)).next(()=>this.Hn.Yn(e,i=>n.Gn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Hn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Hn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),w.resolve(Bl)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bl):this.Zn(e,t))}getCacheSize(e){return this.Hn.getCacheSize(e)}Zn(e,t){let n,i,s,o,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,o=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),_n()<=Xe.$b.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-f}ms\n\tDetermined least recently used ${i} in `+(u-o)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${g} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),w.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}}class Rg{constructor(e,t){this.db=e,this.garbageCollector=function Ql(r,e){return new wg(r,e)}(this,t)}Jn(e){const t=this.Xn(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Xn(e){let t=0;return this.Yn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Yn(e,t){return this.er(e,(n,i)=>t(i))}addReference(e,t,n){return Bi(e,n)}removeReference(e,t,n){return Bi(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Bi(e,t)}tr(e,t){return function(i,s){let o=!1;return Gl(i).Y(u=>Ul(i,u,s).next(c=>(c&&(o=!0),w.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.er(e,(o,u)=>{if(u<=t){const c=this.tr(e,o).next(h=>{if(!h)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,G.min()),Dt(e).delete([0,be(o.path)])))});i.push(c)}}).next(()=>w.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Bi(e,t)}er(e,t){const n=Dt(e);let i,s=Qe.oe;return n.J({index:"documentTargetsIndex"},([o,u],{path:c,sequenceNumber:h})=>{0===o?(s!==Qe.oe&&t(new O(et(i)),s),s=h,i=c):s=Qe.oe}).next(()=>{s!==Qe.oe&&t(new O(et(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Bi(r,e){return Dt(r).put((i=r.currentSequenceNumber,{targetId:0,path:be(e.path),sequenceNumber:i}));var i}class $l{constructor(){this.changes=new ht(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ce.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?w.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Pg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return rn(e).put(n)}removeEntry(e,t,n){return rn(e).delete(function(s,o){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ni(o),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.nr(e,n)))}getEntry(e,t){let n=ce.newInvalidDocument(t);return rn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xr(t))},(i,s)=>{n=this.rr(t,s)}).next(()=>n)}ir(e,t){let n={size:0,document:ce.newInvalidDocument(t)};return rn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xr(t))},(i,s)=>{n={document:this.rr(t,s),size:Oi(s)}}).next(()=>n)}getEntries(e,t){let n=ze();return this.sr(e,t,(i,s)=>{const o=this.rr(i,s);n=n.insert(i,o)}).next(()=>n)}_r(e,t){let n=ze(),i=new ae(O.comparator);return this.sr(e,t,(s,o)=>{const u=this.rr(s,o);n=n.insert(s,u),i=i.insert(s,Oi(o))}).next(()=>({documents:n,ar:i}))}sr(e,t,n){if(t.isEmpty())return w.resolve();let i=new ne(Yl);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(xr(i.first()),xr(i.last())),o=i.getIterator();let u=o.getNext();return rn(e).J({index:"documentKeyIndex",range:s},(c,h,f)=>{const g=O.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Yl(u,g)<0;)n(u,null),u=o.getNext();u&&u.isEqual(g)&&(n(u,h),u=o.hasNext()?o.getNext():null),u?f.$(xr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const o=t.path,u=[o.popLast().toArray(),o.lastSegment(),Ni(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return rn(e).U(IDBKeyRange.bound(u,c,!0)).next(h=>{null==s||s.incrementDocumentReadCount(h.length);let f=ze();for(const g of h){const _=this.rr(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(pr(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=ze();const o=Jl(t,n),u=Jl(t,je.max());return rn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,u,!0)},(c,h,f)=>{const g=this.rr(O.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Sg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Hl(e).get("remoteDocumentGlobalKey").next(t=>(q(!!t),t))}nr(e,t){return Hl(e).put("remoteDocumentGlobalKey",t)}rr(e,t){if(t){const n=function dg(r,e){let t;if(e.document)t=_l(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=O.fromSegments(e.noDocument.path),i=Xt(e.noDocument.readTime);t=ce.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return L();{const n=O.fromSegments(e.unknownDocument.path),i=Xt(e.unknownDocument.version);t=ce.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new de(i[0],i[1]);return G.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(G.min()))return n}return ce.newInvalidDocument(e)}}function Wl(r){return new Pg(r)}class Sg extends $l{constructor(e,t){super(),this.ur=e,this.trackRemovals=t,this.cr=new ht(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new ne((s,o)=>j(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const u=this.cr.get(s);if(t.push(this.ur.removeEntry(e,s,u.readTime)),o.isValidDocument()){const c=Rl(this.ur.serializer,o);i=i.add(s.path.popLast());const h=Oi(c);n+=h-u.size,t.push(this.ur.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){const c=Rl(this.ur.serializer,o.convertToNoDocument(G.min()));t.push(this.ur.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.ur.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ur.updateMetadata(e,n)),w.waitFor(t)}getFromCache(e,t){return this.ur.ir(e,t).next(n=>(this.cr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.ur._r(e,t).next(({documents:n,ar:i})=>(i.forEach((s,o)=>{this.cr.set(s,{size:o,readTime:n.get(s).readTime})}),n))}}function Hl(r){return ve(r,"remoteDocumentGlobal")}function rn(r){return ve(r,"remoteDocumentsV14")}function xr(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Jl(r,e){const t=e.documentKey.path.toArray();return[r,Ni(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Yl(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=j(t[s],n[s]),i)return i;return i=j(t.length,n.length),i||(i=j(t[t.length-2],n[n.length-2]),i||j(t[t.length-1],n[n.length-1]))}class Vg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Xl{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Tr(n.mutation,i,Ge.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,$()).next(()=>n))}getLocalViewOfDocuments(e,t,n=$()){const i=nt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=_r();return s.forEach((u,c)=>{o=o.insert(u,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=nt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,$()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,i){let s=ze();const o=yr(),u=yr();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof dt)?s=s.insert(h.key,h):void 0!==f?(o.set(h.key,f.mutation.getFieldMask()),Tr(f.mutation,h,f.mutation.getFieldMask(),de.now())):o.set(h.key,Ge.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var g;return u.set(h,new Vg(f,null!==(g=o.get(h))&&void 0!==g?g:null))}),u))}recalculateAndSaveOverlays(e,t){const n=yr();let i=new ae((o,u)=>o-u),s=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||Ge.empty();f=u.applyToLocalView(h,f),n.set(c,f);const g=(i.get(u.batchId)||$()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{const o=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,g=qc();f.forEach(_=>{if(!s.has(_)){const R=Hc(t.get(_),n.get(_));null!==R&&g.set(_,R),s=s.add(_)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,g))}return w.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return O.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Hs(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var o}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):w.resolve(nt());let u=-1,c=s;return o.next(h=>w.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?w.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,$())).next(f=>({batchId:u,changes:Bc(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(n=>{let i=_r();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let o=_r();return this.indexManager.getCollectionParents(e,s).next(u=>w.forEach(u,c=>{const h=(g=t,_=c.child(s),new lt(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt));var g,_;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,_)=>{o=o.insert(g,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((c,h)=>{const f=h.getKey();null===o.get(f)&&(o=o.insert(f,ce.newInvalidDocument(f)))});let u=_r();return o.forEach((c,h)=>{const f=s.get(c);void 0!==f&&Tr(f.mutation,h,Ge.empty(),de.now()),pr(t,h)&&(u=u.insert(c,h))}),u})}}class bg{constructor(e){this.serializer=e,this.lr=new Map,this.hr=new Map}getBundleMetadata(e,t){return w.resolve(this.lr.get(t))}saveBundleMetadata(e,t){return this.lr.set(t.id,{id:(i=t).id,version:i.version,createTime:Ie(i.createTime)}),w.resolve();var i}getNamedQuery(e,t){return w.resolve(this.hr.get(t))}saveNamedQuery(e,t){return this.hr.set(t.name,{name:(i=t).name,query:uo(i.bundledQuery),readTime:Ie(i.readTime)}),w.resolve();var i}}class xg{constructor(){this.overlays=new ae(O.comparator),this.Pr=new Map}getOverlay(e,t){return w.resolve(this.overlays.get(t))}getOverlays(e,t){const n=nt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),w.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Pr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Pr.delete(n)),w.resolve()}getOverlaysForCollection(e,t,n){const i=nt(),s=t.length+1,o=new O(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return w.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new ae((h,f)=>h-f);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=nt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=nt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return w.resolve(u)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const o=this.Pr.get(i.largestBatchId).delete(n.key);this.Pr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new to(t,n));let s=this.Pr.get(t);void 0===s&&(s=$(),this.Pr.set(t,s)),this.Pr.set(t,s.add(n.key))}}class Cg{constructor(){this.sessionToken=ge.EMPTY_BYTE_STRING}getSessionToken(e){return w.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,w.resolve()}}class po{constructor(){this.Ir=new ne(we.Tr),this.Er=new ne(we.dr)}isEmpty(){return this.Ir.isEmpty()}addReference(e,t){const n=new we(e,t);this.Ir=this.Ir.add(n),this.Er=this.Er.add(n)}Ar(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Rr(new we(e,t))}Vr(e,t){e.forEach(n=>this.removeReference(n,t))}mr(e){const t=new O(new H([])),n=new we(t,e),i=new we(t,e+1),s=[];return this.Er.forEachInRange([n,i],o=>{this.Rr(o),s.push(o.key)}),s}gr(){this.Ir.forEach(e=>this.Rr(e))}Rr(e){this.Ir=this.Ir.delete(e),this.Er=this.Er.delete(e)}pr(e){const t=new O(new H([])),n=new we(t,e),i=new we(t,e+1);let s=$();return this.Er.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new we(e,0),n=this.Ir.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class we{constructor(e,t){this.key=e,this.yr=t}static Tr(e,t){return O.comparator(e.key,t.key)||j(e.yr,t.yr)}static dr(e,t){return j(e.yr,t.yr)||O.comparator(e.key,t.key)}}class Dg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.wr=1,this.Sr=new ne(we.Tr)}checkEmpty(e){return w.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.wr;this.wr++;const o=new Zs(s,t,n,i);this.mutationQueue.push(o);for(const u of i)this.Sr=this.Sr.add(new we(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return w.resolve(o)}lookupMutationBatch(e,t){return w.resolve(this.br(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Dr(t+1),s=i<0?0:i;return w.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return w.resolve(0===this.mutationQueue.length?-1:this.wr-1)}getAllMutationBatches(e){return w.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.Sr.forEachInRange([n,i],o=>{const u=this.br(o.yr);s.push(u)}),w.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne(j);return t.forEach(i=>{const s=new we(i,0),o=new we(i,Number.POSITIVE_INFINITY);this.Sr.forEachInRange([s,o],u=>{n=n.add(u.yr)})}),w.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;O.isDocumentKey(s)||(s=s.child(""));const o=new we(new O(s),0);let u=new ne(j);return this.Sr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.yr)),!0)},o),w.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const i=this.br(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){q(0===this.vr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Sr;return w.forEach(t.mutations,i=>{const s=new we(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Sr=n})}xn(e){}containsKey(e,t){const n=new we(t,0),i=this.Sr.firstAfterOrEqual(n);return w.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return w.resolve()}vr(e,t){return this.Dr(e)}Dr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}br(e){const t=this.Dr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ng{constructor(e){this.Fr=e,this.docs=new ae(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.Fr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return w.resolve(n?n.document.mutableCopy():ce.newInvalidDocument(t))}getEntries(e,t){let n=ze();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():ce.newInvalidDocument(i))}),w.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=ze();const o=t.path,u=new O(o.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Ls(Ju(f),n)<=0||(i.has(f.key)||pr(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return w.resolve(s)}getAllFromCollectionGroup(e,t,n,i){L()}Mr(e,t){return w.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new kg(this)}getSize(e){return w.resolve(this.size)}}class kg extends $l{constructor(e){super(),this.ur=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ur.addEntry(e,i)):this.ur.removeEntry(n)}),w.waitFor(t)}getFromCache(e,t){return this.ur.getEntry(e,t)}getAllFromCache(e,t){return this.ur.getEntries(e,t)}}class Fg{constructor(e){this.persistence=e,this.Or=new ht(t=>Wt(t),mr),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.Nr=0,this.Lr=new po,this.targetCount=0,this.Br=nn.Ln()}forEachTarget(e,t){return this.Or.forEach((n,i)=>t(i)),w.resolve()}getLastRemoteSnapshotVersion(e){return w.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return w.resolve(this.Nr)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),w.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Nr&&(this.Nr=t),w.resolve()}Qn(e){this.Or.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new nn(t),this.highestTargetId=t),e.sequenceNumber>this.Nr&&(this.Nr=e.sequenceNumber)}addTargetData(e,t){return this.Qn(t),this.targetCount+=1,w.resolve()}updateTargetData(e,t){return this.Qn(t),w.resolve()}removeTargetData(e,t){return this.Or.delete(t.target),this.Lr.mr(t.targetId),this.targetCount-=1,w.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Or.forEach((o,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Or.delete(o),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),w.waitFor(s).next(()=>i)}getTargetCount(e){return w.resolve(this.targetCount)}getTargetData(e,t){const n=this.Or.get(t)||null;return w.resolve(n)}addMatchingKeys(e,t,n){return this.Lr.Ar(t,n),w.resolve()}removeMatchingKeys(e,t,n){this.Lr.Vr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),w.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Lr.mr(t),w.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Lr.pr(t);return w.resolve(n)}containsKey(e,t){return w.resolve(this.Lr.containsKey(t))}}class _o{constructor(e,t){this.kr={},this.overlays={},this.qr=new Qe(0),this.Qr=!1,this.Qr=!0,this.Kr=new Cg,this.referenceDelegate=e(this),this.$r=new Fg(this),this.indexManager=new Tg,this.remoteDocumentCache=new Ng(n=>this.referenceDelegate.Ur(n)),this.serializer=new wl(t),this.Wr=new bg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Qr=!1,Promise.resolve()}get started(){return this.Qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new xg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.kr[e.toKey()];return n||(n=new Dg(t,this.referenceDelegate),this.kr[e.toKey()]=n),n}getGlobalsCache(){return this.Kr}getTargetCache(){return this.$r}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Wr}runTransaction(e,t,n){N("MemoryPersistence","Starting transaction:",e);const i=new Mg(this.qr.next());return this.referenceDelegate.Gr(),n(i).next(s=>this.referenceDelegate.zr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}jr(e,t){return w.or(Object.values(this.kr).map(n=>()=>n.containsKey(e,t)))}}class Mg extends Xu{constructor(e){super(),this.currentSequenceNumber=e}}class qi{constructor(e){this.persistence=e,this.Hr=new po,this.Jr=null}static Yr(e){return new qi(e)}get Zr(){if(this.Jr)return this.Jr;throw L()}addReference(e,t,n){return this.Hr.addReference(n,t),this.Zr.delete(n.toString()),w.resolve()}removeReference(e,t,n){return this.Hr.removeReference(n,t),this.Zr.add(n.toString()),w.resolve()}markPotentiallyOrphaned(e,t){return this.Zr.add(t.toString()),w.resolve()}removeTarget(e,t){this.Hr.mr(t.targetId).forEach(i=>this.Zr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Zr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Gr(){this.Jr=new Set}zr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return w.forEach(this.Zr,n=>{const i=O.fromPath(n);return this.Xr(e,i).next(s=>{s||t.removeEntry(i,G.min())})}).next(()=>(this.Jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Xr(e,t).next(n=>{n?this.Zr.delete(t.toString()):this.Zr.add(t.toString())})}Ur(e){return 0}Xr(e,t){return w.or([()=>w.resolve(this.Hr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.jr(e,t)])}}class Og{constructor(e){this.serializer=e}O(e,t,n,i){const s=new pi("createOrUpgrade",t);var c;n<1&&i>=1&&(e.createObjectStore("owner"),(c=e).createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rc,{unique:!0}),c.createObjectStore("documentMutations"),Zl(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=w.resolve();return n<3&&i>=3&&(0!==n&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Zl(e)),o=o.next(()=>function(c){const h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(0!==n&&(o=o.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rc,{unique:!0});const g=h.store("mutations"),_=f.map(R=>g.put(R));return w.waitFor(_)})}(e,s))),o=o.next(()=>{!function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(o=o.next(()=>this.ti(s))),n<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ni(s)))),n<7&&i>=7&&(o=o.next(()=>this.ri(s))),n<8&&i>=8&&(o=o.next(()=>this.ii(e,s))),n<9&&i>=9&&(o=o.next(()=>{!function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(o=o.next(()=>this.si(s))),n<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(o=o.next(()=>{!function(c){const h=c.createObjectStore("documentOverlays",{keyPath:Tm});h.createIndex("collectionPathOverlayIndex",Em,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",vm,{unique:!1})}(e)})),n<13&&i>=13&&(o=o.next(()=>function(c){const h=c.createObjectStore("remoteDocumentsV14",{keyPath:cm});h.createIndex("documentKeyIndex",lm),h.createIndex("collectionGroupIndex",hm)}(e)).next(()=>this.oi(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(o=o.next(()=>this._i(e,s))),n<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:pm}).createIndex("sequenceNumberIndex",_m,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:ym}).createIndex("documentKeyIndex",Im,{unique:!1})}(e))),n<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(o=o.next(()=>{!function(c){c.createObjectStore("globals",{keyPath:"name"})}(e)})),o}ni(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Oi(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ti(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>w.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(u=>w.forEach(u,c=>{q(c.userId===s.userId);const h=Zt(this.serializer,c);return ql(e,s.userId,h).next(()=>{})}))}))}ri(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((o,u)=>{const c=new H(o),h=[0,be(c)];s.push(t.get(h).next(f=>f?w.resolve():t.put({targetId:0,path:be(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>w.waitFor(s))})}ii(e,t){e.createObjectStore("collectionParents",{keyPath:gm});const n=t.store("collectionParents"),i=new go,s=o=>{if(i.add(o)){const u=o.lastSegment(),c=o.popLast();return n.put({collectionId:u,parent:be(c)})}};return t.store("remoteDocuments").J({H:!0},(o,u)=>{const c=new H(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,u,c],h)=>{const f=et(u);return s(f.popLast())}))}si(e){const t=e.store("targets");return t.J((n,i)=>{const s=Pr(i),o=Pl(this.serializer,s);return t.put(o)})}oi(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,o)=>{const u=t.store("remoteDocumentsV14"),c=(g=o,g.document?new O(H.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):L()).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var g;i.push(u.put(h))}).next(()=>w.waitFor(i))}_i(e,t){const n=t.store("mutations"),i=Wl(this.serializer),s=new _o(qi.Yr,this.serializer.ct);return n.U().next(o=>{const u=new Map;return o.forEach(c=>{var h;let f=null!==(h=u.get(c.userId))&&void 0!==h?h:$();Zt(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),w.forEach(u,(c,h)=>{const f=new Ae(h),g=ki.lt(this.serializer,f),_=s.getIndexManager(f),R=Li.lt(f,this.serializer,_,s.referenceDelegate);return new Xl(i,R,g,_).recalculateAndSaveOverlaysForDocumentKeys(new Gs(t,Qe.oe),c).next()})})}}function Zl(r){r.createObjectStore("targetDocuments",{keyPath:fm}).createIndex("documentTargetsIndex",mm,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",dm,{unique:!0}),r.createObjectStore("targetGlobal")}const yo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Io{constructor(e,t,n,i,s,o,u,c,h,f,g=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ai=s,this.window=o,this.document=u,this.ui=h,this.ci=f,this.li=g,this.qr=null,this.Qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.hi=null,this.inForeground=!1,this.Pi=null,this.Ii=null,this.Ti=Number.NEGATIVE_INFINITY,this.Ei=_=>Promise.resolve(),!Io.D())throw new C(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Rg(this,i),this.di=t+"main",this.serializer=new wl(c),this.Ai=new Ze(this.di,this.li,new Og(this.serializer)),this.Kr=new mg,this.$r=new vg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Wl(this.serializer),this.Wr=new fg,this.window&&this.window.localStorage?this.Ri=this.window.localStorage:(this.Ri=null,!1===f&&ye("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Vi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(S.FAILED_PRECONDITION,yo);return this.mi(),this.fi(),this.gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.$r.getHighestSequenceNumber(e))}).then(e=>{this.qr=new Qe(e,this.ui)}).then(()=>{this.Qr=!0}).catch(e=>(this.Ai&&this.Ai.close(),Promise.reject(e)))}pi(e){var t=this;return this.Ei=function(){var n=(0,b.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ai.L(function(){var t=(0,b.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ai.enqueueAndForget((0,b.A)(function*(){t.started&&(yield t.Vi())})))}Vi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Gi(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.yi(e).next(t=>{t||(this.isPrimary=!1,this.ai.enqueueRetryable(()=>this.Ei(!1)))})}).next(()=>this.wi(e)).next(t=>this.isPrimary&&!t?this.Si(e).next(()=>!1):!!t&&this.bi(e).next(()=>!0))).catch(e=>{if(vt(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ai.enqueueRetryable(()=>this.Ei(e)),this.isPrimary=e})}yi(e){return Cr(e).get("owner").next(t=>w.resolve(this.Di(t)))}Ci(e){return Gi(e).delete(this.clientId)}vi(){var e=this;return(0,b.A)(function*(){if(e.isPrimary&&!e.Fi(e.Ti,18e5)){e.Ti=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=ve(n,"clientMetadata");return i.U().next(s=>{const o=e.Mi(s,18e5),u=s.filter(c=>-1===o.indexOf(c));return w.forEach(u,c=>i.delete(c.clientId)).next(()=>u)})}).catch(()=>[]);if(e.Ri)for(const n of t)e.Ri.removeItem(e.xi(n.clientId))}})()}gi(){this.Ii=this.ai.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Vi().then(()=>this.vi()).then(()=>this.gi()))}Di(e){return!!e&&e.ownerId===this.clientId}wi(e){return this.ci?w.resolve(!0):Cr(e).get("owner").next(t=>{if(null!==t&&this.Fi(t.leaseTimestampMs,5e3)&&!this.Oi(t.ownerId)){if(this.Di(t)&&this.networkEnabled)return!0;if(!this.Di(t)){if(!t.allowTabSynchronization)throw new C(S.FAILED_PRECONDITION,yo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Gi(e).U().next(n=>void 0===this.Mi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,b.A)(function*(){e.Qr=!1,e.Ni(),e.Ii&&(e.Ii.cancel(),e.Ii=null),e.Li(),e.Bi(),yield e.Ai.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new Gs(t,Qe.oe);return e.Si(n).next(()=>e.Ci(n))}),e.Ai.close(),e.ki()})()}Mi(e,t){return e.filter(n=>this.Fi(n.updateTimeMs,t)&&!this.Oi(n.clientId))}qi(){return this.runTransaction("getActiveClients","readonly",e=>Gi(e).U().next(t=>this.Mi(t,18e5).map(n=>n.clientId)))}get started(){return this.Qr}getGlobalsCache(){return this.Kr}getMutationQueue(e,t){return Li.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.$r}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Eg(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ki.lt(this.serializer,e)}getBundleCache(){return this.Wr}runTransaction(e,t,n){N("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=17===(c=this.li)?Rm:16===c?wm:15===c?Us:14===c?ac:13===c?oc:12===c?Am:11===c?sc:void L();var c;let o;return this.Ai.runTransaction(e,i,s,u=>(o=new Gs(u,this.qr?this.qr.next():Qe.oe),"readwrite-primary"===t?this.yi(o).next(c=>!!c||this.wi(o)).next(c=>{if(!c)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ai.enqueueRetryable(()=>this.Ei(!1)),new C(S.FAILED_PRECONDITION,Yu);return n(o)}).next(c=>this.bi(o).next(()=>c)):this.Qi(o).next(()=>n(o)))).then(u=>(o.raiseOnCommittedEvent(),u))}Qi(e){return Cr(e).get("owner").next(t=>{if(null!==t&&this.Fi(t.leaseTimestampMs,5e3)&&!this.Oi(t.ownerId)&&!this.Di(t)&&!(this.ci||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(S.FAILED_PRECONDITION,yo)})}bi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Cr(e).put("owner",t)}static D(){return Ze.D()}Si(e){const t=Cr(e);return t.get("owner").next(n=>this.Di(n)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):w.resolve())}Fi(e,t){const n=Date.now();return!(e<n-t||e>n&&(ye(`Detected an update time that is in the future: ${e} > ${n}`),1))}mi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Pi=()=>{this.ai.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Vi()))},this.document.addEventListener("visibilitychange",this.Pi),this.inForeground="visible"===this.document.visibilityState)}Li(){this.Pi&&(this.document.removeEventListener("visibilitychange",this.Pi),this.Pi=null)}fi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.hi=()=>{this.Ni();const t=/(?:Version|Mobile)\/1[456]/;(0,ee.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ai.enterRestrictedMode(!0),this.ai.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.hi))}Bi(){this.hi&&(this.window.removeEventListener("pagehide",this.hi),this.hi=null)}Oi(e){var t;try{const n=null!==(null===(t=this.Ri)||void 0===t?void 0:t.getItem(this.xi(e)));return N("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ye("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Ni(){if(this.Ri)try{this.Ri.setItem(this.xi(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}ki(){if(this.Ri)try{this.Ri.removeItem(this.xi(this.clientId))}catch{}}xi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Cr(r){return ve(r,"owner")}function Gi(r){return ve(r,"clientMetadata")}function To(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Eo{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Ki=n,this.$i=i}static Ui(e,t){let n=$(),i=$();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Eo(e,t.fromCache,n,i)}}class Lg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class eh{constructor(){this.Wi=!1,this.Gi=!1,this.zi=100,this.ji=(0,ee.nr)()?8:Zu((0,ee.ZQ)())>0?6:4}initialize(e,t){this.Hi=e,this.indexManager=t,this.Wi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Yi(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new Lg;return this.Zi(e,t,o).next(u=>{if(s.result=u,this.Gi)return this.Xi(e,t,o,u.size)})}).next(()=>s.result)}Xi(e,t,n,i){return n.documentReadCount<this.zi?(_n()<=Xe.$b.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Pn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.zi,"documents"),w.resolve()):(_n()<=Xe.$b.DEBUG&&N("QueryEngine","Query:",Pn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ji*i?(_n()<=Xe.$b.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Pn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xe(t))):w.resolve())}Ji(e,t){if(Dc(t))return w.resolve(null);let n=xe(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Pi(t,null,"F"),n=xe(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const o=$(...s);return this.Hi.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.es(t,u);return this.ts(t,h,o,c.readTime)?this.Ji(e,Pi(t,null,"F")):this.ns(e,h,t,c)}))})))}Yi(e,t,n,i){return Dc(t)||i.isEqual(G.min())?w.resolve(null):this.Hi.getDocuments(e,n).next(s=>{const o=this.es(t,s);return this.ts(t,o,n,i)?w.resolve(null):(_n()<=Xe.$b.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Pn(t)),this.ns(e,o,t,Hu(i,-1)).next(u=>u))})}es(e,t){let n=new ne(Oc(e));return t.forEach((i,s)=>{pr(e,s)&&(n=n.add(s))}),n}ts(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Zi(e,t,n){return _n()<=Xe.$b.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Pn(t)),this.Hi.getDocumentsMatchingQuery(e,t,je.min(),n)}ns(e,t,n,i){return this.Hi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Bg{constructor(e,t,n,i){this.persistence=e,this.rs=t,this.serializer=i,this.ss=new ae(j),this.os=new ht(s=>Wt(s),mr),this._s=new Map,this.us=e.getRemoteDocumentCache(),this.$r=e.getTargetCache(),this.Wr=e.getBundleCache(),this.cs(n)}cs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Xl(this.us,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.us.setIndexManager(this.indexManager),this.rs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ss))}}function th(r,e,t,n){return new Bg(r,e,t,n)}function nh(r,e){return vo.apply(this,arguments)}function vo(){return(vo=(0,b.A)(function*(r,e){const t=F(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.cs(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const o=[],u=[];let c=$();for(const h of i){o.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({ls:h,removedBatchIds:o,addedBatchIds:u}))})})})).apply(this,arguments)}function rh(r){const e=F(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.$r.getLastRemoteSnapshotVersion(t))}function ih(r,e,t){let n=$(),i=$();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let o=ze();return t.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(G.min())?(e.removeEntry(u,c.readTime),o=o.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(u,c)):N("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{hs:o,Ps:i}})}function Gg(r,e){const t=F(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function On(r,e){const t=F(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.$r.getTargetData(n,e).next(s=>s?(i=s,w.resolve(i)):t.$r.allocateTargetId(n).next(o=>(i=new ft(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.$r.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.ss.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ss=t.ss.insert(n.targetId,n),t.os.set(e,n.targetId)),n})}function Ln(r,e,t){return Ao.apply(this,arguments)}function Ao(){return(Ao=(0,b.A)(function*(r,e,t){const n=F(r),i=n.ss.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!vt(o))throw o;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.ss=n.ss.remove(e),n.os.delete(i.target)})).apply(this,arguments)}function zi(r,e,t){const n=F(r);let i=G.min(),s=$();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,h,f){const g=F(c),_=g.os.get(f);return void 0!==_?w.resolve(g.ss.get(_)):g.$r.getTargetData(h,f)}(n,o,xe(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.$r.getMatchingKeysForTargetId(o,u.targetId).next(c=>{s=c})}).next(()=>n.rs.getDocumentsMatchingQuery(o,e,t?i:G.min(),t?s:$())).next(u=>(ah(n,Mc(e),u),{documents:u,Is:s})))}function sh(r,e){const t=F(r),n=F(t.$r),i=t.ss.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(o=>o?o.target:null))}function oh(r,e){const t=F(r),n=t._s.get(e)||G.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.us.getAllFromCollectionGroup(i,e,Hu(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(ah(t,e,i),i))}function ah(r,e,t){let n=r._s.get(e)||G.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r._s.set(e,n)}function wo(){return(wo=(0,b.A)(function*(r,e,t,n){const i=F(r);let s=$(),o=ze();for(const h of t){const f=e.Ts(h.metadata.name);h.document&&(s=s.add(f));const g=e.Es(h);g.setReadTime(e.ds(h.metadata.readTime)),o=o.insert(f,g)}const u=i.us.newChangeBuffer({trackRemovals:!0}),c=yield On(i,(f=n,xe(wn(H.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>ih(h,u,o).next(f=>(u.apply(h),f)).next(f=>i.$r.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.$r.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.hs,f.Ps)).next(()=>f.hs)))})).apply(this,arguments)}function Kg(r,e){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,b.A)(function*(r,e,t=$()){const n=yield On(r,xe(uo(e.bundledQuery))),i=F(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=Ie(e.readTime);if(n.snapshotVersion.compareTo(o)>=0)return i.Wr.saveNamedQuery(s,e);const u=n.withResumeToken(ge.EMPTY_BYTE_STRING,o);return i.ss=i.ss.insert(u.targetId,u),i.$r.updateTargetData(s,u).next(()=>i.$r.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.$r.addMatchingKeys(s,t,n.targetId)).next(()=>i.Wr.saveNamedQuery(s,e))})})).apply(this,arguments)}function uh(r,e){return`firestore_clients_${r}_${e}`}function ch(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Po(r,e){return`firestore_targets_${r}_${e}`}class Ki{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static As(e,t,n){const i=JSON.parse(n);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new C(i.error.code,i.error.message))),o?new Ki(e,t,i.state,s):(ye("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Rs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Dr{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static As(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new C(n.error.code,n.error.message))),s?new Dr(e,n.state,i):(ye("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Rs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ji{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static As(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=Ys();for(let o=0;i&&o<n.activeTargetIds.length;++o)i=tc(n.activeTargetIds[o]),s=s.add(n.activeTargetIds[o]);return i?new ji(e,s):(ye("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class So{constructor(e,t){this.clientId=e,this.onlineState=t}static As(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new So(t.clientId,t.onlineState):(ye("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Vo{constructor(){this.activeTargetIds=Ys()}Vs(e){this.activeTargetIds=this.activeTargetIds.add(e)}fs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Rs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bo{constructor(e,t,n,i,s){this.window=e,this.ai=t,this.persistenceKey=n,this.gs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ps=this.ys.bind(this),this.ws=new ae(j),this.started=!1,this.Ss=[];const o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.bs=uh(this.persistenceKey,this.gs),this.Ds=`firestore_sequence_number_${this.persistenceKey}`,this.ws=this.ws.insert(this.gs,new Vo),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.vs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Fs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Ms=`firestore_online_state_${this.persistenceKey}`,this.xs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ps)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,b.A)(function*(){const t=yield e.syncEngine.qi();for(const i of t){if(i===e.gs)continue;const s=e.getItem(uh(e.persistenceKey,i));if(s){const o=ji.As(i,s);o&&(e.ws=e.ws.insert(o.clientId,o))}}e.Os();const n=e.storage.getItem(e.Ms);if(n){const i=e.Ns(n);i&&e.Ls(i)}for(const i of e.Ss)e.ys(i);e.Ss=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ds,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Bs(this.ws)}isActiveQueryTarget(e){let t=!1;return this.ws.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ks(e,"pending")}updateMutationState(e,t,n){this.ks(e,t,n),this.qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Po(this.persistenceKey,e));if(n){const i=Dr.As(e,n);i&&(t=i.state)}}return this.Qs.Vs(e),this.Os(),t}removeLocalQueryTarget(e){this.Qs.fs(e),this.Os()}isLocalQueryTarget(e){return this.Qs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Po(this.persistenceKey,e))}updateQueryState(e,t,n){this.Ks(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.$s(e)}notifyBundleLoaded(e){this.Us(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ps),this.removeItem(this.bs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ys(e){var t=this;const n=e;if(n.storageArea===this.storage){if(N("SharedClientState","EVENT",n.key,n.newValue),n.key===this.bs)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ai.enqueueRetryable((0,b.A)(function*(){if(t.started){if(null!==n.key)if(t.Cs.test(n.key)){if(null==n.newValue){const i=t.Ws(n.key);return t.Gs(i,null)}{const i=t.zs(n.key,n.newValue);if(i)return t.Gs(i.clientId,i)}}else if(t.vs.test(n.key)){if(null!==n.newValue){const i=t.js(n.key,n.newValue);if(i)return t.Hs(i)}}else if(t.Fs.test(n.key)){if(null!==n.newValue){const i=t.Js(n.key,n.newValue);if(i)return t.Ys(i)}}else if(n.key===t.Ms){if(null!==n.newValue){const i=t.Ns(n.newValue);if(i)return t.Ls(i)}}else if(n.key===t.Ds){const i=function(o){let u=Qe.oe;if(null!=o)try{const c=JSON.parse(o);q("number"==typeof c),u=c}catch(c){ye("SharedClientState","Failed to read sequence number from WebStorage",c)}return u}(n.newValue);i!==Qe.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.xs){const i=t.Zs(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.Xs(s)))}}else t.Ss.push(n)}))}}get Qs(){return this.ws.get(this.gs)}Os(){this.setItem(this.bs,this.Qs.Rs())}ks(e,t,n){const i=new Ki(this.currentUser,e,t,n),s=ch(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Rs())}qs(e){const t=ch(this.persistenceKey,this.currentUser,e);this.removeItem(t)}$s(e){this.storage.setItem(this.Ms,JSON.stringify({clientId:this.gs,onlineState:e}))}Ks(e,t,n){const i=Po(this.persistenceKey,e),s=new Dr(e,t,n);this.setItem(i,s.Rs())}Us(e){const t=JSON.stringify(Array.from(e));this.setItem(this.xs,t)}Ws(e){const t=this.Cs.exec(e);return t?t[1]:null}zs(e,t){const n=this.Ws(e);return ji.As(n,t)}js(e,t){const n=this.vs.exec(e),i=Number(n[1]);return Ki.As(new Ae(void 0!==n[2]?n[2]:null),i,t)}Js(e,t){const n=this.Fs.exec(e),i=Number(n[1]);return Dr.As(i,t)}Ns(e){return So.As(e)}Zs(e){return JSON.parse(e)}Hs(e){var t=this;return(0,b.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.eo(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Ys(e){return this.syncEngine.no(e.targetId,e.state,e.error)}Gs(e,t){const n=t?this.ws.insert(e,t):this.ws.remove(e),i=this.Bs(this.ws),s=this.Bs(n),o=[],u=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.ro(o,u).then(()=>{this.ws=n})}Ls(e){this.ws.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Bs(e){let t=Ys();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class lh{constructor(){this.io=new Vo,this.so={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.io.Vs(e),this.so[e]||"not-current"}updateQueryState(e,t,n){this.so[e]=t}removeLocalQueryTarget(e){this.io.fs(e)}isLocalQueryTarget(e){return this.io.activeTargetIds.has(e)}clearQueryState(e){delete this.so[e]}getAllActiveQueryTargets(){return this.io.activeTargetIds}isActiveQueryTarget(e){return this.io.activeTargetIds.has(e)}start(){return this.io=new Vo,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class jg{oo(e){}shutdown(){}}class hh{constructor(){this._o=()=>this.ao(),this.uo=()=>this.co(),this.lo=[],this.ho()}oo(e){this.lo.push(e)}shutdown(){window.removeEventListener("online",this._o),window.removeEventListener("offline",this.uo)}ho(){window.addEventListener("online",this._o),window.addEventListener("offline",this.uo)}ao(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.lo)e(0)}co(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.lo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Qi=null;function xo(){return null===Qi?Qi=268435456+Math.round(2147483648*Math.random()):Qi++,"0x"+Qi.toString(16)}const Qg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $g{constructor(e){this.Po=e.Po,this.Io=e.Io}To(e){this.Eo=e}Ao(e){this.Ro=e}Vo(e){this.mo=e}onMessage(e){this.fo=e}close(){this.Io()}send(e){this.Po(e)}po(){this.Eo()}yo(){this.Ro()}wo(e){this.mo(e)}So(e){this.fo(e)}}const De="WebChannelConnection";class Wg extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.bo=n+"://"+t.host,this.Do=`projects/${i}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get vo(){return!1}Fo(t,n,i,s,o){const u=xo(),c=this.Mo(t,n.toUriEncodedString());N("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);const h={"google-cloud-resource-prefix":this.Do,"x-goog-request-params":this.Co};return this.xo(h,s,o),this.Oo(t,c,h,i).then(f=>(N("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw Ue("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}No(t,n,i,s,o,u){return this.Fo(t,n,i,s,o)}xo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+pn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Mo(t,n){return`${this.bo}/v1/${n}:${Qg[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Oo(e,t,n,i){const s=xo();return new Promise((o,u)=>{const c=new Lu;c.setWithCredentials(!0),c.listenOnce(qu.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case gi.NO_ERROR:const f=c.getResponseJson();N(De,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case gi.TIMEOUT:N(De,`RPC '${e}' ${s} timed out`),u(new C(S.DEADLINE_EXCEEDED,"Request time out"));break;case gi.HTTP_ERROR:const g=c.getStatus();if(N(De,`RPC '${e}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);const R=null==_?void 0:_.error;if(R&&R.status&&R.message){const x=function(D){const B=D.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(B)>=0?B:S.UNKNOWN}(R.status);u(new C(x,R.message))}else u(new C(S.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new C(S.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{N(De,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(i);N(De,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",h,n,15)})}Lo(e,t,n){const i=xo(),s=[this.bo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=zu(),u=Gu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.xmlHttpFactory=new Bu({})),this.xo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");N(De,`Creating RPC '${e}' stream ${i}: ${f}`,c);const g=o.createWebChannel(f,c);let _=!1,R=!1;const x=new $g({Po:D=>{R?N(De,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(_||(N(De,`Opening RPC '${e}' stream ${i} transport.`),g.open(),_=!0),N(De,`RPC '${e}' stream ${i} sending:`,D),g.send(D))},Io:()=>g.close()}),k=(D,B,z)=>{D.listen(B,U=>{try{z(U)}catch(K){setTimeout(()=>{throw K},0)}})};return k(g,ir.EventType.OPEN,()=>{R||(N(De,`RPC '${e}' stream ${i} transport opened.`),x.po())}),k(g,ir.EventType.CLOSE,()=>{R||(R=!0,N(De,`RPC '${e}' stream ${i} transport closed`),x.wo())}),k(g,ir.EventType.ERROR,D=>{R||(R=!0,Ue(De,`RPC '${e}' stream ${i} transport errored:`,D),x.wo(new C(S.UNAVAILABLE,"The operation could not be completed")))}),k(g,ir.EventType.MESSAGE,D=>{var B;if(!R){const z=D.data[0];q(!!z);const K=z.error||(null===(B=z[0])||void 0===B?void 0:B.error);if(K){N(De,`RPC '${e}' stream ${i} received error:`,K);const Y=K.status;let Q=function(I){const E=Te[I];if(void 0!==E)return nl(E)}(Y),T=K.message;void 0===Q&&(Q=S.INTERNAL,T="Unknown error status: "+Y+" with message "+K.message),R=!0,x.wo(new C(Q,T)),g.close()}else N(De,`RPC '${e}' stream ${i} received:`,z),x.So(z)}}),k(u,Uu.STAT_EVENT,D=>{D.stat===Fs.PROXY?N(De,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===Fs.NOPROXY&&N(De,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.yo()},0),x}}function dh(){return typeof window<"u"?window:null}function $i(){return typeof document<"u"?document:null}function Nr(r){return new ng(r,!0)}class Co{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ai=e,this.timerId=t,this.Bo=n,this.ko=i,this.qo=s,this.Qo=0,this.Ko=null,this.$o=Date.now(),this.reset()}reset(){this.Qo=0}Uo(){this.Qo=this.qo}Wo(e){this.cancel();const t=Math.floor(this.Qo+this.Go()),n=Math.max(0,Date.now()-this.$o),i=Math.max(0,t-n);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Qo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ko=this.ai.enqueueAfterDelay(this.timerId,i,()=>(this.$o=Date.now(),e())),this.Qo*=this.ko,this.Qo<this.Bo&&(this.Qo=this.Bo),this.Qo>this.qo&&(this.Qo=this.qo)}zo(){null!==this.Ko&&(this.Ko.skipDelay(),this.Ko=null)}cancel(){null!==this.Ko&&(this.Ko.cancel(),this.Ko=null)}Go(){return(Math.random()-.5)*this.Qo}}class fh{constructor(e,t,n,i,s,o,u,c){this.ai=e,this.jo=n,this.Ho=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Jo=0,this.Yo=null,this.Zo=null,this.stream=null,this.Xo=0,this.e_=new Co(e,t)}t_(){return 1===this.state||5===this.state||this.n_()}n_(){return 2===this.state||3===this.state}start(){this.Xo=0,4!==this.state?this.auth():this.r_()}stop(){var e=this;return(0,b.A)(function*(){e.t_()&&(yield e.close(0))})()}i_(){this.state=0,this.e_.reset()}s_(){this.n_()&&null===this.Yo&&(this.Yo=this.ai.enqueueAfterDelay(this.jo,6e4,()=>this.o_()))}__(e){this.a_(),this.stream.send(e)}o_(){var e=this;return(0,b.A)(function*(){if(e.n_())return e.close(0)})()}a_(){this.Yo&&(this.Yo.cancel(),this.Yo=null)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}close(e,t){var n=this;return(0,b.A)(function*(){n.a_(),n.u_(),n.e_.cancel(),n.Jo++,4!==e?n.e_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),n.e_.Uo()):t&&t.code===S.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.c_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Vo(t)})()}c_(){}auth(){this.state=1;const e=this.l_(this.Jo),t=this.Jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Jo===t&&this.h_(n,i)},n=>{e(()=>{const i=new C(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.P_(i)})})}h_(e,t){const n=this.l_(this.Jo);this.stream=this.I_(e,t),this.stream.To(()=>{n(()=>this.listener.To())}),this.stream.Ao(()=>{n(()=>(this.state=2,this.Zo=this.ai.enqueueAfterDelay(this.Ho,1e4,()=>(this.n_()&&(this.state=3),Promise.resolve())),this.listener.Ao()))}),this.stream.Vo(i=>{n(()=>this.P_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.Xo?this.T_(i):this.onNext(i))})}r_(){var e=this;this.state=5,this.e_.Wo((0,b.A)(function*(){e.state=0,e.start()}))}P_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}l_(e){return t=>{this.ai.enqueueAndForget(()=>this.Jo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Hg extends fh{constructor(e,t,n,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}I_(e,t){return this.connection.Lo("Listen",e,t)}T_(e){return this.onNext(e)}onNext(e){this.e_.reset();const t=function sg(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:L(),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(q(void 0===f||"string"==typeof f),ge.fromBase64String(f||"")):(q(void 0===f||f instanceof Buffer||f instanceof Uint8Array),ge.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(h){const f=void 0===h.code?S.UNKNOWN:nl(h.code);return new C(f,h.message||"")}(o);t=new al(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=rt(r,n.document.name),s=Ie(n.document.updateTime),o=n.document.createTime?Ie(n.document.createTime):G.min(),u=new Pe({mapValue:{fields:n.document.fields}}),c=ce.newFoundDocument(i,s,o,u);t=new Ci(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,i=rt(r,n.document),s=n.readTime?Ie(n.readTime):G.min(),o=ce.newNoDocument(i,s);t=new Ci([],n.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const n=e.documentRemove,i=rt(r,n.document);t=new Ci([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return L();{const n=e.filter,{count:i=0,unchangedNames:s}=n,o=new Jm(i,s);t=new ol(n.targetId,o)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return G.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?G.min():o.readTime?Ie(o.readTime):G.min()}(e);return this.listener.E_(t,n)}d_(e){const t={};t.database=oo(this.serializer),t.addTarget=function(s,o){let u;const c=o.target;if(u=wi(c)?{documents:yl(s,c)}:{query:Di(s,c)._t},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=hl(s,o.resumeToken);const h=ro(s,o.expectedCount);null!==h&&(u.expectedCount=h)}else if(o.snapshotVersion.compareTo(G.min())>0){u.readTime=Cn(s,o.snapshotVersion.toTimestamp());const h=ro(s,o.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function ag(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.__(t)}A_(e){const t={};t.database=oo(this.serializer),t.removeTarget=e,this.__(t)}}class Jg extends fh{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}get R_(){return this.Xo>0}start(){this.lastStreamToken=void 0,super.start()}c_(){this.R_&&this.V_([])}I_(e,t){return this.connection.Lo("Write",e,t)}T_(e){return q(!!e.streamToken),this.lastStreamToken=e.streamToken,q(!e.writeResults||0===e.writeResults.length),this.listener.m_()}onNext(e){q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.e_.reset();const t=function og(r,e){return r&&r.length>0?(q(void 0!==e),r.map(t=>function(i,s){let o=Ie(i.updateTime?i.updateTime:s);return o.isEqual(G.min())&&(o=Ie(s)),new $m(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.f_(n,t)}g_(){const e={};e.database=oo(this.serializer),this.__(e)}V_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Rr(this.serializer,n))};this.__(t)}}class Yg extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.p_=!1}y_(){if(this.p_)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.")}Fo(e,t,n,i){return this.y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Fo(e,so(t,n),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(S.UNKNOWN,s.toString())})}No(e,t,n,i,s){return this.y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.No(e,so(t,n),i,o,u,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new C(S.UNKNOWN,o.toString())})}terminate(){this.p_=!0,this.connection.terminate()}}class Xg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.w_=0,this.S_=null,this.b_=!0}D_(){0===this.w_&&(this.C_("Unknown"),this.S_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.S_=null,this.v_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}F_(e){"Online"===this.state?this.C_("Unknown"):(this.w_++,this.w_>=1&&(this.M_(),this.v_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.M_(),this.w_=0,"Online"===e&&(this.b_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}v_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.b_?(ye(t),this.b_=!1):N("OnlineStateTracker",t)}M_(){null!==this.S_&&(this.S_.cancel(),this.S_=null)}}class Zg{constructor(e,t,n,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.x_=[],this.O_=new Map,this.N_=new Set,this.L_=[],this.B_=s,this.B_.oo(u=>{n.enqueueAndForget((0,b.A)(function*(){var c;Nt(o)&&(N("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,b.A)(function*(f){const g=F(f);g.N_.add(4),yield Bn(g),g.k_.set("Unknown"),g.N_.delete(4),yield kr(g)}),function h(f){return c.apply(this,arguments)})(o))}))}),this.k_=new Xg(n,i)}}function kr(r){return Do.apply(this,arguments)}function Do(){return(Do=(0,b.A)(function*(r){if(Nt(r))for(const e of r.L_)yield e(!0)})).apply(this,arguments)}function Bn(r){return No.apply(this,arguments)}function No(){return(No=(0,b.A)(function*(r){for(const e of r.L_)yield e(!1)})).apply(this,arguments)}function Wi(r,e){const t=F(r);t.O_.has(e.targetId)||(t.O_.set(e.targetId,e),Mo(t)?Fo(t):Gn(t).n_()&&ko(t,e))}function qn(r,e){const t=F(r),n=Gn(t);t.O_.delete(e),n.n_()&&mh(t,e),0===t.O_.size&&(n.n_()?n.s_():Nt(t)&&t.k_.set("Unknown"))}function ko(r,e){if(r.q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Gn(r).d_(e)}function mh(r,e){r.q_.xe(e),Gn(r).A_(e)}function Fo(r){r.q_=new Xm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.O_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Gn(r).start(),r.k_.D_()}function Mo(r){return Nt(r)&&!Gn(r).t_()&&r.O_.size>0}function Nt(r){return 0===F(r).N_.size}function gh(r){r.q_=void 0}function ep(r){return Oo.apply(this,arguments)}function Oo(){return(Oo=(0,b.A)(function*(r){r.k_.set("Online")})).apply(this,arguments)}function tp(r){return Lo.apply(this,arguments)}function Lo(){return(Lo=(0,b.A)(function*(r){r.O_.forEach((e,t)=>{ko(r,e)})})).apply(this,arguments)}function np(r,e){return Bo.apply(this,arguments)}function Bo(){return(Bo=(0,b.A)(function*(r,e){gh(r),Mo(r)?(r.k_.F_(e),Fo(r)):r.k_.set("Unknown")})).apply(this,arguments)}function rp(r,e,t){return qo.apply(this,arguments)}function qo(){return qo=(0,b.A)(function*(r,e,t){if(r.k_.set("Online"),e instanceof al&&2===e.state&&e.cause)try{yield(n=(0,b.A)(function*(s,o){const u=o.cause;for(const c of o.targetIds)s.O_.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.O_.delete(c),s.q_.removeTarget(c))}),function i(s,o){return n.apply(this,arguments)})(r,e)}catch(n){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Hi(r,n)}else if(e instanceof Ci?r.q_.Ke(e):e instanceof ol?r.q_.He(e):r.q_.We(e),!t.isEqual(G.min()))try{const n=yield rh(r.localStore);t.compareTo(n)>=0&&(yield function(s,o){const u=s.q_.rt(o);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=s.O_.get(h);f&&s.O_.set(h,f.withResumeToken(c.resumeToken,o))}}),u.targetMismatches.forEach((c,h)=>{const f=s.O_.get(c);if(!f)return;s.O_.set(c,f.withResumeToken(ge.EMPTY_BYTE_STRING,f.snapshotVersion)),mh(s,c);const g=new ft(f.target,c,h,f.sequenceNumber);ko(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){N("RemoteStore","Failed to raise snapshot:",n),yield Hi(r,n)}var n}),qo.apply(this,arguments)}function Hi(r,e,t){return Uo.apply(this,arguments)}function Uo(){return(Uo=(0,b.A)(function*(r,e,t){if(!vt(e))throw e;r.N_.add(1),yield Bn(r),r.k_.set("Offline"),t||(t=()=>rh(r.localStore)),r.asyncQueue.enqueueRetryable((0,b.A)(function*(){N("RemoteStore","Retrying IndexedDB access"),yield t(),r.N_.delete(1),yield kr(r)}))})).apply(this,arguments)}function ph(r,e){return e().catch(t=>Hi(r,t,e))}function Un(r){return Go.apply(this,arguments)}function Go(){return(Go=(0,b.A)(function*(r){const e=F(r),t=kt(e);let n=e.x_.length>0?e.x_[e.x_.length-1].batchId:-1;for(;ip(e);)try{const i=yield Gg(e.localStore,n);if(null===i){0===e.x_.length&&t.s_();break}n=i.batchId,sp(e,i)}catch(i){yield Hi(e,i)}_h(e)&&yh(e)})).apply(this,arguments)}function ip(r){return Nt(r)&&r.x_.length<10}function sp(r,e){r.x_.push(e);const t=kt(r);t.n_()&&t.R_&&t.V_(e.mutations)}function _h(r){return Nt(r)&&!kt(r).t_()&&r.x_.length>0}function yh(r){kt(r).start()}function op(r){return zo.apply(this,arguments)}function zo(){return(zo=(0,b.A)(function*(r){kt(r).g_()})).apply(this,arguments)}function ap(r){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,b.A)(function*(r){const e=kt(r);for(const t of r.x_)e.V_(t.mutations)})).apply(this,arguments)}function up(r,e,t){return jo.apply(this,arguments)}function jo(){return(jo=(0,b.A)(function*(r,e,t){const n=r.x_.shift(),i=eo.from(n,e,t);yield ph(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Un(r)})).apply(this,arguments)}function cp(r,e){return Qo.apply(this,arguments)}function Qo(){return Qo=(0,b.A)(function*(r,e){var t;e&&kt(r).R_&&(yield(t=(0,b.A)(function*(i,s){if(tl(u=s.code)&&u!==S.ABORTED){const o=i.x_.shift();kt(i).i_(),yield ph(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Un(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),_h(r)&&yh(r)}),Qo.apply(this,arguments)}function Ih(r,e){return $o.apply(this,arguments)}function $o(){return($o=(0,b.A)(function*(r,e){const t=F(r);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const n=Nt(t);t.N_.add(3),yield Bn(t),n&&t.k_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.N_.delete(3),yield kr(t)})).apply(this,arguments)}function Wo(r,e){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,b.A)(function*(r,e){const t=F(r);e?(t.N_.delete(2),yield kr(t)):e||(t.N_.add(2),yield Bn(t),t.k_.set("Unknown"))})).apply(this,arguments)}function Gn(r){return r.Q_||(r.Q_=function(t,n,i){const s=F(t);return s.y_(),new Hg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{To:ep.bind(null,r),Ao:tp.bind(null,r),Vo:np.bind(null,r),E_:rp.bind(null,r)}),r.L_.push(function(){var e=(0,b.A)(function*(t){t?(r.Q_.i_(),Mo(r)?Fo(r):r.k_.set("Unknown")):(yield r.Q_.stop(),gh(r))});return function(t){return e.apply(this,arguments)}}())),r.Q_}function kt(r){return r.K_||(r.K_=function(t,n,i){const s=F(t);return s.y_(),new Jg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{To:()=>Promise.resolve(),Ao:op.bind(null,r),Vo:cp.bind(null,r),m_:ap.bind(null,r),f_:up.bind(null,r)}),r.L_.push(function(){var e=(0,b.A)(function*(t){t?(r.K_.i_(),yield Un(r)):(yield r.K_.stop(),r.x_.length>0&&(N("RemoteStore",`Stopping write stream with ${r.x_.length} pending writes`),r.x_=[]))});return function(t){return e.apply(this,arguments)}}())),r.K_}class Jo{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Ee,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const o=Date.now()+n,u=new Jo(e,t,o,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zn(r,e){if(ye("AsyncQueue",`${e}: ${r}`),vt(r))return new C(S.UNAVAILABLE,`${e}: ${r}`);throw r}class Kn{constructor(e){this.comparator=e?(t,n)=>e(t,n)||O.comparator(t.key,n.key):(t,n)=>O.comparator(t.key,n.key),this.keyedMap=_r(),this.sortedSet=new ae(this.comparator)}static emptySet(e){return new Kn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Kn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Kn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Th{constructor(){this.U_=new ae(O.comparator)}track(e){const t=e.doc.key,n=this.U_.get(t);n?0!==e.type&&3===n.type?this.U_=this.U_.insert(t,e):3===e.type&&1!==n.type?this.U_=this.U_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.U_=this.U_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.U_=this.U_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.U_=this.U_.remove(t):1===e.type&&2===n.type?this.U_=this.U_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.U_=this.U_.insert(t,{type:2,doc:e.doc}):L():this.U_=this.U_.insert(t,e)}W_(){const e=[];return this.U_.inorderTraversal((t,n)=>{e.push(n)}),e}}class jn{constructor(e,t,n,i,s,o,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new jn(e,t,Kn.emptySet(t),o,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&gr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class lp{constructor(){this.G_=void 0,this.z_=[]}j_(){return this.z_.some(e=>e.H_())}}class hp{constructor(){this.queries=Eh(),this.onlineState="Unknown",this.J_=new Set}terminate(){!function(t,n){const i=F(t),s=i.queries;i.queries=Eh(),s.forEach((o,u)=>{for(const c of u.z_)c.onError(n)})}(this,new C(S.ABORTED,"Firestore shutting down"))}}function Eh(){return new ht(r=>Fc(r),gr)}function Yo(r,e){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,b.A)(function*(r,e){const t=F(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.j_()&&e.H_()&&(n=2):(s=new lp,n=e.H_()?0:1);try{switch(n){case 0:s.G_=yield t.onListen(i,!0);break;case 1:s.G_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){const u=zn(o,`Initialization of query '${Pn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.z_.push(e),e.Y_(t.onlineState),s.G_&&e.Z_(s.G_)&&ta(t)})).apply(this,arguments)}function Zo(r,e){return ea.apply(this,arguments)}function ea(){return(ea=(0,b.A)(function*(r,e){const t=F(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const o=s.z_.indexOf(e);o>=0&&(s.z_.splice(o,1),0===s.z_.length?i=e.H_()?0:1:!s.j_()&&e.H_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function dp(r,e){const t=F(r);let n=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const u of o.z_)u.Z_(i)&&(n=!0);o.G_=i}}n&&ta(t)}function fp(r,e,t){const n=F(r),i=n.queries.get(e);if(i)for(const s of i.z_)s.onError(t);n.queries.delete(e)}function ta(r){r.J_.forEach(e=>{e.next()})}var na,vh;(vh=na||(na={})).X_="default",vh.Cache="cache";class ra{constructor(e,t,n){this.query=e,this.ea=t,this.ta=!1,this.na=null,this.onlineState="Unknown",this.options=n||{}}Z_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new jn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ta?this.ra(e)&&(this.ea.next(e),t=!0):this.ia(e,this.onlineState)&&(this.sa(e),t=!0),this.na=e,t}onError(e){this.ea.error(e)}Y_(e){this.onlineState=e;let t=!1;return this.na&&!this.ta&&this.ia(this.na,e)&&(this.sa(this.na),t=!0),t}ia(e,t){return!e.fromCache||!this.H_()||(!this.options.oa||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ra(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.na&&this.na.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}sa(e){e=jn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ta=!0,this.ea.next(e)}H_(){return this.options.source!==na.Cache}}class mp{constructor(e,t){this._a=e,this.byteLength=t}aa(){return"metadata"in this._a}}class Ah{constructor(e){this.serializer=e}Ts(e){return rt(this.serializer,e)}Es(e){return e.metadata.exists?_l(this.serializer,e.document,!1):ce.newNoDocument(this.Ts(e.metadata.name),this.ds(e.metadata.readTime))}ds(e){return Ie(e)}}class gp{constructor(e,t,n){this.ua=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=wh(e)}ca(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e._a.namedQuery)this.queries.push(e._a.namedQuery);else if(e._a.documentMetadata){this.documents.push({metadata:e._a.documentMetadata}),e._a.documentMetadata.exists||++t;const n=H.fromString(e._a.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e._a.document&&(this.documents[this.documents.length-1].document=e._a.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}la(e){const t=new Map,n=new Ah(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Ts(i.metadata.name);for(const o of i.metadata.queries){const u=(t.get(o)||$()).add(s);t.set(o,u)}}return t}complete(){var e=this;return(0,b.A)(function*(){const t=yield function zg(r,e,t,n){return wo.apply(this,arguments)}(e.localStore,new Ah(e.serializer),e.documents,e.ua.id),n=e.la(e.documents);for(const i of e.queries)yield Kg(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ha:e.collectionGroups,Pa:t}})()}}function wh(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class Rh{constructor(e){this.key=e}}class Ph{constructor(e){this.key=e}}class Sh{constructor(e,t){this.query=e,this.Ia=t,this.Ta=null,this.hasCachedResults=!1,this.current=!1,this.Ea=$(),this.mutatedKeys=$(),this.da=Oc(e),this.Aa=new Kn(this.da)}get Ra(){return this.Ia}Va(e,t){const n=t?t.ma:new Th,i=t?t.Aa:this.Aa;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{const _=i.get(f),R=pr(this.query,g)?g:null,x=!!_&&this.mutatedKeys.has(_.key),k=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let D=!1;_&&R?_.data.isEqual(R.data)?x!==k&&(n.track({type:3,doc:R}),D=!0):this.fa(_,R)||(n.track({type:2,doc:R}),D=!0,(c&&this.da(R,c)>0||h&&this.da(R,h)<0)&&(u=!0)):!_&&R?(n.track({type:0,doc:R}),D=!0):_&&!R&&(n.track({type:1,doc:_}),D=!0,(c||h)&&(u=!0)),D&&(R?(o=o.add(R),s=k?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const f="F"===this.query.limitType?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Aa:o,ma:n,ts:u,mutatedKeys:s}}fa(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Aa;this.Aa=e.Aa,this.mutatedKeys=e.mutatedKeys;const o=e.ma.W_();o.sort((f,g)=>function(R,x){const k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return k(R)-k(x)}(f.type,g.type)||this.da(f.doc,g.doc)),this.ga(n),i=null!=i&&i;const u=t&&!i?this.pa():[],c=0===this.Ea.size&&this.current&&!i?1:0,h=c!==this.Ta;return this.Ta=c,0!==o.length||h?{snapshot:new jn(this.query,e.Aa,s,o,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),ya:u}:{ya:u}}Y_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Aa:this.Aa,ma:new Th,mutatedKeys:this.mutatedKeys,ts:!1},!1)):{ya:[]}}wa(e){return!this.Ia.has(e)&&!!this.Aa.has(e)&&!this.Aa.get(e).hasLocalMutations}ga(e){e&&(e.addedDocuments.forEach(t=>this.Ia=this.Ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ia=this.Ia.delete(t)),this.current=e.current)}pa(){if(!this.current)return[];const e=this.Ea;this.Ea=$(),this.Aa.forEach(n=>{this.wa(n.key)&&(this.Ea=this.Ea.add(n.key))});const t=[];return e.forEach(n=>{this.Ea.has(n)||t.push(new Ph(n))}),this.Ea.forEach(n=>{e.has(n)||t.push(new Rh(n))}),t}Sa(e){this.Ia=e.Is,this.Ea=$();const t=this.Va(e.documents);return this.applyChanges(t,!0)}ba(){return jn.fromInitialDocuments(this.query,this.Aa,this.mutatedKeys,0===this.Ta,this.hasCachedResults)}}class pp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class _p{constructor(e){this.key=e,this.Da=!1}}class yp{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.va=new ht(u=>Fc(u),gr),this.Fa=new Map,this.Ma=new Set,this.xa=new ae(O.comparator),this.Oa=new Map,this.Na=new po,this.La={},this.Ba=new Map,this.ka=nn.Bn(),this.onlineState="Unknown",this.qa=void 0}get isPrimaryClient(){return!0===this.qa}}function Ip(r,e){return ia.apply(this,arguments)}function ia(){return(ia=(0,b.A)(function*(r,e,t=!0){const n=Ji(r);let i;const s=n.va.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ba()):i=yield Vh(n,e,t,!0),i})).apply(this,arguments)}function Tp(r,e){return sa.apply(this,arguments)}function sa(){return(sa=(0,b.A)(function*(r,e){const t=Ji(r);yield Vh(t,e,!0,!1)})).apply(this,arguments)}function Vh(r,e,t,n){return oa.apply(this,arguments)}function oa(){return(oa=(0,b.A)(function*(r,e,t,n){const i=yield On(r.localStore,xe(e)),s=i.targetId,o=t?r.sharedClientState.addLocalQueryTarget(s):"not-current";let u;return n&&(u=yield aa(r,e,s,"current"===o,i.resumeToken)),r.isPrimaryClient&&t&&Wi(r.remoteStore,i),u})).apply(this,arguments)}function aa(r,e,t,n,i){return ua.apply(this,arguments)}function ua(){return ua=(0,b.A)(function*(r,e,t,n,i){r.Qa=(g,_,R)=>{return(x=(0,b.A)(function*(D,B,z,U){let K=B.view.Va(z);K.ts&&(K=yield zi(D.localStore,B.query,!1).then(({documents:p})=>B.view.Va(p,K)));const Y=U&&U.targetChanges.get(B.targetId),Q=U&&null!=U.targetMismatches.get(B.targetId),T=B.view.applyChanges(K,D.isPrimaryClient,Y,Q);return Ia(D,B.targetId,T.ya),T.snapshot}),function k(D,B,z,U){return x.apply(this,arguments)})(r,g,_,R);var x};const s=yield zi(r.localStore,e,!0),o=new Sh(e,s.Is),u=o.Va(s.documents),c=Ar.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=o.applyChanges(u,r.isPrimaryClient,c);Ia(r,t,h.ya);const f=new pp(e,t,o);return r.va.set(e,f),r.Fa.has(t)?r.Fa.get(t).push(e):r.Fa.set(t,[e]),h.snapshot}),ua.apply(this,arguments)}function Ep(r,e,t){return ca.apply(this,arguments)}function ca(){return(ca=(0,b.A)(function*(r,e,t){const n=F(r),i=n.va.get(e),s=n.Fa.get(i.targetId);if(s.length>1)return n.Fa.set(i.targetId,s.filter(o=>!gr(o,e))),void n.va.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Ln(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&qn(n.remoteStore,i.targetId),Qn(n,i.targetId)}).catch(Et))):(Qn(n,i.targetId),yield Ln(n.localStore,i.targetId,!0))})).apply(this,arguments)}function vp(r,e){return la.apply(this,arguments)}function la(){return(la=(0,b.A)(function*(r,e){const t=F(r),n=t.va.get(e),i=t.Fa.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),qn(t.remoteStore,n.targetId))})).apply(this,arguments)}function ha(){return(ha=(0,b.A)(function*(r,e,t){const n=xa(r);try{const i=yield function(o,u){const c=F(o),h=de.now(),f=u.reduce((R,x)=>R.add(x.key),$());let g,_;return c.persistence.runTransaction("Locally write mutations","readwrite",R=>{let x=ze(),k=$();return c.us.getEntries(R,f).next(D=>{x=D,x.forEach((B,z)=>{z.isValidDocument()||(k=k.add(B))})}).next(()=>c.localDocuments.getOverlayedDocuments(R,x)).next(D=>{g=D;const B=[];for(const z of u){const U=Hm(z,g.get(z.key).overlayedDocument);null!=U&&B.push(new dt(z.key,U,Ic(U.value.mapValue),fe.exists(!0)))}return c.mutationQueue.addMutationBatch(R,h,B,u)}).next(D=>{_=D;const B=D.applyToLocalDocumentSet(g,k);return c.documentOverlayCache.saveOverlays(R,D.batchId,B)})}).then(()=>({batchId:_.batchId,changes:Bc(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,u,c){let h=o.La[o.currentUser.toKey()];h||(h=new ae(j)),h=h.insert(u,c),o.La[o.currentUser.toKey()]=h}(n,i.batchId,t),yield mt(n,i.changes),yield Un(n.remoteStore)}catch(i){const s=zn(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function bh(r,e){return da.apply(this,arguments)}function da(){return(da=(0,b.A)(function*(r,e){const t=F(r);try{const n=yield function Ug(r,e){const t=F(r),n=e.snapshotVersion;let i=t.ss;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.us.newChangeBuffer({trackRemovals:!0});i=t.ss;const u=[];e.targetChanges.forEach((f,g)=>{const _=i.get(g);if(!_)return;u.push(t.$r.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.$r.addMatchingKeys(s,f.addedDocuments,g)));let R=_.withSequenceNumber(s.currentSequenceNumber);var k,D,B;null!==e.targetMismatches.get(g)?R=R.withResumeToken(ge.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),i=i.insert(g,R),D=R,B=f,(0===(k=_).resumeToken.approximateByteSize()||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8||B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0)&&u.push(t.$r.updateTargetData(s,R))});let c=ze(),h=$();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(ih(s,o,e.documentUpdates).next(f=>{c=f.hs,h=f.Ps})),!n.isEqual(G.min())){const f=t.$r.getLastRemoteSnapshotVersion(s).next(g=>t.$r.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return w.waitFor(u).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.ss=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Oa.get(s);o&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Da=!0:i.modifiedDocuments.size>0?q(o.Da):i.removedDocuments.size>0&&(q(o.Da),o.Da=!1))}),yield mt(t,n,e)}catch(n){yield Et(n)}})).apply(this,arguments)}function xh(r,e,t){const n=F(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.va.forEach((s,o)=>{const u=o.view.Y_(e);u.snapshot&&i.push(u.snapshot)}),function(o,u){const c=F(o);c.onlineState=u;let h=!1;c.queries.forEach((f,g)=>{for(const _ of g.z_)_.Y_(u)&&(h=!0)}),h&&ta(c)}(n.eventManager,e),i.length&&n.Ca.E_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function wp(r,e,t){return fa.apply(this,arguments)}function fa(){return(fa=(0,b.A)(function*(r,e,t){const n=F(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Oa.get(e),s=i&&i.key;if(s){let o=new ae(O.comparator);o=o.insert(s,ce.newNoDocument(s,G.min()));const u=$().add(s),c=new vr(G.min(),new Map,new ae(j),o,u);yield bh(n,c),n.xa=n.xa.remove(s),n.Oa.delete(e),Ta(n)}else yield Ln(n.localStore,e,!1).then(()=>Qn(n,e,t)).catch(Et)})).apply(this,arguments)}function Rp(r,e){return ma.apply(this,arguments)}function ma(){return(ma=(0,b.A)(function*(r,e){const t=F(r),n=e.batch.batchId;try{const i=yield function qg(r,e){const t=F(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.us.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const g=h.batch,_=g.keys();let R=w.resolve();return _.forEach(x=>{R=R.next(()=>f.getEntry(c,x)).next(k=>{const D=h.docVersions.get(x);q(null!==D),k.version.compareTo(D)<0&&(g.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=$();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);ya(t,n,null),_a(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield mt(t,i)}catch(i){yield Et(i)}})).apply(this,arguments)}function Pp(r,e,t){return ga.apply(this,arguments)}function ga(){return(ga=(0,b.A)(function*(r,e,t){const n=F(r);try{const i=yield function(o,u){const c=F(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(q(null!==g),f=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);ya(n,e,t),_a(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield mt(n,i)}catch(i){yield Et(i)}})).apply(this,arguments)}function pa(){return(pa=(0,b.A)(function*(r,e){const t=F(r);Nt(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(o){const u=F(o);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(-1===n)return void e.resolve();const i=t.Ba.get(n)||[];i.push(e),t.Ba.set(n,i)}catch(n){const i=zn(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function _a(r,e){(r.Ba.get(e)||[]).forEach(t=>{t.resolve()}),r.Ba.delete(e)}function ya(r,e,t){const n=F(r);let i=n.La[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.La[n.currentUser.toKey()]=i}}function Qn(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Fa.get(e))r.va.delete(n),t&&r.Ca.Ka(n,t);r.Fa.delete(e),r.isPrimaryClient&&r.Na.mr(e).forEach(n=>{r.Na.containsKey(n)||Ch(r,n)})}function Ch(r,e){r.Ma.delete(e.path.canonicalString());const t=r.xa.get(e);null!==t&&(qn(r.remoteStore,t),r.xa=r.xa.remove(e),r.Oa.delete(t),Ta(r))}function Ia(r,e,t){for(const n of t)n instanceof Rh?(r.Na.addReference(n.key,e),Vp(r,n)):n instanceof Ph?(N("SyncEngine","Document no longer in limbo: "+n.key),r.Na.removeReference(n.key,e),r.Na.containsKey(n.key)||Ch(r,n.key)):L()}function Vp(r,e){const t=e.key,n=t.path.canonicalString();r.xa.get(t)||r.Ma.has(n)||(N("SyncEngine","New document in limbo: "+t),r.Ma.add(n),Ta(r))}function Ta(r){for(;r.Ma.size>0&&r.xa.size<r.maxConcurrentLimboResolutions;){const e=r.Ma.values().next().value;r.Ma.delete(e);const t=new O(H.fromString(e)),n=r.ka.next();r.Oa.set(n,new _p(t)),r.xa=r.xa.insert(t,n),Wi(r.remoteStore,new ft(xe(wn(t.path)),n,"TargetPurposeLimboResolution",Qe.oe))}}function mt(r,e,t){return Ea.apply(this,arguments)}function Ea(){return Ea=(0,b.A)(function*(r,e,t){const n=F(r),i=[],s=[],o=[];var u;n.va.isEmpty()||(n.va.forEach((u,c)=>{o.push(n.Qa(c,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){const g=h?!h.fromCache:null===(f=null==t?void 0:t.targetChanges.get(c.targetId))||void 0===f?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,g?"current":"not-current")}if(h){i.push(h);const g=Eo.Ui(c.targetId,h);s.push(g)}}))}),yield Promise.all(o),n.Ca.E_(i),yield(u=(0,b.A)(function*(h,f){const g=F(h);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>w.forEach(f,R=>w.forEach(R.Ki,x=>g.persistence.referenceDelegate.addReference(_,R.targetId,x)).next(()=>w.forEach(R.$i,x=>g.persistence.referenceDelegate.removeReference(_,R.targetId,x)))))}catch(_){if(!vt(_))throw _;N("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of f){const R=_.targetId;if(!_.fromCache){const x=g.ss.get(R),D=x.withLastLimboFreeSnapshotVersion(x.snapshotVersion);g.ss=g.ss.insert(R,D)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),Ea.apply(this,arguments)}function bp(r,e){return va.apply(this,arguments)}function va(){return(va=(0,b.A)(function*(r,e){const t=F(r);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const n=yield nh(t.localStore,e);t.currentUser=e,(s=t).Ba.forEach(u=>{u.forEach(c=>{c.reject(new C(S.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ba.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield mt(t,n.ls)}var s})).apply(this,arguments)}function xp(r,e){const t=F(r),n=t.Oa.get(e);if(n&&n.Da)return $().add(n.key);{let i=$();const s=t.Fa.get(e);if(!s)return i;for(const o of s){const u=t.va.get(o);i=i.unionWith(u.view.Ra)}return i}}function Cp(r,e){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,b.A)(function*(r,e){const t=F(r),n=yield zi(t.localStore,e.query,!0),i=e.view.Sa(n);return t.isPrimaryClient&&Ia(t,e.targetId,i.ya),i})).apply(this,arguments)}function Dp(r,e){return wa.apply(this,arguments)}function wa(){return(wa=(0,b.A)(function*(r,e){const t=F(r);return oh(t.localStore,e).then(n=>mt(t,n))})).apply(this,arguments)}function Np(r,e,t,n){return Ra.apply(this,arguments)}function Ra(){return(Ra=(0,b.A)(function*(r,e,t,n){const i=F(r),s=yield function(u,c){const h=F(u),f=F(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Fn(g,c).next(_=>_?h.localDocuments.getDocuments(g,_):w.resolve(null)))}(i.localStore,e);var c;null!==s?("pending"===t?yield Un(i.remoteStore):"acknowledged"===t||"rejected"===t?(ya(i,e,n||null),_a(i,e),c=e,F(F(i.localStore).mutationQueue).xn(c)):L(),yield mt(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function Pa(){return(Pa=(0,b.A)(function*(r,e){const t=F(r);if(Ji(t),xa(t),!0===e&&!0!==t.qa){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Dh(t,n.toArray());t.qa=!0,yield Wo(t.remoteStore,!0);for(const s of i)Wi(t.remoteStore,s)}else if(!1===e&&!1!==t.qa){const n=[];let i=Promise.resolve();t.Fa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):i=i.then(()=>(Qn(t,o),Ln(t.localStore,o,!0))),qn(t.remoteStore,o)}),yield i,yield Dh(t,n),function(o){const u=F(o);u.Oa.forEach((c,h)=>{qn(u.remoteStore,h)}),u.Na.gr(),u.Oa=new Map,u.xa=new ae(O.comparator)}(t),t.qa=!1,yield Wo(t.remoteStore,!1)}})).apply(this,arguments)}function Dh(r,e,t){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,b.A)(function*(r,e,t){const n=F(r),i=[],s=[];for(const o of e){let u;const c=n.Fa.get(o);if(c&&0!==c.length){u=yield On(n.localStore,xe(c[0]));for(const h of c){const f=n.va.get(h),g=yield Cp(n,f);g.snapshot&&s.push(g.snapshot)}}else{const h=yield sh(n.localStore,o);u=yield On(n.localStore,h),yield aa(n,Nh(h),o,!1,u.resumeToken)}i.push(u)}return n.Ca.E_(s),i})).apply(this,arguments)}function Nh(r){return Cc(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Fp(r){return t=F(r).localStore,F(F(t).persistence).qi();var t}function Mp(r,e,t,n){return Va.apply(this,arguments)}function Va(){return(Va=(0,b.A)(function*(r,e,t,n){const i=F(r);if(i.qa)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=i.Fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield oh(i.localStore,Mc(s[0])),u=vr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,ge.EMPTY_BYTE_STRING);yield mt(i,o,u);break}case"rejected":yield Ln(i.localStore,e,!0),Qn(i,e,n);break;default:L()}})).apply(this,arguments)}function Op(r,e,t){return ba.apply(this,arguments)}function ba(){return(ba=(0,b.A)(function*(r,e,t){const n=Ji(r);if(n.qa){for(const i of e){if(n.Fa.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){N("SyncEngine","Adding an already active target "+i);continue}const s=yield sh(n.localStore,i),o=yield On(n.localStore,s);yield aa(n,Nh(s),o.targetId,!1,o.resumeToken),Wi(n.remoteStore,o)}for(const i of t)n.Fa.has(i)&&(yield Ln(n.localStore,i,!1).then(()=>{qn(n.remoteStore,i),Qn(n,i)}).catch(Et))}})).apply(this,arguments)}function Ji(r){const e=F(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=bh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=wp.bind(null,e),e.Ca.E_=dp.bind(null,e.eventManager),e.Ca.Ka=fp.bind(null,e.eventManager),e}function xa(r){const e=F(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Rp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Pp.bind(null,e),e}class $n{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,b.A)(function*(){t.serializer=Nr(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return th(this.persistence,new eh,e.initialUser,this.serializer)}createPersistence(e){return new _o(qi.Yr,this.serializer)}createSharedClientState(e){return new lh}terminate(){var e=this;return(0,b.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Ca extends $n{constructor(e,t,n){super(),this.Ua=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e),yield n.Ua.initialize(n,e),yield xa(n.Ua.syncEngine),yield Un(n.Ua.remoteStore),yield n.persistence.pi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return th(this.persistence,new eh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new jl(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new om(t,this.persistence);return new sm(e.asyncQueue,n)}createPersistence(e){const t=To(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ce.withCacheSize(this.cacheSizeBytes):Ce.DEFAULT;return new Io(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,dh(),$i(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new lh}}class kh extends Ca{constructor(e,t){super(e,t,!1),this.Ua=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e);const i=n.Ua.syncEngine;n.sharedClientState instanceof bo&&(n.sharedClientState.syncEngine={eo:Np.bind(null,i),no:Mp.bind(null,i),ro:Op.bind(null,i),qi:Fp.bind(null,i),Xs:Dp.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.pi(function(){var s=(0,b.A)(function*(o){yield function kp(r,e){return Pa.apply(this,arguments)}(n.Ua.syncEngine,o),n.gcScheduler&&(o&&!n.gcScheduler.started?n.gcScheduler.start():o||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(o&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():o||n.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=dh();if(!bo.D(t))throw new C(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=To(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new bo(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Wn{initialize(e,t){var n=this;return(0,b.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>xh(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=bp.bind(null,n.syncEngine),yield Wo(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new hp}createDatastore(e){const t=Nr(e.databaseInfo.databaseId),n=new Wg(e.databaseInfo);return new Yg(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>xh(this.syncEngine,t,0),u=hh.D()?new hh:new jg,new Zg(n,i,s,o,u);var n,i,s,o,u}createSyncEngine(e,t){return function(i,s,o,u,c,h,f){const g=new yp(i,s,o,u,c,h);return f&&(g.qa=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,b.A)(function*(){var t,n,i;yield(i=(0,b.A)(function*(o){const u=F(o);N("RemoteStore","RemoteStore shutting down."),u.N_.add(5),yield Bn(u),u.B_.shutdown(),u.k_.set("Unknown")}),function s(o){return i.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}function Fh(r,e=10240){let t=0;return{read:()=>(0,b.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,b.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Yi{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Wa(this.observer.next,e)}error(e){this.observer.error?this.Wa(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString())}Ga(){this.muted=!0}Wa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class qp{constructor(e,t){this.za=e,this.serializer=t,this.metadata=new Ee,this.buffer=new Uint8Array,this.ja=new TextDecoder("utf-8"),this.Ha().then(n=>{n&&n.aa()?this.metadata.resolve(n._a.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==n?void 0:n._a)}`))},n=>this.metadata.reject(n))}close(){return this.za.cancel()}getMetadata(){var e=this;return(0,b.A)(function*(){return e.metadata.promise})()}$a(){var e=this;return(0,b.A)(function*(){return yield e.getMetadata(),e.Ha()})()}Ha(){var e=this;return(0,b.A)(function*(){const t=yield e.Ja();if(null===t)return null;const n=e.ja.decode(t),i=Number(n);isNaN(i)&&e.Ya(`length string (${n}) is not valid number`);const s=yield e.Za(i);return new mp(JSON.parse(s),t.length+i)})()}Xa(){return this.buffer.findIndex(e=>123===e)}Ja(){var e=this;return(0,b.A)(function*(){for(;e.Xa()<0&&!(yield e.eu()););if(0===e.buffer.length)return null;const t=e.Xa();t<0&&e.Ya("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Za(e){var t=this;return(0,b.A)(function*(){for(;t.buffer.length<e;)(yield t.eu())&&t.Ya("Reached the end of bundle when more is expected.");const n=t.ja.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}Ya(e){throw this.za.cancel(),new Error(`Invalid bundle format: ${e}`)}eu(){var e=this;return(0,b.A)(function*(){const t=yield e.za.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class Up{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,b.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new C(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,b.A)(function*(o,u){const c=F(o),h={documents:u.map(R=>wr(c.serializer,R))},f=yield c.No("BatchGetDocuments",c.serializer.databaseId,H.emptyPath(),h,u.length),g=new Map;f.forEach(R=>{const x=function ig(r,e){return"found"in e?function(n,i){q(!!i.found);const s=rt(n,i.found.name),o=Ie(i.found.updateTime),u=i.found.createTime?Ie(i.found.createTime):G.min(),c=new Pe({mapValue:{fields:i.found.fields}});return ce.newFoundDocument(s,o,u,c)}(r,e):"missing"in e?function(n,i){q(!!i.missing),q(!!i.readTime);const s=rt(n,i.missing),o=Ie(i.readTime);return ce.newNoDocument(s,o)}(r,e):L()}(c.serializer,R);g.set(x.key.toString(),x)});const _=[];return u.forEach(R=>{const x=g.get(R.toString());q(!!x),_.push(x)}),_}),function s(o,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new xn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,b.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=O.fromPath(i);e.mutations.push(new Xs(s,e.precondition(s)))}),yield(n=(0,b.A)(function*(s,o){const u=F(s),c={writes:o.map(h=>Rr(u.serializer,h))};yield u.Fo("Commit",u.serializer.databaseId,H.emptyPath(),c)}),function i(s,o){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw L();t=G.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new C(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?fe.exists(!1):fe.updateTime(t):fe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new C(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fe.updateTime(t)}return fe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Gp{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.tu=n.maxAttempts,this.e_=new Co(this.asyncQueue,"transaction_retry")}nu(){this.tu-=1,this.ru()}ru(){var e=this;this.e_.Wo((0,b.A)(function*(){const t=new Up(e.datastore),n=e.iu(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.su(s)}))}).catch(i=>{e.su(i)})}))}iu(e){try{const t=this.updateFunction(e);return!ar(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}su(e){this.tu>0&&this.ou(e)?(this.tu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ru(),Promise.resolve()))):this.deferred.reject(e)}ou(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!tl(t)}return!1}}class zp{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ae.UNAUTHENTICATED,this.clientId=$u.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var o=(0,b.A)(function*(u){N("FirestoreClient","Received user=",u.uid),yield s.authCredentialListener(u),s.user=u});return function(u){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(n,o=>(N("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ee;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=zn(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Xi(r,e){return Da.apply(this,arguments)}function Da(){return Da=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,b.A)(function*(s){n.isEqual(s)||(yield nh(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Da.apply(this,arguments)}function Na(r,e){return ka.apply(this,arguments)}function ka(){return(ka=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield Fa(r);N("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Ih(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Ih(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function Mh(r){return"FirebaseError"===r.name?r.code===S.FAILED_PRECONDITION||r.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function Fa(r){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,b.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Xi(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Mh(t))throw t;Ue("Error using user provided cache. Falling back to memory cache: "+t),yield Xi(r,new $n)}}else N("FirestoreClient","Using default OfflineComponentProvider"),yield Xi(r,new $n);return r._offlineComponents})).apply(this,arguments)}function Zi(r){return Oa.apply(this,arguments)}function Oa(){return(Oa=(0,b.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),yield Na(r,r._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),yield Na(r,new Wn))),r._onlineComponents})).apply(this,arguments)}function Oh(r){return Fa(r).then(e=>e.persistence)}function Hn(r){return Fa(r).then(e=>e.localStore)}function Lh(r){return Zi(r).then(e=>e.remoteStore)}function La(r){return Zi(r).then(e=>e.syncEngine)}function Jn(r){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,b.A)(function*(r){const e=yield Zi(r),t=e.eventManager;return t.onListen=Ip.bind(null,e.syncEngine),t.onUnlisten=Ep.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Tp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=vp.bind(null,e.syncEngine),t})).apply(this,arguments)}function qh(r,e,t={}){const n=new Ee;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,o,u,c,h){const f=new Yi({next:_=>{o.enqueueAndForget(()=>Zo(s,g));const R=_.docs.has(u);!R&&_.fromCache?h.reject(new C(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&_.fromCache&&c&&"server"===c.source?h.reject(new C(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new ra(wn(u.path),f,{includeMetadataChanges:!0,oa:!0});return Yo(s,g)}(yield Jn(r),r.asyncQueue,e,t,n)})),n.promise}function Uh(r,e,t={}){const n=new Ee;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,o,u,c,h){const f=new Yi({next:_=>{o.enqueueAndForget(()=>Zo(s,g)),_.fromCache&&"server"===c.source?h.reject(new C(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new ra(u,f,{includeMetadataChanges:!0,oa:!0});return Yo(s,g)}(yield Jn(r),r.asyncQueue,e,t,n)})),n.promise}function Gh(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const zh=new Map;function qa(r,e,t){if(!t)throw new C(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Kh(r,e,t,n){if(!0===e&&!0===n)throw new C(S.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function jh(r){if(!O.isDocumentKey(r))throw new C(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Qh(r){if(O.isDocumentKey(r))throw new C(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function es(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":L()}function W(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new C(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=es(r);throw new C(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function $h(r,e){if(e<=0)throw new C(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class Wh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new C(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Kh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Gh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Fr{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wh(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new $f;switch(n.type){case"firstParty":return new Yf(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=zh.get(t);n&&(N("ComponentProvider","Removing Datastore"),zh.delete(t),n.terminate())}(this),Promise.resolve()}}class Se{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Se(this.firestore,e,this._query)}}class le{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new it(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new le(this.firestore,e,this._key)}}class it extends Se{constructor(e,t,n){super(e,t,wn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new O(e))}withConverter(e){return new it(this.firestore,e,this._path)}}function Jh(r,e,...t){if(r=(0,ee.Ku)(r),qa("collection","path",e),r instanceof Fr){const n=H.fromString(e,...t);return Qh(n),new it(r,null,n)}{if(!(r instanceof le||r instanceof it))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(H.fromString(e,...t));return Qh(n),new it(r.firestore,null,n)}}function ts(r,e,...t){if(r=(0,ee.Ku)(r),1===arguments.length&&(e=$u.newId()),qa("doc","path",e),r instanceof Fr){const n=H.fromString(e,...t);return jh(n),new le(r,null,new O(n))}{if(!(r instanceof le||r instanceof it))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(H.fromString(e,...t));return jh(n),new le(r.firestore,r instanceof it?r.converter:null,new O(n))}}function Yh(r,e){return r=(0,ee.Ku)(r),e=(0,ee.Ku)(e),(r instanceof le||r instanceof it)&&(e instanceof le||e instanceof it)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Ua(r,e){return r=(0,ee.Ku)(r),e=(0,ee.Ku)(e),r instanceof Se&&e instanceof Se&&r.firestore===e.firestore&&gr(r._query,e._query)&&r.converter===e.converter}class n_{constructor(){this._u=Promise.resolve(),this.au=[],this.uu=!1,this.cu=[],this.lu=null,this.hu=!1,this.Pu=!1,this.Iu=[],this.e_=new Co(this,"async_queue_retry"),this.Tu=()=>{const t=$i();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.e_.zo()};const e=$i();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tu)}get isShuttingDown(){return this.uu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Eu(),this.du(e)}enterRestrictedMode(e){if(!this.uu){this.uu=!0,this.Pu=e||!1;const t=$i();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tu)}}enqueue(e){if(this.Eu(),this.uu)return new Promise(()=>{});const t=new Ee;return this.du(()=>this.uu&&this.Pu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.au.push(e),this.Au()))}Au(){var e=this;return(0,b.A)(function*(){if(0!==e.au.length){try{yield e.au[0](),e.au.shift(),e.e_.reset()}catch(t){if(!vt(t))throw t;N("AsyncQueue","Operation failed with retryable error: "+t)}e.au.length>0&&e.e_.Wo(()=>e.Au())}})()}du(e){const t=this._u.then(()=>(this.hu=!0,e().catch(n=>{throw this.lu=n,this.hu=!1,ye("INTERNAL UNHANDLED ERROR: ",function(o){let u=o.message||"";return o.stack&&(u=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),u}(n)),n}).then(n=>(this.hu=!1,n))));return this._u=t,t}enqueueAfterDelay(e,t,n){this.Eu(),this.Iu.indexOf(e)>-1&&(t=0);const i=Jo.createAndSchedule(this,e,t,n,s=>this.Ru(s));return this.cu.push(i),i}Eu(){this.lu&&L()}verifyOperationInProgress(){}Vu(){var e=this;return(0,b.A)(function*(){let t;do{t=e._u,yield t}while(t!==e._u)})()}mu(e){for(const t of this.cu)if(t.timerId===e)return!0;return!1}fu(e){return this.Vu().then(()=>{this.cu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.cu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Vu()})}gu(e){this.Iu.push(e)}Ru(e){const t=this.cu.indexOf(e);this.cu.splice(t,1)}}function Ga(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class r_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ee,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class re extends Fr{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new n_,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Xh(this),this._firestoreClient.terminate()}}function me(r){return r._firestoreClient||Xh(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Xh(r){var e,t,n;const i=r._freezeSettings(),s=(c=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Vm(r._databaseId,c,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Gh(f.experimentalLongPollingOptions),f.useFetchStreams));var c,f;r._firestoreClient=new zp(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Zh(r,e,t){const n=new Ee;return r.asyncQueue.enqueue((0,b.A)(function*(){try{yield Xi(r,t),yield Na(r,e),n.resolve()}catch(i){const s=i;if(!Mh(s))throw s;Ue("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function ed(r){if(r._initialized||r._terminated)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class st{constructor(e){this._byteString=e}static fromBase64String(e){try{return new st(ge.fromBase64String(e))}catch(t){throw new C(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new st(ge.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class gt{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class sn{constructor(e){this._methodName=e}}class ns{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return j(this._lat,e._lat)||j(this._long,e._long)}}const m_=/^__.*__$/;class g_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new dt(e,this.data,this.fieldMask,t,this.fieldTransforms):new bn(e,this.data,t,this.fieldTransforms)}}class td{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new dt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function nd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}class rs{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.pu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get yu(){return this.settings.yu}wu(e){return new rs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.wu({path:n,bu:!1});return i.Du(e),i}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.wu({path:n,bu:!1});return i.pu(),i}vu(e){return this.wu({path:void 0,bu:!0})}Fu(e){return os(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.xu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Du(this.path.get(e))}Du(e){if(0===e.length)throw this.Fu("Document fields must not be empty");if(nd(this.yu)&&m_.test(e))throw this.Fu('Document fields cannot begin and end with "__"')}}class p_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Nr(e)}Ou(e,t,n,i=!1){return new rs({yu:e,methodName:t,xu:n,path:ue.emptyPath(),bu:!1,Mu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function on(r){const e=r._freezeSettings(),t=Nr(r._databaseId);return new p_(r._databaseId,!!e.ignoreUndefinedProperties,t)}function is(r,e,t,n,i,s={}){const o=r.Ou(s.merge||s.mergeFields?2:0,e,t,i);Ha("Data must be an object, but it was:",o,n);const u=sd(n,o);let c,h;if(s.merge)c=new Ge(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){const f=[];for(const g of s.mergeFields){const _=Lr(e,g,t);if(!o.contains(_))throw new C(S.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);ad(f,_)||f.push(_)}c=new Ge(f),h=o.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=o.fieldTransforms;return new g_(new Pe(u),c,h)}class Or extends sn{_toFieldTransform(e){if(2!==e.yu)throw e.Fu(1===e.yu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Or}}function rd(r,e,t){return new rs({yu:3,xu:e.settings.xu,methodName:r._methodName,bu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class za extends sn{_toFieldTransform(e){return new Ir(e.path,new Sn)}isEqual(e){return e instanceof za}}class Ka extends sn{constructor(e,t){super(e),this.Nu=t}_toFieldTransform(e){const t=rd(this,e,!0),n=this.Nu.map(s=>an(s,t)),i=new Ht(n);return new Ir(e.path,i)}isEqual(e){return e instanceof Ka&&(0,ee.bD)(this.Nu,e.Nu)}}class ja extends sn{constructor(e,t){super(e),this.Nu=t}_toFieldTransform(e){const t=rd(this,e,!0),n=this.Nu.map(s=>an(s,t)),i=new Jt(n);return new Ir(e.path,i)}isEqual(e){return e instanceof ja&&(0,ee.bD)(this.Nu,e.Nu)}}class Qa extends sn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=new Vn(e.serializer,zc(e.serializer,this.Lu));return new Ir(e.path,t)}isEqual(e){return e instanceof Qa&&this.Lu===e.Lu}}function $a(r,e,t,n){const i=r.Ou(1,e,t);Ha("Data must be an object, but it was:",i,n);const s=[],o=Pe.empty();At(n,(c,h)=>{const f=ss(e,c,t);h=(0,ee.Ku)(h);const g=i.Cu(f);if(h instanceof Or)s.push(f);else{const _=an(h,g);null!=_&&(s.push(f),o.set(f,_))}});const u=new Ge(s);return new td(o,u,i.fieldTransforms)}function Wa(r,e,t,n,i,s){const o=r.Ou(1,e,t),u=[Lr(e,n,t)],c=[i];if(s.length%2!=0)throw new C(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Lr(e,s[_])),c.push(s[_+1]);const h=[],f=Pe.empty();for(let _=u.length-1;_>=0;--_)if(!ad(h,u[_])){const R=u[_];let x=c[_];x=(0,ee.Ku)(x);const k=o.Cu(R);if(x instanceof Or)h.push(R);else{const D=an(x,k);null!=D&&(h.push(R),f.set(R,D))}}const g=new Ge(h);return new td(f,g,o.fieldTransforms)}function id(r,e,t,n=!1){return an(t,r.Ou(n?4:3,e))}function an(r,e){if(od(r=(0,ee.Ku)(r)))return Ha("Unsupported field value:",e,r),sd(r,e);if(r instanceof sn)return function(n,i){if(!nd(i.yu))throw i.Fu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Fu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.bu&&4!==e.yu)throw e.Fu("Nested arrays are not supported");return function(n,i){const s=[];let o=0;for(const u of n){let c=an(u,i.vu(o));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ee.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return zc(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=de.fromDate(n);return{timestampValue:Cn(i.serializer,s)}}if(n instanceof de){const s=new de(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Cn(i.serializer,s)}}if(n instanceof ns)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof st)return{bytesValue:hl(i.serializer,n._byteString)};if(n instanceof le){const s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Fu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:io(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Fu(`Unsupported field value: ${es(n)}`)}(r,e)}function sd(r,e){const t={};return lc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):At(r,(n,i)=>{const s=an(i,e.Su(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function od(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof de||r instanceof ns||r instanceof st||r instanceof le||r instanceof sn)}function Ha(r,e,t){if(!od(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=es(t);throw e.Fu("an object"===n?r+" a custom object":r+" "+n)}var i}function Lr(r,e,t){if((e=(0,ee.Ku)(e))instanceof gt)return e._internalPath;if("string"==typeof e)return ss(r,e);throw os("Field path arguments must be of type string or ",r,!1,void 0,t)}const __=new RegExp("[~\\*/\\[\\]]");function ss(r,e,t){if(e.search(__)>=0)throw os(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new gt(...e.split("."))._internalPath}catch{throw os(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function os(r,e,t,n,i){const s=n&&!n.isEmpty(),o=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${n}`),o&&(c+=` in document ${i}`),c+=")"),new C(S.INVALID_ARGUMENT,u+r+c)}function ad(r,e){return r.some(t=>t.isEqual(e))}class Br{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new y_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(as("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class y_ extends Br{data(){return super.data()}}function as(r,e){return"string"==typeof e?ss(r,e):e instanceof gt?e._internalPath:e._delegate._internalPath}function ud(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new C(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ja{}class qr extends Ja{}function Ft(r,e,...t){let n=[];e instanceof Ja&&n.push(e),n=n.concat(t),function(s){const o=s.filter(c=>c instanceof Yn).length,u=s.filter(c=>c instanceof Ur).length;if(o>1||o>0&&u>0)throw new C(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class Ur extends qr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Ur(e,t,n)}_apply(e){const t=this._parse(e);return dd(e._query,t),new Se(e.firestore,e.converter,Js(e._query,t))}_parse(e){const t=on(e.firestore);return function(s,o,u,c,h,f,g){let _;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new C(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){hd(g,f);const R=[];for(const x of g)R.push(ld(c,s,x));_={arrayValue:{values:R}}}else _=ld(c,s,g)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||hd(g,f),_=id(u,"where",g,"in"===f||"not-in"===f);return J.create(h,f,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Yn extends Ja{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Yn(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:te.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const u=s.getFlattenedFilters();for(const c of u)dd(o,c),o=Js(o,c)}(e._query,t),new Se(e.firestore,e.converter,Js(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Ya extends qr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ya(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new C(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new C(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fr(s,o)}(e._query,this._field,this._direction);return new Se(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new lt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class us extends qr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new us(e,t,n)}_apply(e){return new Se(e.firestore,e.converter,Pi(e._query,this._limit,this._limitType))}}class cs extends qr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new cs(e,t,n)}_apply(e){const t=cd(e,this.type,this._docOrFields,this._inclusive);return new Se(e.firestore,e.converter,(s=t,new lt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class ls extends qr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ls(e,t,n)}_apply(e){const t=cd(e,this.type,this._docOrFields,this._inclusive);return new Se(e.firestore,e.converter,(s=t,new lt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function cd(r,e,t,n){if(t[0]=(0,ee.Ku)(t[0]),t[0]instanceof Br)return function(s,o,u,c,h){if(!c)throw new C(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const g of Rn(s))if(g.field.isKeyField())f.push($t(o,c.key));else{const _=c.data.field(g.field);if(Ii(_))throw new C(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const R=g.field.canonicalString();throw new C(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(_)}return new Vt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=on(r.firestore);return function(o,u,c,h,f,g){const _=o.explicitOrderBy;if(f.length>_.length)throw new C(S.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const R=[];for(let x=0;x<f.length;x++){const k=f[x];if(_[x].field.isKeyField()){if("string"!=typeof k)throw new C(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof k}`);if(!Hs(o)&&-1!==k.indexOf("/"))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${k}' contains a slash.`);const D=o.path.child(H.fromString(k));if(!O.isDocumentKey(D))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);const B=new O(D);R.push($t(u,B))}else{const D=id(c,h,k);R.push(D)}}return new Vt(R,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function ld(r,e,t){if("string"==typeof(t=(0,ee.Ku)(t))){if(""===t)throw new C(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Hs(e)&&-1!==t.indexOf("/"))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(H.fromString(t));if(!O.isDocumentKey(n))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return $t(r,new O(n))}if(t instanceof le)return $t(r,t._key);throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${es(t)}.`)}function hd(r,e){if(!Array.isArray(r)||0===r.length)throw new C(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dd(r,e){const t=function(i,s){for(const o of i)for(const u of o.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(S.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Xa{convertValue(e,t="none"){switch(Pt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ct(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return At(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new ns(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ti(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(cr(e));default:return null}}convertTimestamp(e){const t=ut(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=H.fromString(e);q(Al(n));const i=new wt(n.get(1),n.get(3)),s=new O(n.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function hs(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class S_ extends Xa{constructor(e){super(),this.firestore=e}convertBytes(e){return new st(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}class un{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pt extends Br{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Gr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(as("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Gr extends pt{data(e={}){return super.data(e)}}class Mt{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new un(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Gr(this._firestore,this._userDataWriter,n.key,n,new un(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Gr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new un(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new Gr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new un(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),f=o.indexOf(u.doc.key)),{type:b_(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function b_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function md(r,e){return r instanceof pt&&e instanceof pt?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Mt&&e instanceof Mt&&r._firestore===e._firestore&&Ua(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class Ot extends Xa{constructor(e){super(),this.firestore=e}convertBytes(e){return new st(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}function gd(r,e,t){r=W(r,le);const n=W(r.firestore,re),i=hs(r.converter,e,t);return Xn(n,[is(on(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,fe.none())])}function pd(r,e,t,...n){r=W(r,le);const i=W(r.firestore,re),s=on(i);let o;return o="string"==typeof(e=(0,ee.Ku)(e))||e instanceof gt?Wa(s,"updateDoc",r._key,e,t,n):$a(s,"updateDoc",r._key,e),Xn(i,[o.toMutation(r._key,fe.exists(!0))])}function _d(r,...e){var t,n,i;r=(0,ee.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Ga(e[o])||(s=e[o],o++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ga(e[o])){const g=e[o];e[o]=null===(t=g.next)||void 0===t?void 0:t.bind(g),e[o+1]=null===(n=g.error)||void 0===n?void 0:n.bind(g),e[o+2]=null===(i=g.complete)||void 0===i?void 0:i.bind(g)}let c,h,f;if(r instanceof le)h=W(r.firestore,re),f=wn(r._key.path),c={next:g=>{e[o]&&e[o](Za(h,r,g))},error:e[o+1],complete:e[o+2]};else{const g=W(r,Se);h=W(g.firestore,re),f=g._query;const _=new Ot(h);c={next:R=>{e[o]&&e[o](new Mt(h,_,g,R))},error:e[o+1],complete:e[o+2]},ud(r._query)}return function(_,R,x,k){const D=new Yi(k),B=new ra(R,D,x);return _.asyncQueue.enqueueAndForget((0,b.A)(function*(){return Yo(yield Jn(_),B)})),()=>{D.Ga(),_.asyncQueue.enqueueAndForget((0,b.A)(function*(){return Zo(yield Jn(_),B)}))}}(me(h),f,u,c)}function Xn(r,e){return function(n,i){const s=new Ee;return n.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Ap(r,e,t){return ha.apply(this,arguments)}(yield La(n),i,s)})),s.promise}(me(r),e)}function Za(r,e,t){const n=t.docs.get(e._key),i=new Ot(r);return new pt(r,i,e._key,n,new un(t.hasPendingWrites,t.fromCache),e.converter)}const $_={maxAttempts:5};class yd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=on(e)}set(e,t,n){this._verifyNotCommitted();const i=Lt(e,this._firestore),s=hs(i.converter,t,n),o=is(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(o.toMutation(i._key,fe.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Lt(e,this._firestore);let o;return o="string"==typeof(t=(0,ee.Ku)(t))||t instanceof gt?Wa(this._dataReader,"WriteBatch.update",s._key,t,n,i):$a(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,fe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Lt(e,this._firestore);return this._mutations=this._mutations.concat(new xn(t._key,fe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Lt(r,e){if((r=(0,ee.Ku)(r)).firestore!==e)throw new C(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class W_ extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=on(t)}get(t){const n=Lt(t,this._firestore),i=new S_(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return L();const o=s[0];if(o.isFoundDocument())return new Br(this._firestore,i,o.key,o,n.converter);if(o.isNoDocument())return new Br(this._firestore,i,n._key,null,n.converter);throw L()})}set(t,n,i){const s=Lt(t,this._firestore),o=hs(s.converter,n,i),u=is(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){const o=Lt(t,this._firestore);let u;return u="string"==typeof(n=(0,ee.Ku)(n))||n instanceof gt?Wa(this._dataReader,"Transaction.update",o._key,n,i,s):$a(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,u),this}delete(t){const n=Lt(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Lt(e,this._firestore),n=new Ot(this._firestore);return super.get(e).then(i=>new pt(this._firestore,n,t._key,i._document,new un(!1,!1),t.converter))}}function tu(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function vd(){if(typeof Uint8Array>"u")throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function Ad(){if(!function Pm(){return typeof atob<"u"}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){pn=fi.SDK_VERSION,(0,fi._registerComponent)(new ku.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const o=n.getProvider("app").getImmediate(),u=new re(new Hf(n.getProvider("auth-internal")),new Xf(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new C(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wt(h.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,fi.registerVersion)(Ku,"4.6.5",e),(0,fi.registerVersion)(Ku,"4.6.5","esm2017")}();class zr{constructor(e){this._delegate=e}static fromBase64String(e){return Ad(),new zr(st.fromBase64String(e))}static fromUint8Array(e){return vd(),new zr(st.fromUint8Array(e))}toBase64(){return Ad(),this._delegate.toBase64()}toUint8Array(){return vd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function nu(r){return function iy(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class sy{enableIndexedDbPersistence(e,t){return function s_(r,e){ed(r=W(r,re));const t=me(r);if(t._uninitializedComponentsProvider)throw new C(S.FAILED_PRECONDITION,"SDK cache is already specified.");Ue("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new Wn;return Zh(t,i,new Ca(i,n.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function o_(r){ed(r=W(r,re));const e=me(r);if(e._uninitializedComponentsProvider)throw new C(S.FAILED_PRECONDITION,"SDK cache is already specified.");Ue("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new Wn;return Zh(e,n,new kh(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function a_(r){if(r._initialized&&!r._terminated)throw new C(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ee;return r._queue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{yield(t=(0,b.A)(function*(i){if(!Ze.D())return Promise.resolve();const s=i+"main";yield Ze.delete(s)}),function n(i){return t.apply(this,arguments)})(To(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class wd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof wt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ue("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function Hh(r,e,t,n={}){var i;const s=(r=W(r,Fr))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ue("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),n.mockUserToken){let u,c;if("string"==typeof n.mockUserToken)u=n.mockUserToken,c=Ae.MOCK_USER;else{u=(0,ee.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new C(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ae(h)}r._authCredentials=new Wf(new ju(u,c))}}(this._delegate,e,t,n)}enableNetwork(){return function c_(r){return function Kp(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield Oh(r),t=yield Lh(r);return e.setNetworkEnabled(!0),function(i){const s=F(i);return s.N_.delete(0),kr(s)}(t)}))}(me(r=W(r,re)))}(this._delegate)}disableNetwork(){return function l_(r){return function jp(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield Oh(r),t=yield Lh(r);return e.setNetworkEnabled(!1),(n=(0,b.A)(function*(s){const o=F(s);o.N_.add(0),yield Bn(o),o.k_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(me(r=W(r,re)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Kh("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function u_(r){return function(t){const n=new Ee;return t.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Sp(r,e){return pa.apply(this,arguments)}(yield La(t),n)})),n.promise}(me(r=W(r,re)))}(this._delegate)}onSnapshotsInSync(e){return function L_(r,e){return function Hp(r,e){const t=new Yi(e);return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Jn(r),s=t,F(i).J_.add(s),void s.next();var i,s})),()=>{t.Ga(),r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Jn(r),s=t,void F(i).J_.delete(s);var i,s}))}}(me(r=W(r,re)),Ga(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Zn(this,Jh(this._delegate,e))}catch(t){throw Oe(t,"collection()","Firestore.collection()")}}doc(e){try{return new He(this,ts(this._delegate,e))}catch(t){throw Oe(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Le(this,function t_(r,e){if(r=W(r,Fr),qa("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Se(r,null,(n=e,new lt(H.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Oe(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function H_(r,e,t){r=W(r,re);const n=Object.assign(Object.assign({},$_),t);return function(s){if(s.maxAttempts<1)throw new C(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,o,u){const c=new Ee;return s.asyncQueue.enqueueAndForget((0,b.A)(function*(){const h=yield function Bh(r){return Zi(r).then(e=>e.datastore)}(s);new Gp(s.asyncQueue,h,u,o,c).nu()})),c.promise}(me(r),i=>e(new W_(r,i)),n)}(this._delegate,t=>e(new Rd(this,t)))}batch(){return me(this._delegate),new Pd(new yd(this._delegate,e=>Xn(this._delegate,e)))}loadBundle(e){return function h_(r,e){const t=me(r=W(r,re)),n=new r_;return function Jp(r,e,t,n){const i=function(o,u){let c;return c="string"==typeof o?rl().encode(o):o,f=function(f,g){if(f instanceof Uint8Array)return Fh(f,g);if(f instanceof ArrayBuffer)return Fh(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new qp(f,u);var f}(t,Nr(e));r.asyncQueue.enqueueAndForget((0,b.A)(function*(){!function Lp(r,e,t){const n=F(r);var i;(i=(0,b.A)(function*(o,u,c){try{const h=yield u.getMetadata();if(yield function(x,k){const D=F(x),B=Ie(k.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",z=>D.Wr.getBundleMetadata(z,k.id)).then(z=>!!z&&z.createTime.compareTo(B)>=0)}(o.localStore,h))return yield u.close(),c._completeWith({taskState:"Success",documentsLoaded:(x=h).totalDocuments,bytesLoaded:x.totalBytes,totalDocuments:x.totalDocuments,totalBytes:x.totalBytes}),Promise.resolve(new Set);c._updateProgress(wh(h));const f=new gp(h,o.localStore,u.serializer);let g=yield u.$a();for(;g;){const R=yield f.ca(g);R&&c._updateProgress(R),g=yield u.$a()}const _=yield f.complete();return yield mt(o,_.Pa,void 0),yield function(x,k){const D=F(x);return D.persistence.runTransaction("Save bundle","readwrite",B=>D.Wr.saveBundleMetadata(B,k))}(o.localStore,h),c._completeWith(_.progress),Promise.resolve(_.ha)}catch(h){return Ue("SyncEngine",`Loading bundle failed with ${h}`),c._failWith(h),Promise.resolve(new Set)}var x}),function s(o,u,c){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield La(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function d_(r,e){return function Yp(r,e){return r.asyncQueue.enqueue((0,b.A)(function*(){return function(n,i){const s=F(n);return s.persistence.runTransaction("Get named query","readonly",o=>s.Wr.getNamedQuery(o,i))}(yield Hn(r),e)}))}(me(r=W(r,re)),e).then(t=>t?new Se(r,null,t.query):null)}(this._delegate,e).then(t=>t?new Le(this,t):null)}}class fs extends Xa{constructor(e){super(),this.firestore=e}convertBytes(e){return new zr(new st(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return He.forKey(t,this.firestore,null)}}class Rd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new fs(e)}get(e){const t=ln(e);return this._delegate.get(t).then(n=>new Kr(this._firestore,new pt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=ln(e);return n?(tu("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=ln(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=ln(e);return this._delegate.delete(t),this}}class Pd{constructor(e){this._delegate=e}set(e,t,n){const i=ln(e);return n?(tu("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=ln(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=ln(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class cn{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Gr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new jr(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=cn.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new cn(e,new fs(e),t),i.set(t,s)),s}}cn.INSTANCES=new WeakMap;class He{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fs(e)}static forPath(e,t,n){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new He(t,new le(t._delegate,n,new O(e)))}static forKey(e,t,n){return new He(t,new le(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Zn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Zn(this.firestore,Jh(this._delegate,e))}catch(t){throw Oe(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ee.Ku)(e))instanceof le&&Yh(this._delegate,e)}set(e,t){t=tu("DocumentReference.set",t);try{return t?gd(this._delegate,e,t):gd(this._delegate,e)}catch(n){throw Oe(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?pd(this._delegate,e):pd(this._delegate,e,t,...n)}catch(i){throw Oe(i,"updateDoc()","DocumentReference.update()")}}delete(){return function M_(r){return Xn(W(r.firestore,re),[new xn(r._key,fe.none())])}(this._delegate)}onSnapshot(...e){const t=Sd(e),n=Vd(e,i=>new Kr(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return _d(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function C_(r){r=W(r,le);const e=W(r.firestore,re),t=me(e),n=new Ot(e);return function Qp(r,e){const t=new Ee;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,o,u){try{const c=yield function(f,g){const _=F(f);return _.persistence.runTransaction("read document","readonly",R=>_.localDocuments.getDocument(R,g))}(s,o);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new C(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const h=zn(c,`Failed to get document '${o} from cache`);u.reject(h)}}),function i(s,o,u){return n.apply(this,arguments)})(yield Hn(r),e,t);var n})),t.promise}(t,r._key).then(i=>new pt(e,n,r._key,i,new un(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function D_(r){r=W(r,le);const e=W(r.firestore,re);return qh(me(e),r._key,{source:"server"}).then(t=>Za(e,r,t))}(this._delegate):function x_(r){r=W(r,le);const e=W(r.firestore,re);return qh(me(e),r._key).then(t=>Za(e,r,t))}(this._delegate),t.then(n=>new Kr(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new He(this.firestore,this._delegate.withConverter(e?cn.getInstance(this.firestore,e):null))}}function Oe(r,e,t){return r.message=r.message.replace(e,t),r}function Sd(r){for(const e of r)if("object"==typeof e&&!nu(e))return e;return{}}function Vd(r,e){var t,n;let i;return i=nu(r[0])?r[0]:nu(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class Kr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new He(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return md(this._delegate,e._delegate)}}class jr extends Kr{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Qf(r,e){r||L()}(void 0!==t),t}}class Le{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fs(e)}where(e,t,n){try{return new Le(this.firestore,Ft(this._delegate,function I_(r,e,t){const n=e,i=as("where",r);return Ur._create(i,n,t)}(e,t,n)))}catch(i){throw Oe(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Le(this.firestore,Ft(this._delegate,function T_(r,e="asc"){const t=e,n=as("orderBy",r);return Ya._create(n,t)}(e,t)))}catch(n){throw Oe(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Le(this.firestore,Ft(this._delegate,function E_(r){return $h("limit",r),us._create("limit",r,"F")}(e)))}catch(t){throw Oe(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Le(this.firestore,Ft(this._delegate,function v_(r){return $h("limitToLast",r),us._create("limitToLast",r,"L")}(e)))}catch(t){throw Oe(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Le(this.firestore,Ft(this._delegate,function A_(...r){return cs._create("startAt",r,!0)}(...e)))}catch(t){throw Oe(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Le(this.firestore,Ft(this._delegate,function w_(...r){return cs._create("startAfter",r,!1)}(...e)))}catch(t){throw Oe(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Le(this.firestore,Ft(this._delegate,function R_(...r){return ls._create("endBefore",r,!1)}(...e)))}catch(t){throw Oe(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Le(this.firestore,Ft(this._delegate,function P_(...r){return ls._create("endAt",r,!0)}(...e)))}catch(t){throw Oe(t,"endAt()","Query.endAt()")}}isEqual(e){return Ua(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function k_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Ot(e);return function $p(r,e){const t=new Ee;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,o,u){try{const c=yield zi(s,o,!0),h=new Sh(o,c.Is),f=h.Va(c.documents),g=h.applyChanges(f,!1);u.resolve(g.snapshot)}catch(c){const h=zn(c,`Failed to execute query '${o} against cache`);u.reject(h)}}),function i(s,o,u){return n.apply(this,arguments)})(yield Hn(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Mt(e,n,r,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function F_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Ot(e);return Uh(t,r._query,{source:"server"}).then(i=>new Mt(e,n,r,i))}(this._delegate):function N_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Ot(e);return ud(r._query),Uh(t,r._query).then(i=>new Mt(e,n,r,i))}(this._delegate),t.then(n=>new ru(this.firestore,new Mt(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=Sd(e),n=Vd(e,i=>new ru(this.firestore,new Mt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return _d(this._delegate,t,n)}withConverter(e){return new Le(this.firestore,this._delegate.withConverter(e?cn.getInstance(this.firestore,e):null))}}class ay{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new jr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class ru{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Le(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new jr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new ay(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new jr(this._firestore,n))})}isEqual(e){return md(this._delegate,e._delegate)}}class Zn extends Le{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new He(this.firestore,e):null}doc(e){try{return new He(this.firestore,void 0===e?ts(this._delegate):ts(this._delegate,e))}catch(t){throw Oe(t,"doc()","CollectionReference.doc()")}}add(e){return function O_(r,e){const t=W(r.firestore,re),n=ts(r),i=hs(r.converter,e);return Xn(t,[is(on(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,fe.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new He(this.firestore,t))}isEqual(e){return Yh(this._delegate,e._delegate)}withConverter(e){return new Zn(this.firestore,this._delegate.withConverter(e?cn.getInstance(this.firestore,e):null))}}function ln(r){return W(r,le)}class iu{constructor(...e){this._delegate=new gt(...e)}static documentId(){return new iu(ue.keyField().canonicalString())}isEqual(e){return(e=(0,ee.Ku)(e))instanceof gt&&this._delegate._internalPath.isEqual(e._internalPath)}}class hn{constructor(e){this._delegate=e}static serverTimestamp(){const e=function Y_(){return new za("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new hn(e)}static delete(){const e=function J_(){return new Or("deleteField")}();return e._methodName="FieldValue.delete",new hn(e)}static arrayUnion(...e){const t=function X_(...r){return new Ka("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new hn(t)}static arrayRemove(...e){const t=function Z_(...r){return new ja("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new hn(t)}static increment(e){const t=function ey(r){return new Qa("increment",r)}(e);return t._methodName="FieldValue.increment",new hn(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const uy={Firestore:wd,GeoPoint:ns,Timestamp:de,Blob:zr,Transaction:Rd,WriteBatch:Pd,DocumentReference:He,DocumentSnapshot:Kr,Query:Le,QueryDocumentSnapshot:jr,QuerySnapshot:ru,CollectionReference:Zn,FieldPath:iu,FieldValue:hn,setLogLevel:function oy(r){!function jf(r){Tt.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};function bd(r,e){return function hy(r,e=Bf.E){return new qf.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=n&&n()}})}(r,e)}function su(r,e){return bd(r,e).pipe((0,Ye.T)(t=>({payload:t,type:"query"})))}!function ly(r){(function cy(r,e){r.INTERNAL.registerComponent(new ku.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},uy)))})(r,(e,t)=>new wd(e,t,new sy)),r.registerVersion("@firebase/firestore-compat","0.3.34")}(Kf.A),oe(7935);class xd{constructor(e,t){(0,We.A)(this,"ref",void 0),(0,We.A)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=kd(n,t);return new Nd(i,s,this.afs)}snapshotChanges(){return function dy(r,e){return bd(r,e).pipe((0,Ds.Z)(void 0),Ns(),(0,Ye.T)(t=>{const[n,i]=t;return i.exists?null!=n&&n.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ke.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Ye.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,di.H)(this.ref.get(e)).pipe(Ke.U0)}}function ms(r,e){return su(r,e).pipe((0,Ds.Z)(void 0),Ns(),(0,Ye.T)(t=>{const[n,i]=t,s=i.payload.docChanges(),o=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{const h=s.find(g=>g.doc.ref.isEqual(u.ref)),f=null==n?void 0:n.payload.docs.find(g=>g.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),o}))}function Cd(r,e,t){return ms(r,t).pipe((0,ks.S)((n,i)=>function fy(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function my(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return ou(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return ou(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ou(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,zf.F)(),(0,Ye.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function ou(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function Dd(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class Nd{constructor(e,t,n){(0,We.A)(this,"ref",void 0),(0,We.A)(this,"query",void 0),(0,We.A)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=ms(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Ye.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Ds.Z)(void 0),Ns(),(0,Nu.p)(([n,i])=>i.length>0||!n),(0,Ye.T)(([,n])=>n),Ke.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,ks.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Dd(e);return Cd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ke.U0)}valueChanges(e={}){return su(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ye.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),Ke.U0)}get(e){return(0,di.H)(this.query.get(e)).pipe(Ke.U0)}add(e){return this.ref.add(e)}doc(e){return new xd(this.ref.doc(e),this.afs)}}class gy{constructor(e,t){(0,We.A)(this,"query",void 0),(0,We.A)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ms(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ye.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,Nu.p)(t=>t.length>0),Ke.U0):ms(this.query,this.afs.schedulers.outsideAngular).pipe(Ke.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,ks.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Dd(e);return Cd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ke.U0)}valueChanges(e={}){return su(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ye.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Ke.U0)}get(e){return(0,di.H)(this.query.get(e)).pipe(Ke.U0)}}const py=new ie.nKC("angularfire2.enableFirestorePersistence"),_y=new ie.nKC("angularfire2.firestore.persistenceSettings"),yy=new ie.nKC("angularfire2.firestore.settings"),Iy=new ie.nKC("angularfire2.firestore.use-emulator");function kd(r,e=(t=>t)){return{query:e(r),ref:r}}let Ty=(()=>{var r;class e{constructor(n,i,s,o,u,c,h,f,g,_,R,x,k,D,B,z,U){(0,We.A)(this,"schedulers",void 0),(0,We.A)(this,"firestore",void 0),(0,We.A)(this,"persistenceEnabled$",void 0),this.schedulers=h;const K=(0,hi.iB)(n,c,i),Y=g;_&&(0,ot.gF)(K,c,R,k,D,B,x,z),[this.firestore,this.persistenceEnabled$]=(0,hi.BM)(`${K.name}.firestore`,"AngularFirestore",K.name,()=>{const Q=c.runOutsideAngular(()=>K.firestore());if(o&&Q.settings(o),Y&&Q.useEmulator(...Y),s&&!(0,Lf.Vy)(u)){const T=()=>{try{return(0,di.H)(Q.enablePersistence(f||void 0).then(()=>!0,()=>!1))}catch(p){return typeof console<"u"&&console.warn(p),(0,Du.of)(!1)}};return[Q,c.runOutsideAngular(T)]}return[Q,(0,Du.of)(!1)]},[o,Y,s])}collection(n,i){let s;s="string"==typeof n?this.firestore.collection(n):n;const{ref:o,query:u}=kd(s,i),c=this.schedulers.ngZone.run(()=>o);return new Nd(c,u,this)}collectionGroup(n,i){const s=i||(u=>u),o=this.firestore.collectionGroup(n);return new gy(s(o),this)}doc(n){let i;i="string"==typeof n?this.firestore.doc(n):n;const s=this.schedulers.ngZone.run(()=>i);return new xd(s,this)}createId(){return this.firestore.collection("_").doc().id}}return r=e,(0,We.A)(e,"\u0275fac",function(n){return new(n||r)(ie.KVO(hi.rx),ie.KVO(hi.uP,8),ie.KVO(py,8),ie.KVO(yy,8),ie.KVO(ie.Agw),ie.KVO(ie.SKi),ie.KVO(Ke.u0),ie.KVO(_y,8),ie.KVO(Iy,8),ie.KVO(ot.DS,8),ie.KVO(ot.CP,8),ie.KVO(ot.yy,8),ie.KVO(ot.ZP,8),ie.KVO(ot.$z,8),ie.KVO(ot.AU,8),ie.KVO(ot.UB,8),ie.KVO(Ke.Jv,8))}),(0,We.A)(e,"\u0275prov",ie.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})),e})(),Ey=(()=>{var r;class e{constructor(n,i){this.auth=n,this.adb=i}login(n,i){return new Promise((s,o)=>{this.auth.signInWithEmailAndPassword(n,i).then(u=>{let c=u.user;localStorage.setItem("email",c.email),this.getUserById(c.uid).then(h=>{localStorage.setItem("name",h[0].name),localStorage.setItem("role",h[0].role)}),s(c)}).catch(u=>{o(u)})})}logOut(){this.auth.signOut(),localStorage.clear()}resetPassword(n){return new Promise((i,s)=>{this.auth.sendPasswordResetEmail(n).then(()=>{i("done")},o=>{s(o)})})}updateUserInfo(n,i){return new Promise((s,o)=>{this.adb.collection("users").doc(n).update(i).then(u=>{s("done")},u=>{o(u)})})}makeid(n){let i="";for(let u=0;u<n;u++)i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return i}getUserByAcrom(n){return new Promise((i,s)=>{this.adb.collection("users",o=>o.where("acrom","==",n)).get().subscribe(function(){var o=(0,b.A)(function*(u){let c=u.docs.map(h=>{let f=h.data();return f.id=h.id,f});i(c)});return function(u){return o.apply(this,arguments)}}(),o=>{s(o)})})}getUserById(n){return new Promise((i,s)=>{this.adb.collection("users",o=>o.where("uid","==",n)).get().subscribe(function(){var o=(0,b.A)(function*(u){let c=u.docs.map(h=>{let f=h.data();return f.id=h.id,f});i(c)});return function(u){return o.apply(this,arguments)}}(),o=>{s(o)})})}createTask(n,i){return new Promise((s,o)=>{this.adb.collection("tasks").doc(i).set(n).then(function(){var u=(0,b.A)(function*(c){s(n)});return function(c){return u.apply(this,arguments)}}(),u=>{o(u)})})}updateTask(n,i){return new Promise((s,o)=>{this.adb.collection("tasks").doc(i).update(n).then(function(){var u=(0,b.A)(function*(c){s(n)});return function(c){return u.apply(this,arguments)}}(),u=>{o(u)})})}getAsigenedTask(n){return new Promise((i,s)=>{this.adb.collection("tasks",o=>o.where("aUid","==",n)).get().subscribe(function(){var o=(0,b.A)(function*(u){let c=u.docs.map(h=>{let f=h.data();return f.id=h.id,f});i(c)});return function(u){return o.apply(this,arguments)}}(),o=>{s(o)})})}getCreatedTask(n){return new Promise((i,s)=>{this.adb.collection("tasks",o=>o.where("cUid","==",n)).get().subscribe(function(){var o=(0,b.A)(function*(u){let c=u.docs.map(h=>{let f=h.data();return f.id=h.id,f});i(c)});return function(u){return o.apply(this,arguments)}}(),o=>{s(o)})})}getReviewTask(n){return new Promise((i,s)=>{this.adb.collection("tasks",o=>o.where("cUid","==",n)).get().subscribe(function(){var o=(0,b.A)(function*(u){let c=u.docs.map(h=>{let f=h.data();return f.id=h.id,f});i(c)});return function(u){return o.apply(this,arguments)}}(),o=>{s(o)})})}getTaskById(n){return new Promise((i,s)=>{this.adb.collection("tasks",o=>o.where("id","==",n)).get().subscribe(function(){var o=(0,b.A)(function*(u){let c=u.docs.map(h=>{let f=h.data();return f.id=h.id,f});i(c)});return function(u){return o.apply(this,arguments)}}(),o=>{s(o)})})}deleteTaskById(n){return new Promise((i,s)=>{this.adb.collection("tasks").doc(n).delete().then(o=>{console.log(o),i(o)},o=>{s(o)})})}deleteProjectById(n){return new Promise((i,s)=>{this.adb.collection("proyects").doc(n).delete().then(o=>{console.log(o),i(o)},o=>{s(o)})})}getProyects(){return new Promise((n,i)=>{this.adb.collection("proyects").get().subscribe(function(){var s=(0,b.A)(function*(o){let u=o.docs.map(c=>{let h=c.data();return h.id=c.id,h});n(u)});return function(o){return s.apply(this,arguments)}}(),s=>{i(s)})})}getProjectById(n){return new Promise((i,s)=>{this.adb.collection("proyects",o=>o.where("id","==",n)).get().subscribe(function(){var o=(0,b.A)(function*(u){let c=u.docs.map(h=>{let f=h.data();return f.id=h.id,f});i(c)});return function(u){return o.apply(this,arguments)}}(),o=>{s(o)})})}createProject(n,i){return new Promise((s,o)=>{this.adb.collection("proyects").doc(i).set(n).then(function(){var u=(0,b.A)(function*(c){s(c)});return function(c){return u.apply(this,arguments)}}(),u=>{o(u)})})}getAllTask(){return new Promise((n,i)=>{this.adb.collection("tasks").get().subscribe(function(){var s=(0,b.A)(function*(o){let u=o.docs.map(c=>{let h=c.data();return h.id=c.id,h});n(u)});return function(o){return s.apply(this,arguments)}}(),s=>{i(s)})})}getAllUsers(){return new Promise((n,i)=>{this.adb.collection("users").get().subscribe(function(){var s=(0,b.A)(function*(o){let u=o.docs.map(c=>{let h=c.data();return h.id=c.id,h});n(u)});return function(o){return s.apply(this,arguments)}}(),s=>{i(s)})})}createFirma(n,i){return new Promise((s,o)=>{this.adb.collection("firmas").doc(i).set(n).then(u=>{this.adb.collection("firmas").doc(i).get().subscribe(c=>{let h=c.data();console.log(c.data()),s(h)})},u=>{o(u)})})}createFirma2(n,i){this.adb.collection("firmas").doc(i).set(n).then(s=>{this.adb.collection("firmas").doc(i).get().subscribe(o=>{let u=o.data();return console.log(o.data()),u})})}}return(r=e).\u0275fac=function(n){return new(n||r)(ie.KVO(ot.DS),ie.KVO(Ty))},r.\u0275prov=ie.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()}}]);